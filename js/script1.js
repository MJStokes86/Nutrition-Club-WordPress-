!function(a){"use strict";var b=a.App={};b.IS_DEV=0===location.hostname.indexOf("local"),b.Pages={},b.Components={},b.Events=jQuery({}),b.Services={findByGeo:"/ESB/FindFacilitiesByGeo"},b.Events.on("loaded",function(){var c=Backbone.Router.extend({_routeToRegExp:function(a){return a+="(/)",a=Backbone.Router.prototype._routeToRegExp.call(this,a),new RegExp(a.source,"i")},routes:{"":b.Pages.Home.init,"Join/Step1":b.Pages.Join.SelectClub.init,"Join/Step3":b.Pages.Join.MembershipPurchase.init,"Join/thank-you":b.Pages.Join.ThankYouPage.init,"Join/:facilityId":b.Pages.Join.SelectMembership.init,Login:b.Pages.Login.init,customizedlogin:b.Pages.Login.init,"Help/ForgotPassword":b.Pages.Password.Forgot.init,"Help/Recover-Password/:token":b.Pages.Password.Reset.init,"Help/Change/UserName":b.Pages.User.ChangeUserName.init,"help/upgrade/spa-member":b.Pages.User.SpaMemberUpgrade.init,"Help/forgotUser":b.Pages.User.Forgot.init,"login/connect":b.Pages.ConnnectAccounts.init,bookabike:b.Pages.Mock.Book.init,"bookaclass/detail":b.Pages.Mock.Book.init,"Activate/start":b.Pages.Activate.init,"activate/email/:guid":b.Pages.OnBoarding.start,"Activate/verifyemail/:token":b.Pages.User.VerifyUserName.init,"activate/signin":b.Pages.SignIn.init,"activate/signin/facebook/email":b.Pages.SignIn.FacebookWithOutEmail.init,"activate/signin/equinox":b.Pages.CreateAccount.init,"clubs/:region":b.Pages.Clubs.init,"clubs/:region/:club":b.Pages.Club.init,"clubs/:region/:subregion/:club":b.Pages.Club.init,"questionnaire/:step":b.Pages.OnBoarding.init,groupfitness:b.Pages.GroupFitness.init,"groupfitness/customworkouts":b.Pages.CustomWorkout.init,"groupfitness/:id":b.Pages.ClassDetail.init,"activity/workouts/:id":b.Pages.WorkoutSummary.init,"activity/:shareid/classes/:classinstanceid":b.Pages.WorkoutSummaryShared.init,"activity/workout/add-custom(/)":b.Pages.AddCustomWorkout.init,"activity/workout/add-custom/:id":b.Pages.AddCustomWorkout.init,notifications:b.Pages.Notifications.init,rewards:b.Pages.Rewards.init,"personal-training/schedule-equifit":b.Pages.ScheduleEquifit.init,"pilates/inquire":b.Pages.SheduleAndInquire.init,"pilates/schedule":b.Pages.SheduleAndInquire.init,pilates:b.Pages.PilatesInquire.init,"patch/cycling":b.Pages.CyclingPatch.init,"groupfitness/:id/leaderboard":b.Pages.Leaderboard.init,corporatechallenge:b.Pages.JanChallenge2015.init,"corporatechallenge/*subroute":b.Pages.JanChallenge2015.init,"groups/cycling/challenge/:id/leaderboard":b.Pages.GroupLeaderboard.init,"groups/cycling/challenge/:id":b.Pages.CyclingGroupsChallengeDetail.init,"groups/cycling/challenge/:id/:shareid":b.Pages.CyclingGroupsChallengeShared.init,"groups/cycling/leaderboard":b.Pages.GroupLeaderboard.init,"cyclinggroups/leaderboard":b.Pages.GroupLeaderboard.init,"cyclinggroups/challengeslanding":b.Pages.ChallengesLanding.init,"corp/join/request(/)":b.Pages.CorpJoinRequest.init,"lead/fitnesssurvey":b.Pages.LeadSurvey.init,"groupfitness/classdetail/:id":b.Pages.ClassOverview}});b.Router=a.Router=new c,Backbone.history.start({hashChange:!1,pushState:!0}),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0,isDebugging||(console.log=function(){}),b.loadComponent("page-scroll"),jQuery(document).ajaxError(function(a,b){null!==user&&401===b.status&&(location.href="/login?ReturnUrl="+window.location.pathname)}),null===user&&EQ.Helpers.user.invalidateFavoritesCache(),ZeroClipboard.config({swfPath:"/assets/js/vendor/bower_components/zeroclipboard/ZeroClipboard.swf",moviePath:"/assets/js/vendor/bower_components/zeroclipboard/ZeroClipboard.swf",zIndex:800,forceHandCursor:!0}),jQuery("input, textarea").placeholder()})}(window),function(a,b){"use strict";var c=window.EQ.Helpers||{},d=b.Pages.Activate={},e=jQuery(".activate-user");d.init=function(){debug("[Activate] Init"),d.setCookie(),d.bind(),d.populateValues()},d.setCookie=function(){"true"===c.getQueryStringVariable("fromios")&&(debug("[Activate] Cookie"),c.createCookie("from_ios",!0))},d.bind=function(){var a=d;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},d.populateValues=function(){var a=EQ.Helpers.readCookie("activateJSON");EQ.Helpers.deleteCookie("activateJSON"),a&&""!==a&&(a=JSON.parse(a),e.find('input[name="ActivateUser.LastName"]').val(a.lastName),e.find('select[name="ActivateUser.Country"]').val(a.country),e.find('input[name="ActivateUser.Barcode"]').val(a.barcode),localStorage.removeItem("activateJSON"))},d.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({country:"ActivateUser.Country",barcode:"ActivateUser.Barcode",lastName:"ActivateUser.LastName"},function(a){var b=jQuery("<form></form>");b.attr("action","/activate/signin").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","FirstName").val(a.firstName),d=jQuery('<input type="hidden"/>').attr("name","Email").val(a.emailAddress),f=jQuery('<input type="hidden"/>').attr("name","LastName").val(e.find('input[name="ActivateUser.LastName"]').val()),g=jQuery('<input type="hidden"/>').attr("name","Country").val(e.find('select[name="ActivateUser.Country"]').val()),h=jQuery('<input type="hidden"/>').attr("name","Barcode").val(e.find('input[name="ActivateUser.Barcode"]').val());b.append(f),b.append(c),b.append(g),b.append(d),b.append(h),b.css("display","none"),jQuery("body").append(b),b.submit()},function(a){c.goToTop(1e3),console.log(a)})}}(window,window.App),function(a){"use strict";var b,c,d,e=a.Pages.AddCustomWorkout={},f=jQuery('[data-type="date"]'),g=jQuery(".dropdown.date .option"),h=jQuery('[data-type="month"]'),i=jQuery(".dropdown.month .option"),j=jQuery('[data-type="year"]'),k=jQuery(".dropdown.year .option"),l=jQuery('[data-type="minutes"]'),m=jQuery('[data-type="hour"]'),n=jQuery('[data-type="activities"]'),o=jQuery('[data-type="unit"]'),p=jQuery("#workoout-instructor"),q=jQuery("#workoout-calories"),r=jQuery("#workoout-distance"),s=jQuery(".hidden-fields fieldset"),t=jQuery("#workoout-notes"),u=jQuery("#workout-duration"),v=jQuery("#workout-duration-mobile"),w=jQuery("#custom-name"),x=jQuery("#cancel-bttn"),y=jQuery(".toggle-am-pm"),z=jQuery("#submit-bttn"),A={},B=jQuery(".error-area"),C=!1,D=!1,E=jQuery(".duration-radio");e.init=function(a){console.log(a),_.isNull(a)||(d=a,D=!0,jQuery("#page-title").html("EDIT ACTIVITY"),z.html("SAVE CHANGES")),b=EQ.Helpers.loaderAndErrorHandler(B,{type:"button",color:"black",errorTitle:"ERROR"}),D?e.getWorkouts():(e.setDate(),e.setTime()),f.change(e.updateDropdown),h.change(e.updateDropdown),j.change(e.updateDropdown),l.change(e.updateDropdown),m.change(e.updateDropdown),n.change(e.updateDropdown),p.change(e.updateDropdown),y.click(e.toggleClick),z.click(e.validateData),E.click(e.renderDurationMobile),u.keyup(e.onlyNums),v.keyup(e.onlyNums),q.keyup(e.onlyNums),r.keyup(e.onlyNums),t.change(e.updateCountdown),t.keyup(e.updateCountdown),w.change(e.updateDropdown),o.change(e.updateDropdown),x.on("click",e.cancel)},e.updateCountdown=function(){var a=300-t.val().length;jQuery("#countdown").text(a)},e.setDate=function(){var a=(new Date).getDate(),b=(new Date).getMonth(),c=(new Date).getFullYear(),d=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];f.val(a.toString()),g.html(a),h.val((b+1).toString()),i.html(d[b]),j.val(c.toString()),k.html(c),e.getWorkouts()},e.setTime=function(){var a=moment().subtract(30,"minutes"),b=a.hours(),c=a.minutes();y.removeClass("off").addClass("on"),b>=12&&(b-=12,y.removeClass("on").addClass("off")),b=0===b?12:b,b=10>b?"0"+b:b,m.find("option[value="+b+"]").prop("selected",!0),m.parent().find(".option").text(b),l.find("option[value="+c+"]").prop("selected",!0),l.parent().find(".option").text(c)},e.updateDropdown=function(){var a=jQuery(this).val();console.log(a);var b=jQuery(this).parent().find(".option");"month"===jQuery(this).attr("data-type")&&(a=jQuery(this).find("option:selected").text()),"unit"===jQuery(this).attr("data-type")&&(a=jQuery(this).find("option:selected").text()),"select activity"!==a?"activities"===jQuery(this).attr("data-type")&&(s.addClass("active"),console.log("drop",jQuery(this).find("option:selected")),e.setUpHiddenFields(jQuery(this).find("option:selected"))):s.removeClass("active"),b.html(a)},e.setUpHiddenFields=function(a){var b=a.data("distance"),c=a.data("name"),d=a.data("notes"),e=a.data("trainer");jQuery("#distance-holder").addClass("hidden"),jQuery("#distance-type-holder").addClass("hidden"),jQuery("#custom-nameHolder").addClass("hidden"),jQuery("#workout-notes").addClass("hidden"),jQuery("#instructor-holder").addClass("hidden"),jQuery("#calories-holder").removeClass("half").addClass("full"),b&&b===!0&&(jQuery("#distance-holder").removeClass("hidden"),jQuery("#distance-type-holder").removeClass("hidden"),jQuery("#calories-holder").removeClass("full").addClass("half")),c&&c===!0&&jQuery("#custom-nameHolder").removeClass("hidden"),d&&d===!0&&jQuery("#workout-notes").removeClass("hidden"),e&&e===!0&&(jQuery("#instructor-holder").removeClass("hidden"),jQuery("#calories-holder").removeClass("full").addClass("half"))},e.onlyNums=function(){"workoout-distance"===this.id?(this.value=this.value.replace(/[^0-9\.]/g,""),"."===this.value&&(this.value="")):this.value=this.value.replace(/\D/g,"")},e.toggleClick=function(a){a.preventDefault(),y.toggleClass("on").toggleClass("off")},e.renderDurationMobile=function(a){a.preventDefault(),jQuery(this).find("span").removeClass("active"),jQuery(".workout-duration-other").addClass("is-hidden");var b=jQuery(a.target).attr("class");"duration-radio"!==b&&jQuery(a.target).addClass("active"),"other"===b&&jQuery(".workout-duration-other").removeClass("is-hidden")},e.getDurationVal=function(){return jQuery(".duration-holder.is-desktop").is(":visible")&&!jQuery(".duration-holder.is-desktop").is(":hidden")?""!==u.val()?u.val():!1:jQuery(".duration-holder.is-mobile").is(":visible")&&!jQuery(".duration-holder.is-mobile").is(":hidden")?jQuery(".duration-holder.is-mobile").find("span.minuteTab").hasClass("active")?jQuery(".duration-holder.is-mobile").find("span.active").data("durationVal"):jQuery(".duration-holder.is-mobile").find("span.other").hasClass("active")&&""!==jQuery("#workout-duration-mobile").val()?jQuery("#workout-duration-mobile").val():!1:void 0},e.validateData=function(){console.log("VALIDATE");var a=0;e.getDurationVal()===!1?(jQuery(".duration-holder").addClass("error"),a++):jQuery(".duration-holder").removeClass("error"),"select activity"===n.val()?(n.parent().parent().addClass("error"),a++):n.parent().parent().removeClass("error"),0===a&&e.collectData()},e.collectData=function(){var a=jQuery('[data-type="activities"]').find("option:selected"),b=a.data("distance"),c=a.data("notes"),d=a.data("trainer");console.log("COLLECT DATA"),A.workoutName="custom"===n.val().toLowerCase()&&""!==w.val()?w.val():n.val(),A.startDate=e.getDateString(),A.endDate=e.getWorkoutEnd(A.startDate),A.workoutCategory="custom"===n.val().replace(/,/g,"").replace(/ /g,"").toLowerCase()?"CustomEqCustomWorkout":n.val().replace(/,/g,"").replace(/ /g,""),A.calories=q.val(),b?A.distance=r.val():A.distance=null,jQuery("#distance-type-holder").hasClass("hidden")||(A.distanceUnit=o.val()),c?A.notes=t.val():A.notes=null,A.timezone="",d?A.trainerName=p.val():A.trainerName=null,e.saveData(),console.log(A)},e.getDateString=function(){function a(a){return 10>a?"0"+a:a}function b(){return e+"-"+a(d)+"-"+a(c)+"T"+a(g)+":"+i+":00:00"}var c=f.val(),d=h.val(),e=j.val(),g=m.val(),i=l.val(),k=y.hasClass("off")?!0:!1;return g=g.replace(/^0+/,""),k?parseInt(g,10)<12&&(g=parseInt(g,10),g+=12):"12"===g&&(g="0"),b()},e.calculateDuration=function(a,b){var c=new Date(a),d=new Date(b),e=d.getTime()-c.getTime(),f=Math.round(e/6e4);return f},e.getWorkoutEnd=function(a){var b=parseInt(e.getDurationVal(),10);return a=a.substring(0,a.length-3),a=moment(a).add(b,"minutes").format(),a=a.substring(0,a.length-6)+":00"},e.renderWorkouts=function(){for(var a=c.length,b="",d=0;a>d;d+=1){var f=c[d];b+='<option data-is-ocr="'+!!f.isOcrWorkout+'" data-is-custom-workout="'+!!f.isCustomWorkout+'" data-distance="'+f.displayDistanceInput+'" data-calories="'+f.displayCaloriesInput+'" data-name="'+f.displayNameInput+'" data-notes="'+f.displayNotesInput+'" data-trainer="'+f.displayTrainerInput+'" value="'+f.name+'">'+f.name+"</option>"}n.append(b),D?e.getWorkoutObject():n.find('[data-is-custom-workout="false"]').remove()},e.parseLoadedStartDate=function(a){function b(a){return 10>a?"0"+a:a}var c=moment(a).hours(),d=moment(a).minute();c>11&&(console.log("correctHour :: ",c),y.toggleClass("on").toggleClass("off"),c-=12),d=b(d),c=b(c);var e={day:moment(a).date(),month:moment(a).month()+1,year:moment(a).year(),hour:c,minute:d};return console.log(e),e},e.populateWorkoutFields=function(){var a=e.calculateDuration(A.startDate,A.endDate),b=e.parseLoadedStartDate(A.startDate);if("OCR"===A.eventType?(C=!0,n.find('[data-is-ocr="false"]').remove()):n.find('[data-is-custom-workout="false"]').remove(),204===A.workoutCategory&&17===A.workoutSubCategoryId)A.workoutCustomName=A.workoutName,A.workoutName="Custom",n.val(A.workoutName),n.parent().find(".option").html(A.workoutName);else{var c=jQuery('[data-type="activities"] option').filter(function(){return this.value.toLowerCase()===A.workoutName.toLowerCase()}).attr("value");console.log("originalworkoutname :: "+A.workoutName),n.val(c),n.trigger("change"),console.log("workoutname :: "+c)}if(A.workoutCustomName&&w.val(A.workoutCustomName),s.addClass("active"),e.setUpHiddenFields(n.find("option:selected")),r.val(A.distance),o.find('[data-unit="'+A.distanceUnit+'"]').attr("selected",!0),o.trigger("change"),jQuery(".duration-holder.is-desktop").is(":visible")&&!jQuery(".duration-holder.is-desktop").is(":hidden"))u.val(a);else if(jQuery(".duration-holder.is-mobile").is(":visible")&&!jQuery(".duration-holder.is-mobile").is(":hidden")){var d=!1;jQuery(".duration-holder.is-mobile span.minuteTab").each(function(){jQuery(this).data("durationVal")===a&&(jQuery(this).addClass("active"),d=!0)}),d!==!0&&(jQuery(".duration-holder.is-mobile span.other").addClass("active"),jQuery(".workout-duration-other").removeClass("is-hidden"),jQuery(".workout-duration-other input").val(a))}t.val(A.notes),f.val(b.day),g.html(b.day),h.val(b.month),i.html(b.month),j.val(b.year),k.html(b.year),q.val(A.calories),p.val(A.trainerName);var v=parseInt(b.hour,10);console.log("HOUR :: "+v),0===v&&(v="12"),10>v&&(v="0"+v),m.val(v),m.parent().find(".option").html(v),l.val(b.minute),l.parent().find(".option").html(b.minute),e.updateCountdown()},e.saveData=function(){console.log("SAVE!"),b.showLoader();var a,c;D?(a=APIEndpoint26+"/me/workouts/"+d+"/"+C+"/custom-workout",c="PUT"):(a=APIEndpoint26+"/me/workouts/custom-workout",c="POST"),jQuery.ajax({type:c,url:a,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},data:JSON.stringify(A)}).done(function(a){console.log("saveData",a),console.log("[ADD CUSTOM WORKOUT OK]",a.workout.id),b.hideLoader(),window.location.href="/activity/workouts/"+a.workout.id}).fail(function(a){console.log("server error",a.responseJSON),b.showError()}).always(function(){b.hideLoader()})},e.getWorkouts=function(){console.log("GETTING WORKOUTS!"),b.showLoader();var a=APIEndpoint26+"/workouts/categories",d=APIEndpoint26+"/me/profile/unitofmeasure";jQuery.when(jQuery.ajax({type:"GET",url:d,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0}}),jQuery.ajax({type:"GET",url:a,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0}})).done(function(a,d){console.log(a[0],d[0]);var f=[],g="miles";d[0].forEach(function(a){a.workoutSubCategories.forEach(function(a){a.id=a.subCategoryId,a.name=a.subCategoryName,f.push(a)})}),f.sort(function(a,b){return a.name.toUpperCase().localeCompare(b.name.toUpperCase())}),"Metric"===a[0].unitOfMeasure&&(g="km"),o.find('[data-unit="'+g+'"]').attr("selected",!0),o.trigger("change"),c=f,b.hideLoader(),e.renderWorkouts()}).fail(function(){b.showError()}).always(function(){b.hideLoader()})},e.getWorkoutObject=function(){var a=APIEndpoint26+"/me/workouts/"+d+"/detail";b.showLoader(),jQuery.ajax({type:"GET",url:a,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0}}).done(function(a){console.log("[RECEIVED WORKOUT]",a),b.hideLoader();var c=a.workout;A.workoutName=c.name,A.eventType=c.eventType,A.startDate=c.startLocal,A.endDate=c.endLocal,A.workoutCategory=c.workoutCategoryId,A.workoutSubCategoryId=c.workoutSubCategoryId,A.calories=c.totalCalories,A.distance=c.totalDistance,A.distanceUnit=c.distanceUnit,A.notes=c.notes,A.timezone=c.localTimeZone,A.trainerName=c.trainerName,e.populateWorkoutFields()}).fail(function(a){console.log("server error",a.responseJSON),b.showError()}).always(function(){b.hideLoader()})},e.cancel=function(a){a.preventDefault(),window.location.href="/activity#WORKOUTS"}}(window.App),function(a){"use strict";var b={},c={},d={},e={title:null,statusClass:null,options:null,subInfo:null},f={CYCLING:{BOOKED:{CTA:"Booked Spot",STATUSCLASS:"booked-class"},CANCEL:{CTA:"Cancel",STATUSCLASS:"cancel-class",CYCLING_WAITLIST:"Your reservation has been cancelled. Online reservations are full. However you can add yourself to the waitlist"},SWITCH:{CTA:"Switch",STATUSCLASS:"switch-bike"},MAP:{CTA:"Class Map",STATUSCLASS:"switch-bike"}},NON_CYCLING:{BOOKED:{CTA:"Booked",STATUSCLASS:"booked-class"},CANCEL:{CTA:"Cancel Class",STATUSCLASS:"cancel-class",NON_CYCLING_WAITLIST:"Your spot has been cancelled. Online reservations are full. However you can add yourself to the waitlist"}},BOOK:{CTA:"Book Class",STATUSCLASS:"book-class"},ADD_TO_CALENDAR:{CTA:"Add to Calendar",STATUSCLASS:"add-to-calendar",BUBBLEMSG:"Added to calendar."},REMOVE_FROM_CALENDAR:{CTA:"Remove From Calendar",STATUSCLASS:"remove-from-calendar",BUBBLEMSG:"Removed from calendar"},ADD_TO_WAITLIST:{CTA:"Add to waitlist",STATUSCLASS:"add-to-waitlist",BUBBLEMSG:"You will be notified via email once you get auto booked"},REMOVE_FROM_WAITLIST:{CTA:"Remove From waitlist",STATUSCLASS:"remove-from-waitlist",BUBBLEMSG:"Removed from waitlist"},EDIT_CALORIES:{CTA:"Edit Calories",STATUSCLASS:"edit-calories"},REMOVE_WORKOUT:{CTA:"Remove Workout",STATUSCLASS:"remove-workout"},TRY_CLASS:{CTA:"Try Class",STATUSCLASS:""}},g={black:"black",white:"white"},h={msg:"Booking Failed"},i={USER_WAITLIST_STATUS:"(YOU ARE {userPositionInWaitlist} OF {userCountInWaitlist} IN WAITLIST)",WAITLIST_STATUS:"({userCountInWaitlist} PEOPLE WAITING)",SINGLE_PERSON_WAITLIST_STATUS:"({userCountInWaitlist} PERSON WAITING)",WAITLIST_FULL:"(WAITLIST FULL WITH {userCountInWaitlist} PEOPLE)",SINGLE_PERSON_WAITLIST_FULL:"(WAITLIST FULL WITH {userCountInWaitlist} PERSON)"},j="",k=_.template(jQuery("#SingleButtonOptionTemplate").html()),l=_.template(jQuery("#MultiButtonOptionTemplate").html()),m=a.Pages.ClassDetail={},n=Backbone.Model.extend({defaults:{id:"",type:"",selected:!1,displayName:""}}),o=Backbone.Collection.extend(),p=Backbone.View.extend({el:".favorites-class-container",initialize:function(a){this.options=a||{}},render:function(){var a=new o,b=new q,c=new r({collection:a,favoritesData:this.options.favoritesData,updateCallback:b.updateCount.bind(b)});b.render(),c.render()}}),q=Backbone.View.extend({el:".favorites-button",updateCount:function(a){var b="";0!==a&&(b="("+a+")"),this.jQueryel.find(".favorite-count").text(b)},render:function(){var a=this;this.jQueryel.on("click",function(){a.jQueryel.toggleClass("active")})}}),r=Backbone.View.extend({el:".favorites-list",initialize:function(a){this.options=a||{}},updateCount:function(){var a=0;this.collection.each(function(b){b.get("selected")&&a++}),this.options.updateCallback(a)},render:function(){var a=this;this.jQueryel.find("li").each(function(b,c){var d,e,f=jQuery(c).attr("data-type"),g=parseInt(jQuery(c).attr("data-id"),10),h=a.options.favoritesData,i=!1;-1!==_.findIndex(h[f],{id:g})&&(i=!0),d=new n({displayName:jQuery(c).find("strong").text(),type:f,id:g,selected:i}),a.collection.add(d),e=new s({el:c,model:d,updateCallback:a.updateCount.bind(a)}),e.render()})}}),s=Backbone.View.extend({model:n,initialize:function(a){this.options=a||{}},toggleSelected:function(){this.model.set("selected",!this.model.get("selected")),this.options.updateCallback(),this.jQueryel.find("span").toggleClass("icon-star icon-star-empty")},updateFavorite:function(){var a=this.model.get("selected"),b=APIEndpoint+"/me/favorites/"+this.model.get("type"),c=this;a?(b=b+"/remove/"+this.model.get("id"),jQuery.ajax({type:"DELETE",url:b,xhrFields:{withCredentials:!0},contentType:"application/json"}).success(function(a){debug("DESTROY MODEL",a),c.toggleSelected()})):(this.model.urlRoot=b,this.model.save({},{contentType:"application/json",xhrFields:{withCredentials:!0},success:function(a,b){debug("SAVE MODEL",b),c.toggleSelected()}})),EQ.Helpers.user.invalidateFavoritesCache()},render:function(){var a=this;this.model.get("selected")&&(this.jQueryel.find("span").removeClass("icon-star-empty").addClass("icon-star"),this.options.updateCallback()),this.jQueryel.on("click",function(){a.updateFavorite()})}});b.init=function(a){t.showLoader(),this.hours=0,this.minutes=0,this.seconds=0,this.PER_SECOND_REFRESH_INTERVAL=977,this.REQUEST_INTERVAL=7e3,this.requestTimer=null,this.perSecondTimer=null,jQuery.ajax({type:"GET",url:a,cache:!1,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("classdata",a),t.hideLoader(),window.tagData=window.tagData||{};var c=window.moment(a.startLocal).diff(a.facilityCurrentDateTime,"hours"),d=window.moment(a.startLocal).diff(a.facilityCurrentDateTime,"minutes");(c||d)&&(c=c>0?Math.floor(c):Math.ceil(c),0===c&&(c=d>0?1:-1)),window.tagData.classInstance={classId:a.classId.toString(),facilityId:a.facility.facilityId,classInstanceId:a.classInstanceId.toString(),categoryId:a.workoutCategoryId.toString(),timeOffset:c.toString()},b.jsonData=a;var e=jQuery(".caption .buttons"),f=jQuery(".class-detail .bike-number"),g=jQuery(".class-detail .reservation"),h=jQuery(".class-detail .timer"),i=jQuery(".class-detail .rules-anchor"),j=jQuery(".class-detail .class-full"),k=jQuery(".class-detail .spots-left"),l=jQuery(".class-detail .class-shutdown");if(e.html(m.getClassStatusButtonOption(a)),jQuery(".caption .buttons a").addClass("active"),a.isOnCalendar&&jQuery(".export-to-calendar, .booking-rules, .export-separator").addClass("active"),"undefined"!=typeof a.status&&""!==a.status){var n=a.status.reservationEndTimeLeft<=0&&!a.isFinished||a.status.isWithinReservationShutdownPeriod;if(null!==a.facilityStudioLayoutId&&a.facilityStudioLayoutId>0&&a.status.hasReservation?f.text((a.gridItemType||"spots")+" # "+a.status.localId):null!==a.facilityStudioLayoutId&&0!==a.facilityStudioLayoutId||!a.status.hasReservation||f.text("BOOKED"),user&&!a.status.hasReservation&&!a.isCycling&&a.status.isWithinReservationPeriod&&a.status.isClassFull&&!a.isFinished&&"Online"===a.bookingType)j.text("ONLINE BOOKING NOW FULL.WALK-INS ONLY.");else if("Online"===a.bookingType&&!a.status.isClassFull&&a.status.isWithinReservationPeriod&&!a.status.hasReservation){var o=k.text();o+=" "+b.GetEquipmentType(a)+" left",k.text(o),k.removeClass("hidden"),console.log(o)}n&&l.text("ONLINE BOOKING IS CLOSED.WALK-INS ONLY."),a.status.reservationStartTimeLeft>86400?(i.text("Reservations open 26 hours prior to class start time."),i.append('<br> <a href="/classschedule/rules" target="_blank">SEE RULES</a>')):a.status.reservationStartTimeLeft>0&&a.status.reservationStartTimeLeft<=86400&&(b.CreateTimer(h,a.status.reservationStartTimeLeft),b.SetTimer(h,a.status.reservationStartTimeLeft),g.text("CLASS OPEN FOR RESERVATION IN"),i.text("Reservations open 26 hours prior to class start time."),i.append('<br> <a href="/classschedule/rules" target="_blank">SEE RULES</a>'))}if(b.jsonData){var p=+b.jsonData.classId;if(4721===p||4722===p){var q=jQuery(".class-detail li.opt-status"),r=q.find(".checkbox");q.show(),r.find("input").prop("checked",!b.jsonData.status.isCyclingLeaderOptOut),b.jsonData.status.isCyclingLeaderOptOut||r.addClass("checked"),q.on("change",function(){var a=jQuery(this).find(".checkbox input").is(":checked");m.updateOptStatus(q,!a,b.jsonData.classInstanceId)})}}},error:function(a){debug("server error",a.responseJSON)}})},b.GetEquipmentType=function(a){if(a){var b=a.gridItemType||"spot";return a&&a.status.reservableItemsLeft&&+a.status.reservableItemsLeft>1&&(b=null===a.gridItemTypePlural?b+"s":a.gridItemTypePlural),b}},b.CreateTimer=function(a,c){var d=c;this.hours=parseInt(c/3600,10),c%=3600,this.minutes=parseInt(c/60,10),this.seconds=parseInt(c%60,10),this.hours=this.hours<10?"0"+this.hours:this.hours,this.minutes=this.minutes<10?"0"+this.minutes:this.minutes,this.seconds=this.seconds<10?"0"+this.seconds:this.seconds;var e=""+this.hours+":"+this.minutes+":"+this.seconds;a[0].innerText=e,d>=0?b.perSecondTimer=setTimeout(function(){b.CreateTimer(a,--d)},b.PER_SECOND_REFRESH_INTERVAL):(clearTimeout(b.requestTimer),clearTimeout(b.perSecondTimer),window.location.reload())},b.SetTimer=function(a,c){c>0?b.requestTimer=setTimeout(function(){b.currentXHR&&(b.currentXHR.abort(),b.currentXHR=null),clearTimeout(b.perSecondTimer),b.GetReservationTimeLeft(a)},b.REQUEST_INTERVAL):(clearTimeout(b.requestTimer),clearTimeout(b.perSecondTimer),window.location.reload())},b.GetReservationTimeLeft=function(a){b.currentXHR=jQuery.ajax({type:"GET",url:APIEndpoint3+"/classes/reservation-starttimeleft/"+b.jsonData.classInstanceId,cache:!1,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(c){var d=c;"string"==typeof c&&(d=JSON.parse(c)),console.log("time left = "+d.result),b.CreateTimer(a,d.result),b.SetTimer(a,d.result)},error:function(a){debug("server error",a.responseJSON)}})},b.addClass=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var h,i=APIEndpoint3+"/me/calendar/"+a.classInstanceId;t=EQ.Helpers.loaderAndErrorHandler(jQuery(".caption .loader-div"),{color:"black",errorTitle:"Error"});var n=jQuery(".gender-feedback"),o=new RegExp("male|female"),p=jQuery(".class-detail li.opt-status input").prop("checked");n.addClass("hidden"),!p||userProfileJson.Gender&&o.test(userProfileJson.Gender.toLowerCase())?(t.showLoader(),h=jQuery.ajax({type:"POST",url:i,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json"}),h.done(function(a){t.hideLoader(),debug("[ADDCLASS OK]",a),void 0===a.error?(b.jsonData.userEventId=a.result.id,b.jsonData.isOnCalendar=!0,b.jsonData.isCyclingClass===!0?(jQuery(".remove-class, .export-to-calendar, .booking-rules, .export-separator").addClass("active"),jQuery(".add-class").removeClass("active"),b.jsonData.status&&b.jsonData.status.isWithinBookingWindow===!1?(jQuery(".see-bike, .book-bike").removeClass("active"),jQuery(".overlay-box:not(.bike-overlay).add").addClass("active"),setTimeout(function(){jQuery(".overlay-box:not(.bike-overlay).add").removeClass("active")},5e3)):(jQuery(".bike-overlay.add, .book-bike").addClass("active"),setTimeout(function(){jQuery(".bike-overlay.add").removeClass("active")},5e3))):(jQuery(".overlay-box.add, .export-to-calendar, .remove-class, .booking-rules, .export-separator").addClass("active"),jQuery(".add-class").removeClass("active").find("p").remove(),setTimeout(function(){jQuery(".overlay-box.add").removeClass("active")},5e3)),a.isPastClass&&(window.location.href="/activity/workouts/"+a.result.id),"online"!==b.jsonData.bookingType.toLowerCase()||b.jsonData.status.isClassFull||!b.jsonData.status||!b.jsonData.status.isWithinBookingWindow&&!b.jsonData.status.isWithinReservationPeriod||a.waitlistDetail?(j=k(_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white})),a.waitlistDetail&&b.updateCTANLabel(a)):(jQuery(".class-detail .class-full").text(""),j=l(_.extend(e,{options:[{title:b.jsonData.hasReservation?b.jsonData.isCycling?f.CYCLING.CANCEL.CTA:f.NON_CYCLING.CANCEL.CTA:f.BOOK.CTA,statusClass:b.jsonData.hasReservation?b.jsonData.isCycling?f.CYCLING.CANCEL.STATUSCLASS:f.NON_CYCLING.CANCEL.STATUSCLASS:f.BOOK.STATUSCLASS,bgClass:g.black},{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}]}))),jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active"),m.showBubble(f.ADD_TO_CALENDAR.BUBBLEMSG,5e3)):m.showBubble(a.error.message,5e3)}).fail(function(a){debug("server error",a.responseJSON),t.showError()})):(debug("gender missing",userProfileJson.Gender),n.removeClass("hidden"))},b.removeClass=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var h=APIEndpoint3+"/me/calendar/remove/"+a.classInstanceId;t.showLoader(),jQuery.ajax({type:"DELETE",url:h,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("[REMOVECLASS OK]",a);var c=b.jsonData.facilityCurrentDateTime,d=moment(b.jsonData.startDate).diff(c,"hours"),h=moment(b.jsonData.startDate).diff(c,"minutes");if((d||h)&&(d=d>0?Math.floor(d):Math.ceil(d),0===d&&(d=h>0?1:-1)),window.tagData.classInstance=window.tagData.classInstance||{},window.tagData.classInstance={classId:b.jsonData&&""!==b.jsonData.classId&&null!==b.jsonData.classId?b.jsonData.classId.toString():"",facilityId:b.jsonData&&""!==b.jsonData.facility.facilityId&&null!==b.jsonData.facility.facilityId?b.jsonData.facility.facilityId.toString():"",classInstanceId:b.jsonData&&""!==b.jsonData.classInstanceId&&null!==b.jsonData.classInstanceId?b.jsonData.classInstanceId.toString():"",categoryId:b.jsonData&&""!==b.jsonData.workoutCategoryId&&null!==b.jsonData.workoutCategoryId?b.jsonData.workoutCategoryId.toString():"",timeOffset:d?d.toString():""},window.track("classCalendarDelete",window.tagData.classInstance),t.hideLoader(),b.jsonData.isOnCalendar=!1,"online"!==b.jsonData.bookingType.toLowerCase()||b.jsonData.status.isClassFull||!b.jsonData.status||!b.jsonData.status.isWithinBookingWindow&&!b.jsonData.status.isWithinReservationPeriod||a.waitlistDetail){if(j=k(_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white})),a.waitlistDetail){var n=a.waitlistDetail,o="";1===n.userCountInWaitlist?o=i.SINGLE_PERSON_WAITLIST_STATUS:n.userCountInWaitlist>1&&(o=i.WAITLIST_STATUS),j=k(_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,subInfo:o.replace(/\{userCountInWaitlist\}/gi,n.userCountInWaitlist).replace(/\{userPositionInWaitlist\}/gi,n.userPositionInWaitlist),bgClass:g.white}))}}else jQuery(".class-detail .class-full").text(""),j=l(_.extend(e,{options:[{title:b.jsonData.status.hasReservation?b.jsonData.isCycling?f.CYCLING.CANCEL.CTA:f.NON_CYCLING.CANCEL.CTA:f.BOOK.CTA,statusClass:b.jsonData.status.hasReservation?b.jsonData.isCycling?f.CYCLING.CANCEL.STATUSCLASS:f.NON_CYCLING.CANCEL.STATUSCLASS:f.BOOK.STATUSCLASS,bgClass:g.black},{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}]}));jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active"),m.showBubble(f.REMOVE_FROM_CALENDAR.BUBBLEMSG,5e3),jQuery(".overlay-box.remove, .add-class").addClass("active"),jQuery(".remove-class, .see-bike, .book-bike, .export-to-calendar, .booking-rules, .export-separator").removeClass("active"),(b.jsonData.isCyclingClass===!0&&b.jsonData.isFinished===!1||b.jsonData.isHappeningNow===!1)&&jQuery(".book-bike").addClass("active"),setTimeout(function(){jQuery(".overlay-box.remove").removeClass("active")},5e3)},error:function(a){debug("server error",a.responseJSON),t.showError()}})},b.bookClass=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var i,l=APIEndpoint2+"/bookaclass/"+a.classInstanceId+"/book/"+a.facility.facilityId;i=EQ.Helpers.loaderAndErrorHandler(jQuery(".caption .loader-div"),{color:"black"}),i.showLoader(),a.facilityStudioLayoutId&&+a.facilityStudioLayoutId>0?window.location.href="/bookaclass/detail/"+a.classInstanceId:jQuery.ajax({type:"PUT",url:l,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(c){if(debug("[BOOKCLASS OK]",c),i.hideLoader(),c&&c.reservationSuccess){b.jsonData.status.hasReservation=!0,b.jsonData.isOnCalendar=!0,j=k(_.extend(e,{title:f.NON_CYCLING.CANCEL.CTA,statusClass:f.NON_CYCLING.CANCEL.STATUSCLASS,bgClass:g.white})),b.jsonData=a,jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active");var d=jQuery(".class-detail .bike-number");(null===a.facilityStudioLayoutId||0===a.facilityStudioLayoutId)&&d.text("BOOKED");var l=jQuery(".class-detail .spots-left");l.addClass("hidden")}else{var n=h.msg;c&&c.result&&!c.result.reservationSuccess&&c.result.showWaitlist?(c.waitlistDetail&&(c.result.isClassFull=!0),b.updateCTANLabel(c)):c&&c.error[0]&&c.error[0].userFriendlyDescription&&""!==c.error[0].userFriendlyDescription&&(n=c.error[0].userFriendlyDescription,
m.showBubble(n,1e4))}},error:function(a){debug("server error",a.responseJSON),i.showError()}})},b.cancelClass=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var h=APIEndpoint+"/bookaclass/"+a.classInstanceId+"/cancel";t.showLoader(),jQuery.ajax({type:"DELETE",url:h,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){if(debug("[BOOKCLASS OK]",a),t.hideLoader(),a.success){var c={},d="";jQuery.extend(c,e),b.jsonData.status.hasReservation=!1,b.jsonData.isOnCalendar=!1,j=l(_.extend(e,{options:[{title:f.BOOK.CTA,statusClass:f.BOOK.STATUSCLASS,bgClass:g.black},{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}]})),a.reservationStatus.isClassFull?(b.updateCTANLabel(a),d=b.jsonData.isCycling||b.jsonData.facilityStudioLayoutId&&+b.jsonData.facilityStudioLayoutId>0?f.CYCLING.CANCEL.CYCLING_WAITLIST:f.NON_CYCLING.CANCEL.NON_CYCLING_WAITLIST):(e=c,jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active"),jQuery(".bike-number").html("")),""!==d&&m.showBubble(d,1e4)}},error:function(a){debug("server error",a.responseJSON),t.showError()}})},b.updateCTANLabel=function(a){var b="",c="",d="",h={},j="",l="",n=a.waitlistDetail,o=jQuery(".class-detail .class-full"),p=a.result||a.reservationStatus;jQuery.extend(h,e),n&&n.isUserInWaitlist&&n.isWithInWaitlistPeriod?(b=i.USER_WAITLIST_STATUS,j=f.REMOVE_FROM_WAITLIST.CTA,l=f.REMOVE_FROM_WAITLIST.STATUSCLASS,c=f.ADD_TO_WAITLIST.BUBBLEMSG):n&&!n.isUserInWaitlist&&!n.isWaitlistFull&&n.isWithInWaitlistPeriod?(b="",1===+n.userCountInWaitlist&&(b=i.SINGLE_PERSON_WAITLIST_STATUS),+n.userCountInWaitlist>1&&(b=i.WAITLIST_STATUS),j=f.ADD_TO_WAITLIST.CTA,l=f.ADD_TO_WAITLIST.STATUSCLASS,c=f.REMOVE_FROM_WAITLIST.BUBBLEMSG,p&&p.isClassFull&&a.error&&a.error[0]&&(c=a.error[0].userFriendlyDescription)):(!n||n&&n.isWaitlistFull||!n.isWithInWaitlistPeriod)&&(p.isAddedToCalendar?(b=i.WAITLIST_FULL,j=f.REMOVE_FROM_CALENDAR,l=f.REMOVE_FROM_CALENDAR.STATUSCLASS):(b=i.SINGLE_PERSON_WAITLIST_FULL,n&&n.userCountInWaitlist>1&&(b=i.WAITLIST_FULL),j=f.ADD_TO_CALENDAR.CTA,l=f.ADD_TO_CALENDAR.STATUSCLASS),n&&!n.isWithInWaitlistPeriod&&(b="")),p&&p.isClassFull&&(o.text("ONLINE BOOKING NOW FULL.WALK-INS ONLY."),jQuery(".class-detail .bike-number").html("")),b=n?b.replace(/\{userCountInWaitlist\}/gi,n.userCountInWaitlist).replace(/\{userPositionInWaitlist\}/gi,n.userPositionInWaitlist):"",d=k(_.extend(e,{title:j,statusClass:l,subInfo:b,bgClass:g.white})),jQuery(".caption .buttons").html(d),""!==c&&m.showBubble(c,1e4),e=h},m.renderButtons=function(){if(user){c.classInstance=jQuery("nav.buttons").data("id"),d.classInstance=c.classInstance;var a=APIEndpoint3+"/classes/"+d.classInstance;b.init(a)}else j=k(_.extend(e,{title:f.TRY_CLASS.CTA,statusClass:f.TRY_CLASS.STATUSCLASS,bgClass:g.white})),jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").prop("href","#schedule-a-visit")},m.updateOptStatus=function(a,b,c){a.find(".loader, .error-box").remove();var d,e=APIEndpoint+"/classes/bikes/"+c+"/leaderoptout/"+b;d=EQ.Helpers.loaderAndErrorHandler(jQuery(".opt-status"),{type:"popup",color:"white",errorTitle:"Error"}),d.showLoader(),jQuery.ajax({type:"PUT",url:e,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){console.log(a),jQuery(this).prop("checked",!b),d.hideLoader()},error:function(a){debug("server error",a.responseJSON),d.showError()}})},m.updateOmniture=function(){if(jQuery(document).find(jQuery("#classDetailsInfo"))){window.tagData=window.tagData||{};var a=JSON.parse(jQuery("#classDetailsInfo").attr("data-component-options")),b=window.moment(a.startLocal).diff(a.facilityCurrenttime,"hours"),c=window.moment(a.startLocal).diff(a.facilityCurrenttime,"minutes");b&&(b=b>0?Math.floor(b):Math.ceil(b),0===b&&(b=c>0?1:-1)),window.tagData.classInstance={classId:a.classID,facilityId:a.facilityID,classInstanceId:a.classInstanceID,categoryId:a.categoryID,timeOffset:b.toString()}}},m.showBubble=function(a,b){jQuery(".buttons .overlay-box span").text(a),jQuery(".buttons .overlay-box").addClass("active"),setTimeout(function(){jQuery(".buttons .overlay-box").removeClass("active")},b)},m.getClassStatusButtonOption=function(a){var b="Online"===a.bookingType,c=a.isFinished,d=a.isOnCalendar,h=a.isCycling;if("undefined"!=typeof a.status&&""!==a.status){var m=a.status.reservationStartTimeLeft,n=m>0,o=a.status.isWithinReservationPeriod,p=a.status.isClassFull,q=a.status.isBookingClosedClassPending,r=a.status.hasReservation,s=null!==a.waitlist?!0:!1,t=null,u=null,v=null,w=null,x=null,y=!1,z=!1,A="",B=a.facilityStudioLayoutId,C=B&&B>0?!0:!1;s&&(t=a.waitlist.isWithInWaitlistPeriod,u=a.waitlist.isUserInWaitlist,v=a.waitlist.userCountInWaitlist,w=+(a.waitlist.userPositionInWaitlist||-1),x=a.waitlist.waitlistCapacity,y=v===x?!0:!1,z=!y||u),b?n?j=k(d?_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}):_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white})):o?p?r?j=C?l(_.extend(e,{options:[{title:f.CYCLING.CANCEL.CTA,statusClass:f.CYCLING.CANCEL.STATUSCLASS,bgClass:g.black},{title:f.CYCLING.SWITCH.CTA,statusClass:f.CYCLING.SWITCH.STATUSCLASS,bgClass:g.white}]})):k(_.extend(e,{title:f.NON_CYCLING.CANCEL.CTA,statusClass:f.NON_CYCLING.CANCEL.STATUSCLASS,bgClass:g.white})):s&&z&&t?u?j=k(_.extend(e,{title:f.REMOVE_FROM_WAITLIST.CTA,statusClass:f.REMOVE_FROM_WAITLIST.STATUSCLASS,bgClass:g.white,subInfo:i.USER_WAITLIST_STATUS.replace(/\{userPositionInWaitlist\}/gi,w).replace(/\{userCountInWaitlist\}/gi,v)})):(A="",1===+v?A=i.SINGLE_PERSON_WAITLIST_STATUS:+v>1&&(A=i.WAITLIST_STATUS),j=k(_.extend(e,{title:f.ADD_TO_WAITLIST.CTA,statusClass:f.ADD_TO_WAITLIST.STATUSCLASS,bgClass:g.white,subInfo:A.replace(/\{userCountInWaitlist\}/gi,v)}))):d?(A="",s&&y&&t&&(1===+v?A=i.SINGLE_PERSON_WAITLIST_FULL:+v>1&&(A=i.WAITLIST_FULL),A=A.replace(/\{userCountInWaitlist\}/gi,v).replace(/\{userPositionInWaitlist\}/gi,w)),j=k(_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white,subInfo:A}))):(A="",s&&y&&t&&(1===+v?A=i.SINGLE_PERSON_WAITLIST_FULL:+v>1&&(A=i.WAITLIST_FULL),A=A.replace(/\{userCountInWaitlist\}/gi,v)),j=k(_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white,subInfo:A}))):j=r?h||C?l(_.extend(e,{options:[{title:f.CYCLING.CANCEL.CTA,statusClass:f.CYCLING.CANCEL.STATUSCLASS,bgClass:g.black},{title:f.CYCLING.SWITCH.CTA,statusClass:f.CYCLING.SWITCH.STATUSCLASS,bgClass:g.white}]})):k(_.extend(e,{title:f.NON_CYCLING.CANCEL.CTA,statusClass:f.NON_CYCLING.CANCEL.STATUSCLASS,bgClass:g.white})):l(d?_.extend(e,{options:[{title:f.BOOK.CTA,statusClass:f.BOOK.STATUSCLASS,bgClass:g.black},{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}]}):_.extend(e,{options:[{title:f.BOOK.CTA,statusClass:f.BOOK.STATUSCLASS,bgClass:g.black},{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}]})):q?j=k(r?d?_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}):_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}):d?_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}):_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white})):c&&(j=r&&d?l(_.extend(e,{options:[{title:f.EDIT_CALORIES.CTA,statusClass:f.EDIT_CALORIES.STATUSCLASS,bgClass:g.black},{title:f.REMOVE_WORKOUT.CTA,statusClass:f.REMOVE_WORKOUT.STATUSCLASS,bgClass:g.white}]})):k(_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}))):j=k(d?_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}):_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}))}else j=k(d?_.extend(e,{title:f.REMOVE_FROM_CALENDAR.CTA,statusClass:f.REMOVE_FROM_CALENDAR.STATUSCLASS,bgClass:g.white}):_.extend(e,{title:f.ADD_TO_CALENDAR.CTA,statusClass:f.ADD_TO_CALENDAR.STATUSCLASS,bgClass:g.white}));return j},b.addWaitlist=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var h,l=APIEndpoint+"/bookaclass/"+a.classInstanceId+"/addtowaitlist/";t=EQ.Helpers.loaderAndErrorHandler(jQuery(".caption .loader-div"),{color:"black",errorTitle:"Error"}),t.showLoader(),h=jQuery.ajax({type:"POST",url:l,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json"}),h.done(function(a){t.hideLoader(),debug("[Add Waitlist OK]",a),a&&a.waitlistSuccess?(j=k(_.extend(e,{title:f.REMOVE_FROM_WAITLIST.CTA,statusClass:f.REMOVE_FROM_WAITLIST.STATUSCLASS,bgClass:g.white,subInfo:i.USER_WAITLIST_STATUS.replace(/\{userPositionInWaitlist\}/gi,a.userPositionInWaitlist).replace(/\{userCountInWaitlist\}/gi,a.userCountInWaitlist)})),jQuery.extend(b.jsonData.waitlist,_.omit(a,"waitlistSuccess")),jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active"),m.showBubble(f.ADD_TO_WAITLIST.BUBBLEMSG,5e3)):a&&a.error&&a.error[0].errorCode&&m.showBubble(a.error[0].userFriendlyDescription,1e4)}).fail(function(a){debug("server error",a.responseJSON),t.showError()})},b.removeWaitlist=function(a,c){try{event.preventDefault()}catch(d){c.preventDefault()}var h,l=APIEndpoint+"/bookaclass/"+a.classInstanceId+"/removefromwaitlist/"+a.waitlist.waitlistId;t=EQ.Helpers.loaderAndErrorHandler(jQuery(".caption .loader-div"),{color:"black",errorTitle:"Error"}),t.showLoader(),h=jQuery.ajax({type:"DELETE",url:l,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json"}),h.done(function(c){if(t.hideLoader(),debug("[REMOVE_FROM_WAITLIST OK]",a),c)if(c.error&&c.error[0].errorCode)m.showBubble(c.error[0].userFriendlyDescription,1e4);else{var d="";1===+c.userCountInWaitlist?d=i.SINGLE_PERSON_WAITLIST_STATUS:+c.userCountInWaitlist>1&&(d=i.WAITLIST_STATUS),j=k(_.extend(e,{title:f.ADD_TO_WAITLIST.CTA,statusClass:f.ADD_TO_WAITLIST.STATUSCLASS,bgClass:g.white,subInfo:d.replace(/\{userCountInWaitlist\}/gi,c.userCountInWaitlist)})),jQuery.extend(b.jsonData.waitlist,_.omit(c,"waitlistSuccess")),jQuery(".caption .buttons").html(j),jQuery(".caption .buttons a").addClass("active")}}).fail(function(a){debug("server error",a.responseJSON),t.showError()})};var t;m.init=function(a){console.log(a),t=t||EQ.Helpers.loaderAndErrorHandler(jQuery(".caption .loader-div"),{color:"black"}),EQ.Helpers.user.getFavorites(function(a){var b=new p({favoritesData:a});b.render()}),m.renderButtons(),m.updateOmniture()},jQuery(document).ready(function(){jQuery(".buttons").on("click",".add-to-calendar",function(a){b.addClass(b.jsonData,a)}),jQuery(".buttons").on("click",".remove-from-calendar",function(a){b.removeClass(b.jsonData,a)}),jQuery(".buttons").on("click",".book-class",function(a){b.bookClass(b.jsonData,a)}),jQuery(".buttons").on("click",".cancel-class",function(a){b.cancelClass(b.jsonData,a)}),jQuery(".buttons").on("click",".switch-bike",function(){window.location.href="/bookaclass/detail/"+b.jsonData.classInstanceId}),jQuery(".buttons").on("click",".add-to-waitlist",function(a){b.addWaitlist(b.jsonData,a)}),jQuery(".buttons").on("click",".remove-from-waitlist",function(a){b.removeWaitlist(b.jsonData,a)}),jQuery("a.allStudioCyclingClass").on("click",function(){})})}(window.App),function(a,b){"use strict";var c=b.Pages.ClassOverview={},d={fillRegionClubDropdown:function(){var b={};return jQuery.each(a.allRegionsData,function(a,c){var d=[];if(c&&c.SubRegions&&c.SubRegions.length){var e=[];jQuery.each(c.SubRegions,function(a,b){e=e.concat(b.Facilities)}),jQuery.each(e,function(a,b){d.push(b.Id)}),b[c.Name]=d}else jQuery.each(c.Facilities,function(a,b){d.push(b.Id)}),b[c.Name]=d}),b},generateDropdown:function(){var a=d.fillRegionClubDropdown(),b=new e({model:a});jQuery(".select-placeholder").append(b.render().el)},sortDataByDay:function(a){var b=moment().startOf("day").format("YYYY-MM-DD"),c=moment(b).add(1,"day").format("YYYY-MM-DD"),d=moment(c).add(1,"day").format("YYYY-MM-DD"),e={},f=[],g=[],h=[],i=[],j=_.pluck(a,"startLocal");return jQuery.each(a,function(){moment(this.startLocal).format("YYYY-MM-DD")===b?f.push(this):moment(this.startLocal).format("YYYY-MM-DD")===c?g.push(this):moment(this.startLocal).format("YYYY-MM-DD")===d&&h.push(this)}),jQuery.each(j,function(a,b){i.push(moment(b).format("hh:mm A"))}),e.today=f,e.tomorrow=g,e.dayAfterTomorrow=h,e.classTime=i,e}},e=Backbone.View.extend({tagName:"select",className:"class-overview-select",template:_.template(jQuery("#classOverviewSelectTemplate").html()),events:{change:"generateList"},render:function(){return this.jQueryel.html(this.template({lists:this.model})),this},generateList:function(a){var b=jQuery(a.target).find("option:selected").val(),c=new g,d=moment().startOf("day").format("YYYY-MM-DD"),e=moment(d,"YYYY-MM-DD").add(3,"days"),f=/\d+/g;c.configRequest({startDate:d,endDate:moment(e).format("YYYY-MM-DD"),facilityIds:b.split(",")||[],classIds:window.location.pathname.match(f)||[]}),c.fetch({data:{facilityIds:c.facilityIds,startDate:c.startDate,endDate:c.endDate,classIds:c.classIds,isBookingRequired:!1},dataType:"json",method:"POST",xhrFields:{withCredentials:!0},success:function(a,b){var c=new h,d=new j;c.render(b),d.render(a)},error:function(a){console.log(a)}})}}),f=Backbone.Model.extend({}),g=Backbone.Collection.extend({model:f,configRequest:function(a){this.facilityIds=a.facilityIds,this.startDate=a.startDate,this.endDate=a.endDate,this.classIds=a.classIds},url:APIEndpoint+"/classes/allclasses"}),h=Backbone.View.extend({tagName:"div",className:"result-view",template:_.template(jQuery("#classOverviewTemplate").html()),render:function(a){var b=this,c=d.sortDataByDay(a.classes),e=this.generateRowsData(c);this.jQueryel.html(this.template());var f={};Object.keys(e).sort(function(a,b){return new Date("1970/01/01 "+a)-new Date("1970/01/01 "+b)}).forEach(function(a){f[a]=e[a]}),jQuery.each(f,function(a,c){var d=b.getTimeSlot(c),e=new i;c.displayTime=a,"morning"===d.toLowerCase()?b.jQueryel.find(".morning ul.class-list").append(e.render({model:c})):"afternoon"===d.toLowerCase()?b.jQueryel.find(".afternoon ul.class-list").append(e.render({model:c})):"evening"===d.toLowerCase()&&b.jQueryel.find(".evening ul.class-list").append(e.render({model:c}))}),jQuery(".class-container").html(b.el),jQuery(".goto-class-search").removeClass("hidden"),this.setupHeading(c),jQuery(".day-after-tomorrow-heading h4").html(this.setDaysHeading())},setupHeading:function(a){var b="",c="",d="";b=a.today.length?a.today.length+" ":"",b+=this.getClassText(a.today.length),c=a.tomorrow.length?a.tomorrow.length+" ":"",c+=this.getClassText(a.tomorrow.length),d=a.dayAfterTomorrow.length?a.dayAfterTomorrow.length+" ":"",d+=this.getClassText(a.dayAfterTomorrow.length),jQuery(".class-container").find(".today-heading span").html("("+b+")"),jQuery(".class-container").find(".tomorrow-heading span").html("("+c+")"),jQuery(".class-container").find(".day-after-tomorrow-heading span").html("("+d+")")},setDaysHeading:function(){var a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b=moment().day(),c=(b+2)%7;return a[c]},getClassText:function(a){return 0===a?"No Class":1===a?"Class":a>1?"Classes":void 0},generateRowsData:function(a){var b={};return jQuery.each(a.classTime,function(c,d){var e=_.filter(a.today,function(a){return moment(a.startLocal).format("hh:mm A")===d?a:void 0}),f=_.filter(a.tomorrow,function(a){return moment(a.startLocal).format("hh:mm A")===d?a:void 0}),g=_.filter(a.dayAfterTomorrow,function(a){return moment(a.startLocal).format("hh:mm A")===d?a:void 0});b[d]={today:e,tomorrow:f,dayAfterTomorrow:g}}),b},getTimeSlot:function(a){return a.today.length?a.today[0].timeSlot:a.tomorrow.length?a.tomorrow[0].timeSlot:a.dayAfterTomorrow.length?a.dayAfterTomorrow[0].timeSlot:void 0}}),i=Backbone.View.extend({template:_.template(jQuery("#classSingleTemplate").html()),render:function(a){return this.template(a)}}),j=Backbone.View.extend({el:".goto-class-search",render:function(a){var b=a.classIds.toString(),c=a.facilityIds.toString();a.classIds.length>1&&(b=a.classIds[0]),""!==b&&(b="classes="+b),""!==c&&(c="&clubs="+c),this.jQueryel.find(".goto-link").attr("href","/classschedule?"+b+c)}});c.init=function(){d.generateDropdown()}()}(window,window.App),function(a,b){"use strict";var c=b.Pages.Club={};c.icon=function(){return'<div class="custom-marker active"><span class="icon-marker-o"></span></div>'},c.onMapsLoaded=function(){c.Map=new EQ.Maps.Map(c.ui.jQuerymapContainer[0]);var a=EQ.Helpers.getRegionByTitle(c.region);a&&c.Region.select(a);var b=c.Map.markers.find(c.club.Latitude,c.club.Longitude);c.Map.fit([c.club],-3),b&&(debug("[ClubDetail] Setting marker open:",b),b.setAnchor(RichMarkerPosition.TOP),b.setContent(c.icon(c.club)))},c.Club={parse:function(a){return EQ.Helpers.setPositionGetter(a),c.Map.markers.add({lat:a.Latitude,lng:a.Longitude,content:c.Icon.Marker.regular(),click:function(){EQ.Maps.trigger("CLUB_MARKER_CLICK",{facility:a,marker:this})}},!0),this},showAll:function(){if(!this._facilities){var a=[];jQuery.each(c.Data,function(b,c){a=a.concat(EQ.Helpers.getAllFacilities(c))}),this._facilities=a}jQuery.each(this._facilities,function(a,b){c.Club.parse(b)})}},c.Icon={Marker:{regular:function(){return'<div class="custom-marker"><span class="icon-marker-dot"></span></div>'}}},c.Region={select:function(a){a.bounds||(a.bounds=EQ.Maps.Bounds(c.getChildrenPoints(a))),this.showClubs(a)},showClubs:function(a){c.Map.fitBounds(a.bounds),c.Club.showAll()}},c.getChildrenPoints=function(a){var b=this,c=[];return a.SubRegions&&a.SubRegions.length?jQuery.each(a.SubRegions,function(a,d){c=c.concat(b.getChildrenPoints(d))}):a.Facilities.length&&(c=jQuery.map(a.Facilities,function(a){return a.Latitude&&a.Longitude?EQ.Maps.Point({lat:a.Latitude,lng:a.Longitude}):void console.error("A club doesn't have Lat Lng properties.",a)})),c},c.toggleMapContainer=function(a){a.preventDefault(),jQuery(a.currentTarget).closest(".club-finder-map").children("div").toggle(),this.mapLoaded||(EQ.Maps.Load(this.onMapsLoaded),this.mapLoaded=!0)},c.events=function(){this.ui.jQuerytoggleMapContainer.on("click",_.bind(this.toggleMapContainer,this)),this.ui.jQuerynativeMapTrigger.attr("href",a.EQ.Helpers.getDeviceMapURL(c.club))},c.ui={jQuerymapContainer:jQuery(".map-container"),jQuerytoggleMapContainer:jQuery(".toggleMapContainer"),jQuerynativeMapTrigger:jQuery(".native-map-trigger")},c.ClassModel=Backbone.Model.extend({}),c.ClassCollection=Backbone.Collection.extend({model:c.ClassModel,configRequest:function(a){this.facilityIds=a.facilityIds,this.startDate=a.startDate,this.endDate=a.endDate},url:APIEndpoint+"/classes/allclasses"}),c.ClassOverlay=Backbone.View.extend({template:_.template(jQuery("#class-overlay-template").html()),render:function(a){jQuery("body").append(this.template({data:a})),b.loadComponent("class-schedule-classes",jQuery(".class-overlay")),jQuery("body .close-overlay").on("click",this.destroyOverlay),jQuery("body").addClass("overflow-popover")},destroyOverlay:function(a){a.preventDefault(),EQ.Helpers.abortAllService.abortAll(),jQuery("body").removeClass("overflow-popover"),jQuery("body").find(".class-overlay-container").remove()}}),c.ClassView=Backbone.View.extend({el:".upcoming-classes",template:_.template(jQuery("#upcoming-classes-template").html()),events:{"click .class-overlay-btn":"launchOverlay"},render:function(a,b){var c={};c.classes=_.sortBy(b.classes,"startLocal");var d=moment().format();c.sortedClasses=[],_.filter(c.classes,function(a){moment(a.startLocal).diff(moment(d))>0&&c.sortedClasses.push(a)}),c.classesToShow=3,c.facilityId=a.facilityIds,this.jQueryel.html(this.template({data:c}))},launchOverlay:function(){var a=EQ.Helpers.getFacilityById(c.clubId),b=new c.ClassOverlay;b.render(a)}}),c.GetClasses=function(a){var b=moment().format("YYYY-MM-DD"),d=moment().add(6,"days").format("YYYY-MM-DD"),e=new c.ClassCollection;e.configRequest({startDate:b,endDate:d,facilityIds:a||[]}),e.fetch({data:{facilityIds:e.facilityIds,startDate:e.startDate,endDate:e.endDate},dataType:"json",method:"POST",xhrFields:{withCredentials:!0},success:function(a,b){var d=new c.ClassView;d.render(a,b)},error:function(a){console.log(a)}})},c.ServiceHourKidsView=Backbone.View.extend({template:_.template(jQuery("#service-hour-kids-template").html()),render:function(a,b,c){c.find(".kid-hours.service-hours-main-block").html(this.template({dataKids:b}))}}),c.ServiceHourSpaView=Backbone.View.extend({template:_.template(jQuery("#service-hour-spa-template").html()),render:function(a,b,c){c.find(".spa-hours.service-hours-main-block").html(this.template({dataSpa:b}))}}),c.FacilityDataCollection=Backbone.Collection.extend({url:APIEndpoint+"/facilities/"+jQuery(".club-info").data("clubId")}),c.EventFeedUrlModel=Backbone.Model.extend(),c.EventFeedurlCollection=Backbone.Collection.extend({model:c.EventFeedUrlModel,url:jQuery(".events-feed-url").val()}),c.UpcomingEventsView=Backbone.View.extend({el:".upcoming-event-view",template:_.template(jQuery("#upcoming-events-template").html()),render:function(a){var b=a.models[0].toJSON().result,c={};Object.keys(b).sort().reverse().forEach(function(a,d){1>=d&&(c[a]=b[a])}),this.jQueryel.find(".upcoming-events-block").html(this.template({dataEvents:c}))}}),c.weekClassCount=function(a){var b=moment().startOf("isoweek").format("YYYY-MM-DD"),d=moment(b).endOf("isoWeek").add(1,"day").format("YYYY-MM-DD"),e=new c.ClassCollection;e.configRequest({startDate:b,endDate:d,facilityIds:a||[]}),e.fetch({data:{facilityIds:e.facilityIds,startDate:e.startDate,endDate:e.endDate},dataType:"json",method:"POST",xhrFields:{withCredentials:!0},success:function(a,b){var d=new c.WeeklyClassCountView;d.render(a,b)},error:function(a){console.log(a)}})},c.WeeklyClassCountView=Backbone.View.extend({el:".weekly-class-count",render:function(a,b){this.jQueryel.find(".inner-content .title").html(b.classes.length)}}),c.ClubInfoView=Backbone.View.extend({el:".club-info",template:_.template(jQuery("#club-info-template").html()),render:function(){var a=this.jQueryel.data("clubId");a&&(this.jQueryel.html(this.template({model:EQ.Helpers.getFacilityById(a)})),this.getServiceHours(),jQuery(".events-feed-url").length>0&&this.getEventDetails())},renderPreSaleHours:function(a,b){if(b.facility.salesServiceHours.length>0){var c='<p class="time-slot">';_.each(b.facility.salesServiceHours,function(a,d){c+="<strong>"+_.unescape(a.days)+"</strong> "+a.hours+(b.facility.salesServiceHours.length!==d?"<br />":"")}),c+="</p>",jQuery("#presaleHours").html(c)}},renderAmenitiesLinks:function(){jQuery.each(jQuery(".special-service-hours, .simple-service-hours"),function(){if(!jQuery(this).find(".service-hours").is(":empty")){var a=jQuery("<li/>"),b=jQuery(this).find(".feature-info .header").text(),c=b.toLowerCase().split(" ").join("-");a.append(jQuery("<a/>",{text:""+b+" Hours",href:"#"+c})),jQuery(".amenities-links").append(a),jQuery(this).attr("id",c)}}),jQuery(".amenities-links:not(:empty)")&&jQuery(".amenities-links").removeClass("hidden")},renderServiceHours:function(a,b,d){var e=a.data("isSpaHours")&&"true"===a.data("isSpaHours").toLowerCase()?!0:!1;if(d.facility.kidsClubServiceHours.length>0&&!e){var f=new c.ServiceHourKidsView;f.render(b,d,a)}if(d.facility.spaServicesHours.length>0&&e){var g=new c.ServiceHourSpaView;g.render(b,d,a)}(0===d.facility.kidsClubServiceHours.length&&a.find(".service-hours").hasClass("kid-hours")||0===d.facility.spaServicesHours.length&&a.find(".service-hours").hasClass("spa-hours"))&&a.parents(".simple-service-hours").remove()},getServiceHours:function(){var a=new c.FacilityDataCollection,b=this;a.fetch({success:function(a,c){jQuery(".simple-service-hours .feature-block").each(function(d,e){b.renderServiceHours(jQuery(e),a,c)}),c.facility.isPresale&&b.renderPreSaleHours(a,c),b.renderAmenitiesLinks()},error:function(a){console.log(a)}})},buildLoader:function(a){var b=EQ.Helpers.loaderAndErrorHandler(a.find(".loaderAnim"),{color:"black"});return this.loaderAndError=b,b},getEventDetails:function(){var a=new c.EventFeedurlCollection,b=this.buildLoader(jQuery(".upcoming-event-view"));b.showLoader(),a.fetch({success:function(a){b.hideLoader();var d=new c.UpcomingEventsView;d.render(a)},error:function(){b.showError()}})}}),c.setSectionsVisible=function(){var a=jQuery(window).scrollTop(),b=.6*jQuery(window).height(),c=a+b;jQuery(window).width()<=768?jQuery(".club-detail .module .row > div:not(.fadeIn)").each(function(){var a=jQuery(this).offset().top;c>=a&&jQuery(this).addClass("fadeIn")}):jQuery(".club-detail .module:not(.fadeIn)").each(function(){var a=jQuery(this).offset().top;c>=a&&jQuery(this).addClass("fadeIn")})},c.getVisible=function(a){var b=jQuery(window).scrollTop(),c=b+jQuery(window).height(),d=a.offset().top,e=d+a.outerHeight(),f=b>d?b:d,g=e>c?c:e;return g-f},c.SocialStickyFooter=function(){if(jQuery(".social-module-footer").length&&jQuery(".social-module-footer").parents(".module").next(".module").length){var a=jQuery(window).scrollTop(),b=jQuery(window).outerHeight()-jQuery(".social-module-footer").outerHeight(),c=a+b,d=jQuery(".social-module-footer").parents(".module").next().offset().top-(jQuery("nav.main").outerHeight()+jQuery(".social-module-footer").outerHeight()),e=jQuery("footer").offset().top-parseInt(jQuery("footer").css("margin-top"),10);if(jQuery(".club-detail .module:last-child #lead-page-wrapper").css({"margin-bottom":0}),jQuery(".social-module-footer-copy").find(".social-module-footer").length||jQuery(".social-module-footer-copy").html(jQuery(".social-module-footer").html()).css({visibility:"hidden"}),jQuery(window).innerWidth()<768&&-1!==navigator.userAgent.indexOf("Safari")&&jQuery("body").css({overflow:"auto","-webkit-overflow-scrolling":"touch"}),c>d&&!jQuery(".social-module-footer").hasClass("stick-bottom"))return console.log("stucked!!!!!!!!!!!"),void jQuery(".social-module-footer").addClass("stick-bottom");if(d>c&&jQuery(".social-module-footer").hasClass("stick-bottom"))return console.log("removed!!!!!!!!!!!"),void jQuery(".social-module-footer").removeClass("stick-bottom");Math.round(e)<=Math.round(c)?(jQuery(".social-module-footer").css({visibility:"hidden"}),jQuery(".social-module-footer-copy").css({visibility:"visible"})):(jQuery(".social-module-footer").css({visibility:"visible"}),jQuery(".social-module-footer-copy").html("").css({visibility:"hidden"}))}else jQuery(".social-module-footer-copy").addClass("hidden")},c.HandleKeybord=function(){jQuery(window).width()<768&&(jQuery(document).on("focus","input, textarea",function(a){a.preventDefault(),jQuery(".social-module-footer").hasClass("stick-bottom")&&jQuery(".social-module-footer").addClass("hidden")}),jQuery(document).on("blur","input, textarea",function(a){a.preventDefault(),jQuery(".social-module-footer").hasClass("stick-bottom")&&jQuery(".social-module-footer").removeClass("hidden")}))},c.stickyModuleHeaders=function(){if(jQuery(".module-header").length){var a=jQuery(window).scrollTop(),b=jQuery("nav.main").height(),c=jQuery(".module-header").eq(0).offset().top-b,d=jQuery("#lead-page-wrapper").length?jQuery("#lead-page-wrapper").parents(".module").offset().top:null;jQuery(".module-header").each(function(){var e=0;e=jQuery(this).parents(".module").nextAll(".tpl-club-module-header").length?jQuery(this).parents(".module").nextAll(".tpl-club-module-header").eq(jQuery(this).parents(".module").nextAll(".tpl-club-module-header").length-1).offset().top+(jQuery(this).parents(".module").nextUntil(".tpl-club-module-header").eq(jQuery(this).parents(".module").nextAll(".tpl-club-module-header").length-1).outerHeight()-b):jQuery(this).parents(".module").siblings(":last").length&&jQuery(this).parents(".module").siblings(":last").find(".social-module-footer").length?jQuery(this).parents(".module").siblings(":nth-last-child(2)").offset().top:jQuery(this).parents(".module").siblings(":last").length&&!jQuery(this).parents(".module").siblings(":last").find("#lead-page-wrapper").length?jQuery(this).parents(".module").siblings(":last").offset().top+(jQuery(this).parents(".module").siblings(":last").outerHeight()-b):jQuery(this).parents(".module").siblings(":nth-last-child(2)").offset().top+(jQuery(this).parents(".module").siblings(":nth-last-child(2)").outerHeight()-b);var f=jQuery(this).offset().top;a>=f-b&&(jQuery(".stickModuleHeader").html(jQuery(this).html()).addClass("changed"),jQuery(window).innerWidth()>768?jQuery(".stickModuleHeader").css({top:b,"font-size":f-a>=24?42>=f-a?f-a:42:24}):jQuery(".stickModuleHeader").css({top:b,"font-size":f-a>=24?30>=f-a?f-a:30:24})),null!==d&&a>=d&&jQuery(".stickModuleHeader").removeClass("changed"),c>=a&&jQuery(".stickModuleHeader").removeClass("changed")})}},c.onScrollFunctions=function(){jQuery('.club-highlights [data-is-club-highlight="true"]').length&&(jQuery(".club-detail").addClass("has-highlights"),c.setSectionsVisible()),c.SocialStickyFooter(),c.stickyModuleHeaders()},c.init=function(b,d,e){if(c.clubId=currentClub,c.club=a.EQ.Helpers.getFacilityById(c.clubId),jQuery(".club-info").data("clubId")){jQuery(".upcoming-classes").length&&c.GetClasses(c.club.Id),jQuery(".weekly-class-count").length&&c.weekClassCount(c.club.Id);var f=new c.ClubInfoView;f.render(),c.onScrollFunctions(),jQuery(window).width()<768&&c.HandleKeybord(),jQuery(window).on("load resize scroll touchmove",c.onScrollFunctions),jQuery(".page").append('<div class="social-module-footer-copy" style="visibility: hidden; margin-top: -40px"></div>')}debug("[ClubDetail] init:",b,d,e),c.region=b,c.Data=a.allRegionsData,c.mapLoaded=!1,c.events(),jQuery(window).width()>1023&&jQuery(".hero-image-sports-club").hover(function(){jQuery(".owl-prev").stop().animate({left:"40px",opacity:"1"}),jQuery(".owl-next").stop().animate({right:"40px",opacity:"1"}),jQuery(".hero-image-sports-club .feature-info").stop().animate({opacity:"0"}),jQuery(".for-fitness-club").stop().animate({opacity:"0"})},function(){jQuery(".owl-prev").stop().animate({left:"0",opacity:"0"}),jQuery(".owl-next").stop().animate({right:"0",opacity:"0"}),jQuery(".hero-image-sports-club .feature-info").stop().animate({opacity:"1"}),jQuery(".for-fitness-club").stop().animate({opacity:"1"})}),jQuery("body").append('<div class="stickModuleHeader"></div>')}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Clubs={};c.Club={parse:function(a){return EQ.Helpers.setPositionGetter(a),c.Map.markers.add({lat:a.Latitude,lng:a.Longitude,content:c.Icon.Marker.regular(),click:function(){EQ.Maps.trigger("CLUB_MARKER_CLICK",{facility:a,marker:this})}},!0),this},showAll:function(){if(!this._facilities){var a=[];jQuery.each(c.Data,function(b,c){a=a.concat(EQ.Helpers.getAllFacilities(c))}),this._facilities=a}jQuery.each(this._facilities,function(a,b){c.Club.parse(b)})},getLink:function(a){return a.URL||"/clubs/"+a.ShortName}},c.Icon={Marker:{regular:function(){return'<div class="custom-marker"><span class="icon-marker-dot"></span></div>'}}},c.onMapsLoaded=function(){var a=EQ.Helpers.getRegionByTitle(jQuery(".clubs-region").data("region")),b={},d=a.Name||a;"canada"===d.toLowerCase()&&(b={zoom:5,minZoom:5,maxZoom:16}),c.Map=new EQ.Maps.Map(c.ui.jQuerymapContainer[0],b),a&&c.Region.select(a),console.log(b)},c.Region={select:function(a){a.bounds||(a.bounds=EQ.Maps.Bounds(c.getChildrenPoints(a))),this.showClubs(a)},showClubs:function(a){c.Map.fitBounds(a.bounds),c.Club.showAll()}},c.getChildrenPoints=function(a){var b=this,c=[];return a.SubRegions&&a.SubRegions.length?jQuery.each(a.SubRegions,function(a,d){c=c.concat(b.getChildrenPoints(d))}):a.Facilities.length&&(c=jQuery.map(a.Facilities,function(a){return console.log(a),a.Latitude&&a.Longitude?EQ.Maps.Point({lat:a.Latitude,lng:a.Longitude}):void console.error("A club doesn't have Lat Lng properties.",a)})),c},c.toggleMapContainer=function(a){a.preventDefault(),jQuery(a.currentTarget).closest(".club-finder-map").children("div").toggle(),this.mapLoaded||(EQ.Maps.Load(this.onMapsLoaded),this.mapLoaded=!0)},c.events=function(){this.ui.jQuerytoggleMapContainer.on("click",_.bind(this.toggleMapContainer,this))},c.ui={jQuerymapContainer:jQuery(".map-container"),jQuerytoggleMapContainer:jQuery(".toggleMapContainer")},c.init=function(){c.Data=a.allRegionsData,c.mapLoaded=!1,c.events()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.ConnnectAccounts={},d=jQuery("form.login");c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&b.Pages.ConnnectAccounts.getToken(function(b){d.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:!0},function(d,e,f){if(202===f.status){if("LegacyUser"===d.code)return void c.ChangeLegacyUserName(d);if("SpaOnlyUser"===d.code)return void jQuery(".is-error").removeClass("hidden").html(d.reasonPhrase.replace("{signin}",'<a href="/login">sign in</a>'))}var g={facebookAccessToken:b
};jQuery.ajax(APIEndpoint+"/registration/linkwithfacebook",{data:JSON.stringify(g),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){"function"==typeof window.track&&window.track("regConnectedWithFB"),debug("[Connect] Ready"),EQ.Helpers.refreshUserCacheData(function(){var b=window.returnUrl||"/";a.location.href=b})}).fail(function(a){var b="";a.responseJSON.message&&(b=a.responseJSON&&a.responseJSON.message),a.responseJSON.error&&(b=a.responseJSON.error&&a.responseJSON.error.message),debug("[FBLogin] Failed",b),b&&jQuery(".is-error").removeClass("hidden").text(b)})})})},c.getToken=function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse.accessToken)},{scope:"email,user_likes,user_friends"})},c.init=function(){debug("[Connect] Init"),d.on("submit",function(a){a.preventDefault(),c.validateAndSubmit()}),d.on("click","#changeUsername",function(a){a.preventDefault(),c.ChangeLegacyUserName(jQuery(this).data())})},c.ChangeLegacyUserName=function(a){var b=jQuery("<form />");b.attr("action","/help/change/username").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","email").val(a.email),d=jQuery('<input type="hidden"/>').attr("name","userName").val(a.userName);b.append(c),b.append(d),jQuery("body").append(b),b.submit()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.CorpJoinRequest={};c.RELATIONSHIP_OPTIONS={MYSELF:"MYSELF",FAMILY_MEMBER:"FAMILY MEMBER"},c.dom={jQueryhtmlBody:jQuery("html, body"),jQueryappMain:jQuery("#app-main"),jQuerysiteNavigation:jQuery("nav.main")},c.sendingData={},c.helper={scrollWindow:function(a){a=_.isUndefined(a)?c.dom.jQueryappMain:a,c.dom.jQueryhtmlBody.animate({scrollTop:a.offset().top-c.dom.jQuerysiteNavigation.height()})},sendRequest:function(a){jQuery.ajax({type:a.type,url:a.url,data:a.data,contentType:"application/json",xhrFields:{withCredentials:!0},headers:{"Eqx-Version":"1"}}).success(a.success).error(a.error)},fillRegionClubDropdown:function(b){var c="Select a Region",d="You must select a Region first",e=b.jQueryregion.find("select"),f=b.jQueryclub.find("select"),g='<option data-slug="">'+c+"</option>",h={};jQuery.each(a.allRegionsData,function(a,b){if(b&&b.SubRegions&&b.SubRegions.length){var c=[];g+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",jQuery.each(b.SubRegions,function(a,b){c=c.concat(b.Facilities)}),h[b.Name]=c}else g+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",h[b.Name]=b.Facilities}),e.html(g),f.prepend('<option selected data-id="">'+d+"</option>"),e.on("change",function(){var a=h[jQuery(this).val()],b="",c="Select a Club";a?(jQuery.each(a,function(a,c){(c.IsAvailableOnline!==!1||c.IsPresale!==!1)&&(b+='<option data-isPilateSurvey="'+c.IsSurveyPilot+'" data-id="'+c.Id+'">'+c.ClubName+"</option>")}),f.html(b),f.each(function(){var a=jQuery(this).children("option");a.sort(function(a,b){return a.value.localeCompare(b.value)}),jQuery(this).empty().append(a)}),f.prepend('<option selected data-id="">'+c+"</option>"),f.trigger("change")):(f.html('<option selected data-id="">'+d+"</option>"),f.siblings(".option").html(d))}),e.trigger("change")},toggleMemberId:function(a){var b=jQuery(a.e.target),c=parseInt(b.val(),10);c?1===c&&(a.dom.jQuerymemberIdCol.find(".error").length&&a.dom.jQuerymemberIdCol.find(".error").removeClass("error"),a.dom.jQuerymemberIdCol.show(),a.dom.jQuerymemberId.focus()):a.dom.jQuerymemberIdCol.hide()},showTooltip:function(a){a.e.stopPropagation();var b=jQuery(a.e.target),c=b.next(".overlay-box");c.hasClass("active")?c.removeClass("active"):c.addClass("active")},validateForm:function(a){var b={email:function(a){return/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},phone:function(a){return/^[0-9\-().\s]*jQuery/.test(a)},name:function(a){return/^[a-zA-Z-'"\s]+jQuery/.test(a)}},d=!0,e=!0;c.sendingData={personalEmail:jQuery.trim(a.dom.jQuerypersonalEmail.val()),primaryPhone:jQuery.trim(a.dom.jQueryprimaryPhone.val().replace(/[^0-9]/g,"")),regionName:a.dom.jQueryregion.find("select option").filter(":selected").data("slug"),facilityId:a.dom.jQueryclub.find("select option").filter(":selected").data("id"),isEquinoxMember:a.dom.jQueryequinoxMemberSelect.find("select").val(),memberId:1===parseInt(a.dom.jQueryequinoxMemberSelect.find("select").val(),10)?jQuery.trim(a.dom.jQuerymemberId.val()):null,benefitHolderFirstName:jQuery.trim(a.dom.jQueryempFirstName.val()),benefitHolderLastName:jQuery.trim(a.dom.jQueryempLastName.val()),benefitHolderPhone:jQuery.trim(a.dom.jQueryworkPhone.val().replace(/[^0-9]/g,"")),workEmail:jQuery.trim(a.dom.jQueryworkEmail.val())},a.context.jQuery(".error").removeClass("error"),a.dom.jQueryserverError.hide(),c.sendingData.regionName||this.addErrorClass(a.dom.jQueryregion),c.sendingData.facilityId||this.addErrorClass(a.dom.jQueryclub),a.whoIsThisFor===c.RELATIONSHIP_OPTIONS.FAMILY_MEMBER&&(c.sendingData.firstName=jQuery.trim(a.dom.jQueryfirstName.val()),c.sendingData.lastName=jQuery.trim(a.dom.jQuerylastName.val()),c.sendingData.firstName.length&&b.name(c.sendingData.firstName)||this.addErrorClass(a.dom.jQueryfirstName),c.sendingData.lastName.length&&b.name(c.sendingData.lastName)||this.addErrorClass(a.dom.jQuerylastName)),(c.sendingData.personalEmail.length<3||!b.email(c.sendingData.personalEmail))&&(this.addErrorClass(a.dom.jQuerypersonalEmail),d=!1),c.sendingData.primaryPhone.length&&b.phone(c.sendingData.primaryPhone)||this.addErrorClass(a.dom.jQueryprimaryPhone),c.sendingData.isEquinoxMember.length?""===c.sendingData.memberId&&(this.addErrorClass(a.dom.jQuerymemberId),a.dom.jQueryserverError.html(jQuery("#barcode-error-message").val()).show()):this.addErrorClass(a.dom.jQueryequinoxMemberSelect),c.sendingData.benefitHolderFirstName.length&&b.name(c.sendingData.benefitHolderFirstName)||this.addErrorClass(a.dom.jQueryempFirstName),c.sendingData.benefitHolderLastName.length&&b.name(c.sendingData.benefitHolderLastName)||this.addErrorClass(a.dom.jQueryempLastName),(c.sendingData.workEmail.length<3||!b.email(c.sendingData.workEmail))&&(this.addErrorClass(a.dom.jQueryworkEmail),e=!1),c.sendingData.benefitHolderPhone.length>1&&!b.phone(c.sendingData.benefitHolderPhone)&&this.addErrorClass(a.dom.jQueryworkPhone),d&&e&&jQuery.trim(c.sendingData.personalEmail)===jQuery.trim(c.sendingData.workEmail)&&(this.addErrorClass(a.dom.jQuerypersonalEmail),this.addErrorClass(a.dom.jQueryworkEmail),a.dom.jQueryserverError.html("Personal email can't be same as Work email!").show())},addErrorClass:function(a){a.addClass("error"),a.closest(".control").siblings(".control-title").addClass("error")},submitForm:function(a){a.e.preventDefault();var b=jQuery(a.e.target).find(":submit"),d=this,e={},f=null,g=null,h=c.RELATIONSHIP_OPTIONS.MYSELF.toLowerCase(),i=jQuery("#corpJoinActivationCode").val(),j=APIEndpoint+"/corp/join/request",k=null;if(this.validateForm({context:a.context,dom:a.dom,whoIsThisFor:a.whoIsThisFor}),a.context.jQuery(".error").length){var l;l=a.dom.jQueryserverError.is(":visible")?a.dom.jQueryserverError:c.dom.jQueryappMain.find(".control-title.error").eq(0),this.scrollWindow(l)}else a.whoIsThisFor===c.RELATIONSHIP_OPTIONS.FAMILY_MEMBER&&(h=c.RELATIONSHIP_OPTIONS.FAMILY_MEMBER.toLowerCase(),f=c.sendingData.firstName,g=c.sendingData.lastName),e=_.pick(c.sendingData,["personalEmail","primaryPhone","facilityId","memberId","benefitHolderFirstName","benefitHolderLastName","benefitHolderPhone","workEmail"]),_.assign(e,{firstName:f,lastName:g,membershipFor:h,activationCode:i}),a.dom.jQueryloader.show(),b.prop("disabled",!0),console.log("Form Data: ",e),this.sendRequest({type:"POST",url:j,data:window.JSON.stringify(e),success:function(f){if(d.scrollWindow(),f.success){var g=jQuery("#interedClubs option:selected").data("id");k=jQuery("#pilotFacilityIds").val().split(",");var h=_.contains(k,g.toString());if(h){var i=new c.ThankyouConfirmation;c.dom.jQueryappMain.html(i.render().jQueryel)}else{var j=new c.EmailConfirmation({model:{email:e.workEmail}});c.dom.jQueryappMain.html(j.render().jQueryel)}}else a.context.jQuery(".error").removeClass("error"),a.dom.jQueryserverError.html(f.errorMessage).show(),-1!==f.errorMessage.toLowerCase().search("email")?d.addErrorClass(a.dom.jQueryworkEmail):-1!==f.errorMessage.toLowerCase().search("barcode")&&d.addErrorClass(a.dom.jQuerymemberId),a.dom.jQueryloader.hide(),b.prop("disabled",!1)},error:function(c){var e=window.JSON.parse(c.responseText),f=e.message;try{f=_.isUndefined(f)?e.error.message:f,-1!==f.toLowerCase().search("email")?d.addErrorClass(a.dom.jQueryworkEmail):-1!==f.toLowerCase().search("barcode")&&d.addErrorClass(a.dom.jQuerymemberId)}catch(g){f="Unable to process your request! Please try again later."}d.scrollWindow(),a.dom.jQueryloader.hide(),b.prop("disabled",!1),a.dom.jQueryserverError.empty().html(f).show()}})}},c.Main=Backbone.View.extend({template:_.template(jQuery("#tpl-request-to-join-page").html()),render:function(){jQuery("html").addClass("corp-join-request"),this.jQueryel.html(this.template()),this.jQuerysectionWrapper=this.jQuery("#section-wrapper");var a=new c.RequestToJoinOption({jQuerysectionWrapper:this.jQuerysectionWrapper});this.jQuerysectionWrapper.html(a.render().jQueryel),c.dom.jQueryappMain.html(this.jQueryel)}}),c.RequestToJoinOption=Backbone.View.extend({template:_.template(jQuery("#tpl-request-to-join-option").html()),events:{"click #showMyselfInfo":"renderMyselfInfo","click #showFamilyMemberInfo":"renderFamilyMemberInfo"},initialize:function(a){this.options=a},render:function(){return this.jQueryel.html(this.template()),this},renderMyselfInfo:function(){var a=new c.MyInfoForm;a.jQueryel.hide(),this.options.jQuerysectionWrapper.html(a.render().jQueryel),a.jQueryel.fadeIn("fast"),b.renderComponents(this.options.jQuerysectionWrapper),c.helper.scrollWindow()},renderFamilyMemberInfo:function(){var a=new c.FamilyMemberForm;a.jQueryel.hide(),this.options.jQuerysectionWrapper.html(a.render().jQueryel),a.jQueryel.fadeIn("fast"),b.renderComponents(this.options.jQuerysectionWrapper),c.helper.scrollWindow()}}),c.MyInfoForm=Backbone.View.extend({template:_.template(jQuery("#tpl-my-info-form").html()),events:{"change .equinox-member-select select":"toggleMemberId","click .icon-info":"showTooltip",submit:"submitForm"},render:function(){return this.jQueryel.append(this.template()),this.dom={jQueryserverError:this.jQuery(".server-error"),jQueryrow:this.jQuery(".row"),jQueryregion:this.jQuery(".region-select"),jQueryclub:this.jQuery(".club-select"),jQueryempFirstName:this.jQuery(".emp-first-name"),jQueryempLastName:this.jQuery(".emp-last-name"),jQuerypersonalEmail:this.jQuery(".personal-email"),jQueryworkEmail:this.jQuery(".work-email"),jQueryprimaryPhone:this.jQuery(".primary-phone"),jQueryworkPhone:this.jQuery(".work-phone"),jQueryequinoxMemberSelect:this.jQuery(".equinox-member-select"),jQuerymemberIdCol:this.jQuery(".member-id-col"),jQuerymemberId:this.jQuery(".member-id"),jQueryloader:this.jQuery(".loader")},c.helper.fillRegionClubDropdown({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub}),this},toggleMemberId:function(a){c.helper.toggleMemberId({e:a,dom:{jQuerymemberIdCol:this.dom.jQuerymemberIdCol,jQuerymemberId:this.dom.jQuerymemberId}})},showTooltip:function(a){c.helper.showTooltip({e:a})},submitForm:function(a){c.helper.submitForm({e:a,context:this,dom:this.dom,whoIsThisFor:c.RELATIONSHIP_OPTIONS.MYSELF})}}),c.FamilyMemberForm=Backbone.View.extend({template:_.template(jQuery("#tpl-family-member-info-form").html()),events:{"change .equinox-member-select select":"toggleMemberId","click .icon-info":"showTooltip",submit:"submitForm"},render:function(){return this.jQueryel.append(this.template()),this.dom={jQueryserverError:this.jQuery(".server-error"),jQueryrow:this.jQuery(".row"),jQueryfamilyMemberInfo:jQuery("#familyMemberInfo"),jQueryemployeeInfo:this.jQuery("#employeeInfo"),jQueryregion:this.jQuery(".region-select"),jQueryclub:this.jQuery(".club-select"),jQueryfirstName:this.jQuery(".first-name"),jQuerylastName:this.jQuery(".last-name"),jQuerypersonalEmail:this.jQuery(".personal-email"),jQueryprimaryPhone:this.jQuery(".primary-phone"),jQueryequinoxMemberSelect:this.jQuery(".equinox-member-select"),jQuerymemberIdCol:this.jQuery(".member-id-col"),jQuerymemberId:this.jQuery(".member-id"),jQueryempFirstName:this.jQuery(".emp-first-name"),jQueryempLastName:this.jQuery(".emp-last-name"),jQueryworkEmail:this.jQuery(".work-email"),jQueryworkPhone:this.jQuery(".work-phone"),jQueryloader:this.jQuery(".loader")},c.helper.fillRegionClubDropdown({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub}),this},toggleMemberId:function(a){c.helper.toggleMemberId({e:a,dom:{jQuerymemberIdCol:this.dom.jQuerymemberIdCol,jQuerymemberId:this.dom.jQuerymemberId}})},showTooltip:function(a){c.helper.showTooltip({e:a})},submitForm:function(a){c.helper.submitForm({e:a,context:this,dom:this.dom,whoIsThisFor:c.RELATIONSHIP_OPTIONS.FAMILY_MEMBER})}}),c.EmailConfirmation=Backbone.View.extend({template:_.template(jQuery("#tpl-request-to-join-email-confirmation").html()),render:function(){return this.jQueryel.html(this.template(this.model)),this}}),c.ThankyouConfirmation=Backbone.View.extend({template:_.template(jQuery("#tpl-request-to-join-thank-you-confirmation").html()),render:function(){return this.jQueryel.html(this.template(this.model)),this}}),c.documentEventBinding=function(){jQuery(document).on("click",function(a){var b=jQuery(a.target);if(!b.closest("label").find(".icon-info").length){var c=jQuery(".overlay-box.active");c.hasClass("active")&&c.removeClass("active")}})},c.init=function(){c.documentEventBinding();var a=new c.Main;a.render()}}(window,window.App),function(a,b){"use strict";var c,d,e=b.Pages.CorpLead={};e.RELATIONSHIP_OPTIONS={MYSELF:"MYSELF",FAMILY_MEMBER:"FAMILY MEMBER"},e.dom={jQueryhtmlBody:jQuery("html, body")},e.sendingData={},e.helper={scrollWindow:function(a){a=_.isUndefined(a)?e.dom.jQueryhtmlBody:a,e.dom.jQueryhtmlBody.animate({scrollTop:a.offset().top})},sendRequest:function(a){jQuery.ajax({type:a.type,url:a.url,data:a.data,contentType:"application/json",xhrFields:{withCredentials:!0},headers:{"Eqx-Version":"1"}}).success(a.success).error(a.error)},abortRequest:function(){d&&4!==d.readystate&&d.abort()},fillRegionClubDropdown:function(b){var c="Select a Region",d="You must select a Region first",e=b.jQueryregion.find("select"),f=b.jQueryclub.find("select"),g='<option data-slug="">'+c+"</option>",h={};jQuery.each(a.allRegionsData,function(a,b){if(b&&b.SubRegions&&b.SubRegions.length){var c=[];g+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",jQuery.each(b.SubRegions,function(a,b){c=c.concat(b.Facilities)}),h[b.Name]=c}else g+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",h[b.Name]=b.Facilities}),e.html(g),f.prepend('<option selected data-id="">'+d+"</option>"),e.on("change",function(){var a=h[jQuery(this).val()],b="",c="Select a Club";a?(jQuery.each(a,function(a,c){(c.IsAvailableOnline!==!1||c.IsPresale!==!1)&&(b+='<option data-isPilateSurvey="'+c.IsSurveyPilot+'" data-id="'+c.Id+'">'+c.ClubName+"</option>")}),f.html(b),f.each(function(){var a=jQuery(this).children("option");a.sort(function(a,b){return a.value.localeCompare(b.value)}),jQuery(this).empty().append(a)}),f.prepend('<option selected data-id="">'+c+"</option>"),f.trigger("change")):(f.html('<option selected data-id="">'+d+"</option>"),f.siblings(".option").html(d))}),e.trigger("change")},adjustOverlayHeight:function(a){var b=jQuery(document).height(),c=a.jQueryleadPopupContent.height(),d=c>b?c:b;a.jQueryleadPopupOverlay.height(d)},toggleMemberId:function(a){var b=jQuery(a.e.target),c=parseInt(b.val(),10);c?1===c&&(a.dom.jQuerymemberIdCol.find(".error").length&&a.dom.jQuerymemberIdCol.find(".error").removeClass("error"),a.dom.jQuerymemberIdCol.show(),a.dom.jQuerymemberId.focus()):a.dom.jQuerymemberIdCol.hide()},showTooltip:function(a){a.e.stopPropagation();var b=jQuery(a.e.target),c=b.next(".overlay-box");c.hasClass("active")?c.removeClass("active"):c.addClass("active")},validateForm:function(a){var b={email:function(a){return a=jQuery.trim(a),/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},phone:function(a){return a=jQuery.trim(a),/^[0-9\-().\s]*jQuery/.test(a)},name:function(a){return a=jQuery.trim(a),/^[a-zA-Z-'"\s]+jQuery/.test(a)}},c=!0,d=!0;e.sendingData={personalEmail:jQuery.trim(a.dom.jQuerypersonalEmail.val()),primaryPhone:jQuery.trim(a.dom.jQueryprimaryPhone.val().replace(/[^0-9]/g,"")),regionName:a.dom.jQueryregion.find("select option").filter(":selected").data("slug"),facilityId:a.dom.jQueryclub.find("select option").filter(":selected").data("id"),isEquinoxMember:a.dom.jQueryequinoxMemberSelect.find("select").val(),memberId:1===parseInt(a.dom.jQueryequinoxMemberSelect.find("select").val(),10)?jQuery.trim(a.dom.jQuerymemberId.val()):null,benefitHolderFirstName:jQuery.trim(a.dom.jQueryempFirstName.val()),benefitHolderLastName:jQuery.trim(a.dom.jQueryempLastName.val()),benefitHolderPhone:jQuery.trim(a.dom.jQueryworkPhone.val().replace(/[^0-9]/g,"")),workEmail:jQuery.trim(a.dom.jQueryworkEmail.val())},a.context.jQuery(".error").removeClass("error"),a.dom.jQueryserverError.hide(),e.sendingData.regionName||this.addErrorClass(a.dom.jQueryregion),e.sendingData.facilityId||this.addErrorClass(a.dom.jQueryclub),a.whoIsThisFor===e.RELATIONSHIP_OPTIONS.FAMILY_MEMBER&&(e.sendingData.firstName=jQuery.trim(a.dom.jQueryfirstName.val()),e.sendingData.lastName=jQuery.trim(a.dom.jQuerylastName.val()),e.sendingData.firstName.length&&b.name(e.sendingData.firstName)||this.addErrorClass(a.dom.jQueryfirstName),e.sendingData.lastName.length&&b.name(e.sendingData.lastName)||this.addErrorClass(a.dom.jQuerylastName)),(e.sendingData.personalEmail.length<3||!b.email(e.sendingData.personalEmail))&&(this.addErrorClass(a.dom.jQuerypersonalEmail),c=!1),e.sendingData.primaryPhone.length&&b.phone(e.sendingData.primaryPhone)||this.addErrorClass(a.dom.jQueryprimaryPhone),e.sendingData.isEquinoxMember.length?""===e.sendingData.memberId&&(this.addErrorClass(a.dom.jQuerymemberId),a.dom.jQueryserverError.html(jQuery("#barcode-error-message").val()).show()):this.addErrorClass(a.dom.jQueryequinoxMemberSelect),e.sendingData.benefitHolderFirstName.length&&b.name(e.sendingData.benefitHolderFirstName)||this.addErrorClass(a.dom.jQueryempFirstName),e.sendingData.benefitHolderLastName.length&&b.name(e.sendingData.benefitHolderLastName)||this.addErrorClass(a.dom.jQueryempLastName),(e.sendingData.workEmail.length<3||!b.email(e.sendingData.workEmail))&&(this.addErrorClass(a.dom.jQueryworkEmail),d=!1),e.sendingData.benefitHolderPhone.length>1&&!b.phone(e.sendingData.benefitHolderPhone)&&this.addErrorClass(a.dom.jQueryworkPhone),c&&d&&jQuery.trim(e.sendingData.personalEmail)===jQuery.trim(e.sendingData.workEmail)&&(this.addErrorClass(a.dom.jQuerypersonalEmail),this.addErrorClass(a.dom.jQueryworkEmail),a.dom.jQueryserverError.html("Personal email can't be same as Work email!").show())},addErrorClass:function(a){a.addClass("error"),a.closest(".control").siblings(".control-title").addClass("error")},submitForm:function(a){a.e.preventDefault();var b=jQuery(a.e.target).find(":submit"),c=this,f={},g=null,h=null,i=e.RELATIONSHIP_OPTIONS.MYSELF.toLowerCase(),j=jQuery("#corpLeadActivationCode").val(),k=APIEndpoint+"/corp/join/lead";if(this.validateForm({context:a.context,dom:a.dom,whoIsThisFor:a.whoIsThisFor}),0===a.context.jQuery(".error").length)a.whoIsThisFor===e.RELATIONSHIP_OPTIONS.FAMILY_MEMBER&&(i=e.RELATIONSHIP_OPTIONS.FAMILY_MEMBER.toLowerCase(),g=e.sendingData.firstName,h=e.sendingData.lastName),f=_.pick(e.sendingData,["personalEmail","primaryPhone","facilityId","memberId","benefitHolderFirstName","benefitHolderLastName","benefitHolderPhone","workEmail"]),_.assign(f,{firstName:g,lastName:h,membershipFor:i,activationCode:j}),a.dom.jQueryloader.show(),b.prop("disabled",!0),console.log("Form Data: ",f),d=this.sendRequest({type:"POST",url:k,data:window.JSON.stringify(f),success:function(d){if(c.scrollWindow(),d.success){var g=new e.ThankYou({model:{benefitHolderFirstName:f.benefitHolderFirstName}});a.dom.jQuerymainHeader.hide(),a.dom.jQuerysectionWrapper.html(g.render().jQueryel)}else a.context.jQuery(".error").removeClass("error"),a.dom.jQueryserverError.html(d.errorMessage).show(),-1!==d.errorMessage.toLowerCase().search("email")?c.addErrorClass(a.dom.jQueryworkEmail):-1!==d.errorMessage.toLowerCase().search("barcode")&&c.addErrorClass(a.dom.jQuerymemberId),a.dom.jQueryloader.hide(),b.prop("disabled",!1)},error:function(d){var e=window.JSON.parse(d.responseText),f=e.message;try{f=_.isUndefined(f)?e.error.message:f,-1!==f.toLowerCase().search("email")?c.addErrorClass(a.dom.jQueryworkEmail):-1!==f.toLowerCase().search("barcode")&&c.addErrorClass(a.dom.jQuerymemberId)}catch(g){f="Unable to process your request! Please try again later."}c.scrollWindow(),a.dom.jQueryloader.hide(),b.prop("disabled",!1),a.dom.jQueryserverError.empty().html(f).show()}});else{var l;l=a.dom.jQueryserverError.is(":visible")?a.dom.jQueryserverError:a.dom.jQuerycontainer.find(".control-title.error").eq(0),this.scrollWindow(l)}}},e.Main=Backbone.View.extend({id:"corp-lead-popup-wrapper",tpl:{overlay:'<div id="corp-lead-popup-overlay"></div>',loader:'<div class="loader"><div class="loader-circles bounce1"></div><div class="loader-circles bounce2"></div><div class="loader-circles bounce3"></div></div>',error:'<div id="corp-lead-popup-content"><div class="close close-popup"><span class="icon-close"></span></div><div id="lead-section-wrapper"></div></div>'},events:{"click .close":"closePopup"},initialize:function(){c=this,this.dom={}},render:function(){e.helper.scrollWindow(),this.jQuerycorpLeadPopupWrapper=jQuery("#corp-lead-popup-wrapper"),this.jQuerycorpLeadPopupWrapper.is(":visible")&&this.jQuerycorpLeadPopupWrapper.remove(),this.jQueryel.append(this.tpl.overlay).append(this.tpl.loader),jQuery("body").append(this.jQueryel),e.helper.scrollWindow(),this.getContent()},getContent:function(){var a="/corp/join/lead";e.helper.sendRequest({url:a,success:this.renderPopup,error:this.renderError})},renderError:function(){c.jQuery(".loader").hide(),c.jQueryel.append(c.tpl.error).find("#lead-section-wrapper").append("Failed to get lead form content!").addClass("error")},renderPopup:function(a){c.jQueryel.append(a),c.jQuery(".loader").hide(),c.dom={jQuerycontainer:jQuery("#corp-lead-popup-wrapper"),jQueryleadPopupOverlay:jQuery("#corp-lead-popup-overlay"),jQueryleadPopupContent:c.jQuery("#corp-lead-popup-content"),jQuerysectionWrapper:c.jQuery("#lead-section-wrapper"),jQuerymainHeader:c.jQuery("#main-header")};var b=new e.RequestToJoinOption({dom:c.dom});c.dom.jQuerysectionWrapper.html(b.render().jQueryel),c.dom.jQueryleadPopupContent.fadeIn("fast"),e.helper.adjustOverlayHeight({jQueryleadPopupOverlay:c.dom.jQueryleadPopupOverlay,jQueryleadPopupContent:c.dom.jQueryleadPopupContent})},closePopup:function(){this.remove(),e.helper.abortRequest(d)}}),e.RequestToJoinOption=Backbone.View.extend({events:{"click #leadShowMyselfInfo":"renderMyselfInfo","click #leadShowFamilyMemberInfo":"renderFamilyMemberInfo"},initialize:function(a){this.options=a},render:function(){return this.template=_.template(jQuery("#tpl-request-to-join-lead-option").html()),this.jQueryel.html(this.template()),this},renderMyselfInfo:function(){var a=new e.MyInfoForm({dom:this.options.dom});a.jQueryel.hide(),this.options.dom.jQuerysectionWrapper.html(a.render().jQueryel),a.jQueryel.fadeIn("fast"),b.renderComponents(this.options.dom.jQuerysectionWrapper),e.helper.scrollWindow()},renderFamilyMemberInfo:function(){var a=new e.FamilyMemberForm({dom:this.options.dom});a.jQueryel.hide(),this.options.dom.jQuerysectionWrapper.html(a.render().jQueryel),a.jQueryel.fadeIn("fast"),b.renderComponents(this.options.dom.jQuerysectionWrapper),e.helper.scrollWindow()}}),e.MyInfoForm=Backbone.View.extend({events:{"change .equinox-member-select select":"toggleMemberId","click .icon-info":"showTooltip",submit:"submitForm"},initialize:function(a){this.options=a},render:function(){return this.template=_.template(jQuery("#tpl-my-info-lead-form").html()),this.jQueryel.append(this.template()),this.dom={jQuerycontainer:this.options.dom.jQuerycontainer,jQueryleadPopupOverlay:this.options.dom.jQueryleadPopupOverlay,jQueryleadPopupContent:this.options.dom.jQueryleadPopupContent,jQuerysectionWrapper:this.options.dom.jQuerysectionWrapper,jQuerymainHeader:this.options.dom.jQuerymainHeader,jQueryserverError:this.jQuery(".server-error"),jQueryrow:this.jQuery(".row"),jQueryregion:this.jQuery(".region-select"),jQueryclub:this.jQuery(".club-select"),jQueryempFirstName:this.jQuery(".emp-first-name"),jQueryempLastName:this.jQuery(".emp-last-name"),jQuerypersonalEmail:this.jQuery(".personal-email"),jQueryworkEmail:this.jQuery(".work-email"),jQueryprimaryPhone:this.jQuery(".primary-phone"),jQueryworkPhone:this.jQuery(".work-phone"),jQueryequinoxMemberSelect:this.jQuery(".equinox-member-select"),jQuerymemberIdCol:this.jQuery(".member-id-col"),jQuerymemberId:this.jQuery(".member-id"),jQueryloader:this.jQuery(".loader")},e.helper.fillRegionClubDropdown({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub}),this},toggleMemberId:function(a){e.helper.toggleMemberId({e:a,dom:{jQuerymemberIdCol:this.dom.jQuerymemberIdCol,jQuerymemberId:this.dom.jQuerymemberId}})},showTooltip:function(a){e.helper.showTooltip({e:a})},submitForm:function(a){e.helper.submitForm({e:a,context:this,dom:this.dom,whoIsThisFor:e.RELATIONSHIP_OPTIONS.MYSELF})}}),e.FamilyMemberForm=Backbone.View.extend({events:{"change .equinox-member-select select":"toggleMemberId","click .icon-info":"showTooltip",submit:"submitForm"},initialize:function(a){this.options=a},render:function(){return this.template=_.template(jQuery("#tpl-family-member-info-lead-form").html()),this.jQueryel.append(this.template()),this.dom={jQuerycontainer:this.options.dom.jQuerycontainer,jQueryleadPopupOverlay:this.options.dom.jQueryleadPopupOverlay,jQueryleadPopupContent:this.options.dom.jQueryleadPopupContent,jQuerysectionWrapper:this.options.dom.jQuerysectionWrapper,jQuerymainHeader:this.options.dom.jQuerymainHeader,jQueryserverError:this.jQuery(".server-error"),jQueryrow:this.jQuery(".row"),jQueryfamilyMemberInfo:jQuery("#familyMemberInfo"),jQueryemployeeInfo:this.jQuery("#employeeInfo"),jQueryregion:this.jQuery(".region-select"),jQueryclub:this.jQuery(".club-select"),jQueryfirstName:this.jQuery(".first-name"),jQuerylastName:this.jQuery(".last-name"),jQuerypersonalEmail:this.jQuery(".personal-email"),jQueryprimaryPhone:this.jQuery(".primary-phone"),jQueryequinoxMemberSelect:this.jQuery(".equinox-member-select"),jQuerymemberIdCol:this.jQuery(".member-id-col"),jQuerymemberId:this.jQuery(".member-id"),jQueryempFirstName:this.jQuery(".emp-first-name"),jQueryempLastName:this.jQuery(".emp-last-name"),jQueryworkEmail:this.jQuery(".work-email"),jQueryworkPhone:this.jQuery(".work-phone"),jQueryloader:this.jQuery(".loader")},e.helper.fillRegionClubDropdown({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub}),this},toggleMemberId:function(a){e.helper.toggleMemberId({e:a,dom:{jQuerymemberIdCol:this.dom.jQuerymemberIdCol,jQuerymemberId:this.dom.jQuerymemberId}})},showTooltip:function(a){e.helper.showTooltip({e:a})},submitForm:function(a){e.helper.submitForm({e:a,context:this,dom:this.dom,whoIsThisFor:e.RELATIONSHIP_OPTIONS.FAMILY_MEMBER})}}),e.ThankYou=Backbone.View.extend({render:function(){this.template=_.template(jQuery("#tpl-request-to-join-lead-thank-you").html()),this.jQueryel.html(this.template());var a=[{jQueryel:this.jQueryel,placeholder:"##NAME##",value:this.model.benefitHolderFirstName}];return EQ.Helpers.replaceEl(a),this}}),e.popupInit=function(){console.log("Corporate Popup Page");var a=new e.Main;a.render()}}(window,window.App),function(a,b){"use strict";var c=function(){var a;return this.popup=Backbone.View.extend({id:"corp-transfer-popup-wrapper",tpl:{overlay:'<div id="corp-transfer-popup-overlay"></div>',loader:'<div class="loader"><div class="loader-circles bounce1"></div><div class="loader-circles bounce2"></div><div class="loader-circles bounce3"></div></div>',error:'<div id="corp-transfer-popup-content"><div class="close close-popup"><span class="icon-close"></span></div></div>',popup:_.template(jQuery("#faq-popup").html())},events:{"click .close":"closePopup","click .faq-membership":"navigate","click .faq-enrollment":"navigate","click .faq-benefits":"navigate","click .faq-tnc":"navigate"},initialize:function(){a=this,this.dom={}},navigate:function(a){a.preventDefault(),this.scrollWindow(jQuery("#"+a.target.dataset.target))},scrollWindow:function(a){a=_.isUndefined(a)?jQuery("html, body"):a,jQuery("html, body").animate({scrollTop:a.offset().top})},render:function(){this.scrollWindow(),this.jQuerycorpTransferPopupWrapper=jQuery("#corp-transfer-popup-wrapper"),this.jQuerycorpTransferPopupWrapper.is(":visible")&&this.jQuerycorpTransferPopupWrapper.remove(),this.jQueryel.append(this.tpl.overlay).append(this.tpl.loader),jQuery("body").append(this.jQueryel),this.scrollWindow(),this.getContent()},getContent:function(){this.renderPopup()},renderPopup:function(){a.jQueryel.append(this.tpl.popup({content:jQuery("#faq_text").html()})),a.jQuery(".loader").hide(),a.dom={jQuerycontainer:jQuery("#corp-transfer-popup-wrapper"),jQuerytransferPopupOverlay:jQuery("#corp-transfer-popup-overlay"),jQuerytransferPopupContent:a.jQuery("#corp-transfer-popup-content"),jQuerysectionWrapper:a.jQuery("#transfer-section-wrapper"),jQuerymainHeader:a.jQuery("#main-header")},this.adjustOverlayHeight({jQuerytransferPopupOverlay:a.dom.jQuerytransferPopupOverlay,jQuerytransferPopupContent:a.dom.jQuerytransferPopupContent})},adjustOverlayHeight:function(a){var b=jQuery(document).height(),c=a.jQuerytransferPopupContent.height(),d=c>b?c:b;a.jQuerytransferPopupOverlay.height(d)},closePopup:function(){this.remove()}}),{popupInit:_.bind(function(){this.view=new this.popup,this.view.render()},this)}};b.Pages.CorpTransfer=new c}(window,window.App),function(a,b){"use strict";var c=b.Pages.CreateAccount={},d=jQuery(".create-account");c.init=function(){debug("[CreateAccount] Init"),c.bind()},c.bind=function(){var a=c;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({email:"Create.Email",password:"Create.Password",sourceSystem:"Create.Country",lastName:"Create.LastName",firstName:"Create.FirstName",barcodeId:"Create.BarcodeId"},function(){console.log(d.find('input[name="Create.Email"]').val());var a={email:d.find('input[name="Create.Email"]').val()};debug("[CreateAccount] Callback"),jQuery(".user-recover-confirmation").removeClass("hidden");var b=jQuery(".confirmation-message-module");b.data("templateData",a),b.data("publicMethods").render(),window.track("regSignupVerifEmlSent"),d.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".create-acount-mail-sent").addClass("hidden"),jQuery("body, html").animate({scrollTop:0})})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.CustomWorkout={};c.init=function(){console.log("---------Calling from custom workout page");var a=APIEndpoint+"/classes/Customworkouts",b=Backbone.Model.extend({}),c=Backbone.PageableCollection.extend({model:b,url:a,mode:"client",state:{pageSize:15}}),d=[{name:"workoutDate",label:"DATE",editable:!1,cell:"string"},{name:"workoutTime",label:"TIME",editable:!1,cell:"string"},{name:"name",label:"WORKOUT",editable:!1,cell:"string"},{name:"calories",label:"CALORIES",editable:!1,cell:"string"},{name:"description",label:"NOTES",editable:!1,cell:"string"}],e=new c;e.fetch({xhrFields:{withCredentials:!0},success:function(){var a=new Backgrid.Grid({columns:d,collection:e});jQuery("#customWorkoutData").append(a.render().el);var b=new Backgrid.Extension.Paginator({collection:e});jQuery("#customWorkoutData").append(b.render().el)},error:function(){jQuery("#customWorkoutData").html("Failed to load data")}})}}(window,window.App),function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o=b.Pages.CyclingGroupsChallengeDetail={},p={},q="",r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],s={CHALLENGEDETAIL:function(a){return"/v3.2/challenges/cycling/"+a+"/detail"},ALLCHALLENGES:function(){return"/v3.2/challenges/cycling"},CHECKOPTSTATUS:function(a){return"/v3.2/challenges/cycling/"+a+"/optstatus"},JOINCHALLENGE:function(a){return"/v3.2/challenges/cycling/"+a+"/join"}};o.init=function(a){var b=0,c=0;return jQuery("div.page").hasClass("leaderboard")?!1:(EQ.Helpers.getService(s.CHECKOPTSTATUS(a),{},{async:!1},!1,!0).done(function(a){i=a.isChallengeActive,
j=a.isVisible,k=a.optStatus}),EQ.Helpers.getService("/v1/me").done(function(b){m=b.profile,o.setup(a)}),b=window.location.pathname.split("/")[window.location.pathname.split("/").length-1],b.includes("/")&&(b=b.substr(1)),EQ.Helpers.getService(s.ALLCHALLENGES(),{},{async:!1},!1,!0).done(function(a){if(a.challenges){var d=a.challenges;_.each(d,function(a){a.isActive!==!1&&(c=a.challengeId,console.log("Selected Challenge = ",b),console.log("Current Active Challenge = ",c))})}}),void EQ.Helpers.getService(s.CHECKOPTSTATUS(b),{},{async:!1},!1,!0).done(function(a){console.log("Opt Status in Challenge",b," = ",a.optStatus)}))},o.setup=function(a){var g=EQ.Helpers.getService(s.CHALLENGEDETAIL(a)),i=EQ.Helpers.getService(s.ALLCHALLENGES());g.done(function(g){var k,s,t,v,w,x,y,z,A;n=g.challengeCategoryType;var B={totalScores:g.totalScores,challengeDates:o.getChallengeDateRange(g),topPerformers:o.getTopPerformers(g),picturePath:APIEndpoint3+"/pictures/",challengeHeaderDate:o.getChallengeHeaderDate(g),challengeEndDate:o.getChallengeEndDate(g),clubName:"",isAhead:"",isBehind:"",milesDifference:"",challengeStatus:o.getChallengeStatus(g),otherRanking:"",challengeStatusDetail:o.getChallengeData(a)};if(g.facilityStats||_.extend(B,{facilityStats:{facilityId:userProfileJson.FacilityId}}),"ClubVsClub"===n){q="Club";var C=g.topFacilityRankings.length;g.facilityStats?C>0&&(A=g.topFacilityRankings[0].facilityId===g.facilityStats.facilityId&&C>1?1:0,_.extend(B,{facilityStats:{totalScores:g.facilityStats.totalScores},clubName:g.facilityStats.facilityName,isAhead:g.facilityStats.totalScores>g.topFacilityRankings[A].totalScores?"":" hidden",isBehind:g.facilityStats.totalScores<=g.topFacilityRankings[A].totalScores?"":" hidden",milesDifference:Math.abs(Math.round(g.facilityStats.totalScores)-Math.round(g.topFacilityRankings[A].totalScores)),otherRanking:A}),z={distanceGoal:g.challengeGoal,distanceCurrent:g.facilityStats.totalScores,distanceOther:g.topFacilityRankings[A].totalScores,challengeCategoryType:n,unit:EQ.Helpers.unitMap[g.challengeMetric],topFacilityRankings:g.topFacilityRankings}):(_.extend(B,{facilityStats:{totalScores:0},clubName:"Your Facility",isAhead:"hidden",isBehind:"",milesDifference:C>0?g.topFacilityRankings[0].totalScores:0,otherRanking:0}),z={distanceGoal:g.challengeGoal,distanceCurrent:0,distanceOther:C>0?g.topFacilityRankings[0].totalScores:0,challengeCategoryType:n,unit:EQ.Helpers.unitMap[g.challengeMetric],topFacilityRankings:g.topFacilityRankings})}else if(/Individual|IndividualCollectiveGoal|IndividualVsClub/i.test(n)&&g.me){A=g.topRankings[0].shareId===g.me.shareId?1:0;var D=g.topRankings.length>1;_.extend(B,{me:{averageDistance:g.me.scores/g.me.sessions},clubName:"",isAhead:g.me.scores>g.topRankings[D?A:0].scores?"":" hidden",isBehind:g.me.scores<=g.topRankings[D?A:0].scores?"":" hidden",milesDifference:Math.abs(Math.round(g.me.scores)-Math.round(g.topRankings[D?A:0].scores)),otherRanking:D?A:0});var E={year:moment(g.startDate).year(),month:moment(g.startDate).month()+1,date:moment(g.startDate).date()},F={year:moment(g.endDate).year(),month:moment(g.endDate).month()+1,date:moment(g.endDate).date()},G=moment([F.year,F.month,F.date]).diff(moment([E.year,E.month,E.date]),"days");z={distanceGoal:g.challengeGoal,distanceCurrent:g.me.scores,distanceOther:g.topRankings[D?A:0].scores,challengeCategoryType:n,unit:EQ.Helpers.unitMap[g.challengeMetric],topRankings:g.topRankings,totalDays:G,daysPast:G-g.daysLeft,status:o.getChallengeStatus(g)},"IndividualVsClub"===n&&(q="ClubIndividual"),"IndividualCollectiveGoal"===n&&(q="CollectiveGoalIndividual",z.distanceCurrent=B.totalScores)}k=new Backbone.Model(_.merge(g,B)),s=new c({model:k,template:jQuery("#challengeDetailHeaderTemplate"),el:jQuery(".cycling-challenge-hero-header")}),t=new d({model:k,el:jQuery("#challenge-description-content")}),k.get("me")&&(v=new e({model:k,el:jQuery("#challenge-summary-content"),template:jQuery("#challengeSummaryTemplate"+q)}),b.loadComponent("challenge-progress-bar",jQuery(".progress-module"),z)),w=new f({model:k,el:jQuery("#challenge-recap-content")}),y=new h({model:k,el:jQuery("#challenge-top-performers-content"),template:jQuery("#challengeTopPerformersTemplate"+q)}),console.log("challengeDetailModel :: ",k),jQuery(".tpl-challengerankings").length>0&&k.get("me")&&(p.leaderboardType="ClubVsClub"===n?"clubchallenge":"challenge",p.challengeTypeId=a,p.gender="All",p.query="pageNumber=1",p.userOptInFacilityId=user.FacilityId,p.templateName="ClubVsClub"===n?"leaderboard-component-template-clubs":"leaderboard-component-template",p.wrapperId="#challenge-detail-leaderboard",b.loadComponent("group-challenge-leaderboard",p));var H=function(a){var b="#joinChallengeModalTemplate";switch(a){case"ClubVsClub":b+="Club";break;case"IndividualVsClub":b+="ClubIndividual"}return b};l=new u({model:new Backbone.Model({challengeName:k.get("challengeName"),gender:m.gender?m.gender:"",clubId:user.FacilityId,challengeId:a,challengeStatus:k.get("challengeStatus")}),el:jQuery(".modals"),template:jQuery(H(n))}),l.render(),i.done(function(a){var b,c,d,e,f,g,h=a.challenges,i=h.length,l=-1,m={name:"",dateTitle:"",type:"",riders:"",id:"",desc:"",flag:"hidden",status:""},n={};for(k.set("isVisible",j);++l<i;)if(k.get("challengeId")===h[l].challengeId){h[l+1]&&(b=new Date(h[l+1].startDate),d=r[b.getUTCMonth()]+" "+b.getUTCFullYear(),f=o.getChallengeType(h[l+1].challengeCategoryType),n.prev={name:h[l+1].challengeName,dateTitle:d,type:f,riders:h[l+1].totalParticipants,id:h[l+1].challengeTypeId,desc:h[l+1].shortDescription,flag:"",isVisible:h[l+1].isVisible}),h[l-1]&&(c=new Date(h[l-1].startDate),e=r[c.getUTCMonth()]+" "+c.getUTCFullYear(),g=o.getChallengeType(h[l-1].challengeCategoryType),n.next={name:h[l-1].challengeName,dateTitle:e,type:g,riders:h[l-1].totalParticipants,id:h[l-1].challengeTypeId,desc:h[l-1].shortDescription,flag:"",isVisible:h[l-1].isVisible});break}var p=jQuery.Deferred(),q=jQuery.Deferred();n.prev?p=o.getChallengeData(n.prev.id):(n.prev=m,p.resolveWith("None")),n.next?q=o.getChallengeData(n.next.id):(n.next=m,q.resolveWith("None")),k.set("prevNext",n),console.log("PREV NEXT >>>>>> ",n),jQuery.when(p,q).done(function(a,b){k.attributes.prevNext.prev.status=a,k.attributes.prevNext.next.status=b,k.attributes.prevNext.prev.isVisible||("NotJoinedUpcoming"===a||"NotJoinedInProgress"===a||"NotJoinedClosed"===a)&&(k.attributes.prevNext.prev.flag="hidden"),k.attributes.prevNext.next.isVisible||("NotJoinedUpcoming"===b||"NotJoinedInProgress"===b||"NotJoinedClosed"===b)&&(k.attributes.prevNext.next.flag="hidden")}).always(function(){console.log(x)})})})},o.getChallengeData=function(a){var b=jQuery.Deferred();return EQ.Helpers.getService(s.CHALLENGEDETAIL(a)).done(function(a){var c=null===a.me?"NotJoined":"Joined",d="Upcoming";null===a.daysToGo&&(d=null!==a.daysLeft?"InProgress":"Closed"),b.resolve(c+d)}).fail(function(a){b.resolve(a)}),b},o.getChallengeStatus=function(a){var b="Upcoming";return null===a.daysToGo&&(b=null!==a.daysLeft?"InProgress":"Closed"),b},o.getChallengeDateRange=function(a){var b=new Date(a.startDate),c=new Date(a.endDate),d=b.getUTCMonth(),e=c.getUTCMonth();return d===e?r[d]+" "+b.getUTCDate()+"-"+(c.getUTCDate()-1):r[d]+" "+b.getUTCDate()+" - "+r[e]+" "+(c.getUTCDate()-1)},o.getChallengeHeaderDate=function(a){var b=new Date(a.startDate),c=b.getUTCMonth(),d=b.getUTCFullYear();return r[c]+" "+d},o.getChallengeEndDate=function(a){var b=new Date(a.endDate);return b.getUTCMonth()+1+"."+(b.getUTCDate()-1)+"."+b.getUTCFullYear()},o.getTopPerformers=function(a){for(var b=a.topRankings,c={},d=b.length,e=-1;++e<d&&("Female"!==b[e].gender||c.female?"Male"!==b[e].gender||c.male||(c.male=b[e]):c.female=b[e],!c.female||!c.male););return c},o.getChallengeType=function(a){var b={IndividualCollectiveGoal:"Individual Collective Goal",IndividualVsClub:"Individual vs Club",ClubVsClub:"Club vs Club",Individual:"Individual"};return b[a]},o.setupClubSelector=function(){jQuery(".select-wrapper").on("click",function(a){a.stopPropagation();var b=jQuery(this);b.hasClass("active")||jQuery(".select-wrapper.active").removeClass("active").find(".filter-icon").toggleClass("hidden"),b.toggleClass("active"),b.find(".filter-icon").toggleClass("hidden"),b.is("#club-selector")&&jQuery(".select-group-title.desktop-selected").removeClass("desktop-selected").parent().find(".select-group-options").addClass("desktop-hidden")}),jQuery(".select-group-title").on("click",function(b){b.stopPropagation();var c=jQuery(this),d=c.parent();c.hasClass("selected")||jQuery(".select-group-title.selected").removeClass("selected").parent().find(".select-group-options").addClass("hidden"),c.toggleClass("selected").toggleClass("desktop-selected"),d.find(".select-group-options").toggleClass("hidden").toggleClass("desktop-hidden"),c.find(".icon").toggleClass("hidden"),a()}),jQuery("#club-selector").on("click",".select-group-title",function(b){b.stopPropagation();var c=jQuery(this),d=c.find(".region-text").text(),e=c.parent(),f=jQuery("#club");c.hasClass("selected")||jQuery(".select-group-title.selected").removeClass("selected").parent().find(".select-group-options").addClass("hidden"),f.hasClass("region-filter")?(f.find(".dynamic-selection span.club-name").text(d),a()):(c.toggleClass("selected"),e.find(".select-group-options").toggleClass("hidden").toggleClass("desktop-hidden"),c.find(".icon").toggleClass("hidden"))}),jQuery("#leaderboardFilters .select-group-options div").on("click",function(a){a.stopPropagation();var b=jQuery(this),c=b.text(),d=b.parents(".select-wrapper");b.parent().find("div.selected").removeClass("selected"),b.addClass("selected"),d.hasClass("dynamic-title")&&(d.find(".dynamic-selection span.club-name").text(c),d.find(".dynamic-selection").attr("data-club",b.attr("data-club")))}),jQuery("#club-selector").on("click",".select-group-options div",function(b){b.stopPropagation();var c=jQuery(this),d=c.text(),e=c.parents(".select-wrapper");c.parent().find("div.selected").removeClass("selected"),c.addClass("selected"),e.find(".dynamic-selection span.club-name").text(d),e.find(".dynamic-selection").attr("data-club",c.attr("data-club")),a()});var a=function(){var a=jQuery("#club-selector");a.removeClass("active"),a.find(".filter-icon").toggleClass("hidden")}},c=Backbone.View.extend({events:{"click a.cta":"showJoinChallengePopup"},initialize:function(a){this.template=_.template(a.template.html()),this.render()},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this},showJoinChallengePopup:function(a){if(a.preventDefault(),"object"==typeof m)l.openModal();else{var b=EQ.Helpers.PopupMessageHandler(jQuery(".page"),{closeButton:!0,description:"Please try again later.",buttonColor:"black",buttonText:"Ok"});b.showPopup()}}}),d=Backbone.View.extend({template:_.template(jQuery("#challengeDescriptionTemplate").html()),initialize:function(){console.log("ChallengeDescriptionView ### :::::: ",this.model);var a=this.model.get("totalParticipants")-1;a=0>=a?0:a,a=a.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,","),this.model.set("totalParticipants",a),this.render()},render:function(){if(this.jQueryel.html(this.template(this.model.toJSON())),this.shareHasBeenLoaded!==!1)if(j===!0){var a=this.model.get("challengeTypeId"),c=t.getSocialText(a);b.loadComponent("share",this.jQueryel,{fbMode:"share-milestone",type:"share-milestone",linkurl:c.shareURL,fbBlurbCopy:c.FBshareCopy,picture:c.FBimage,twCopy:c.TWshareCopy,title:c.FBtitle,name:c.FBname}),this.shareHasBeenLoaded=!0}else this.jQueryel.find(".challenge-social a").hide();return this}}),e=Backbone.View.extend({initialize:function(a){var b=this.model.get("totalScores"),c=this.model.get("challengeGoal");c=_.isNull(c)?0:c;var d=this.model.get("me").scores,e=d/this.model.get("me").sessions;e=_.isNaN(e)?0:e;var f=b/this.model.get("totalParticipants"),g=this.model.get("facilityStats")?this.model.get("facilityStats").totalScores:"",h=this.model.get("facilityStats")?this.model.get("facilityStats").totalSession:"",i=Math.round(g/c*100),j="ClubVsClub"===this.model.get("challengeCategoryType")?g:d,k=a.template.html(),l=!!this.model.get("challengeGoal"),m=Math.round(b/c*100),n=0,o=c>j?-1:c===j?0:1,p=jQuery(".dtm-challengeprogress").length>0,q=jQuery(".dtm-challengesummary").length>0,r=this.model.get("daysLeft");(q||p)&&c&&(n=Math.abs(c-j)),this.model.set("daysLeft",_.isNull(r)?0:r),this.model.set("pastGoal",n),this.model.set("pastGoalState",o),this.model.set("isGoalSpecific",l),this.model.set("completePercentage",m),this.model.set("facilityCompletePercentage",i),this.model.set("userDistance",d),this.model.set("userAverageDistance",EQ.Helpers.numbers.trimWithFlooring(e,2)),this.model.set("averageDistance",EQ.Helpers.numbers.trimWithFlooring(f,2)),this.model.set("facilityDistance",g),this.model.set("facilityAverageDistance",g&&h?EQ.Helpers.numbers.trimWithFlooring(g/h,2):0),this.model.set("startDateFormatted",moment(this.model.get("startDate")).format("MMM D")),this.model.set("endDateFormatted",moment(this.model.get("endDate")).subtract(1,"days").format("MMM D")),this.template=_.template(k),this.render()},getRenderData:function(){var a=this.model.toJSON();return _.extend(t,a)},render:function(){if(this.jQueryel.html(this.template(this.getRenderData())),this.shareHasBeenLoaded!==!1)if(j===!0){var a=this.model.get("challengeTypeId"),c=t.getSocialText(a);b.loadComponent("share",this.jQueryel,{fbMode:"share-milestone",type:"share-milestone",linkurl:c.shareURL,fbBlurbCopy:c.FBshareCopy,picture:c.FBimage,twCopy:c.TWshareCopy,title:c.FBtitle,name:c.FBname}),this.shareHasBeenLoaded=!0}else this.jQueryel.find(".challenge-social a").hide();return this}});var t={getChallengeData:function(a){var b,c,d=EQ.Helpers.getService(s.CHALLENGEDETAIL(a),{},{async:!1},!1);return d.done(function(a){b=null===a.me?"NotJoined":"Joined",c="Upcoming",null===a.daysToGo&&(c=null!==a.daysLeft?"InProgress":"Closed")}),b+c},getSocialText:function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,t,u,v,w,x,y=EQ.Helpers.getService(s.CHALLENGEDETAIL(a),{},{async:!1},!1);if(y.done(function(d){i=d.challengeName,e=d.iconImageUrl,j=d.challengeGoal,k=EQ.Helpers.numbers.formatNumber(Math.round(d.totalScores)),l=d.challengeMetric,n=d.daysToGo,o=d.daysLeft,u="/groups/cycling/challenge/"+a+"/"+m.shareId,v=d.challengeCategoryType,w=EQ.Helpers.numbers.formatNumber(Math.round(d.facilityStats.totalScores)),null!==d.me&&(p=EQ.Helpers.numbers.formatNumber(Math.round(d.me.scores)),q=EQ.Helpers.numbers.formatNumber(Math.round(p/d.me.sessions)),null!==j&&(r=EQ.Helpers.numbers.formatNumber(Math.round(p-j)),x=EQ.Helpers.numbers.formatNumber(Math.round(j-w))),t=EQ.Helpers.numbers.formatNumber(Math.round(j-p))),b=null===d.me?"NotJoined":"Joined",c="Upcoming",null===d.daysToGo&&(c=null!==d.daysLeft?"InProgress":"Closed")}),"Joined"===b)switch(c){case"Closed":h="I just completed the "+i+" @Equinox. #EQXCYCLE",d=j?r?"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+r+" "+EQ.Helpers.unitMap[l]+" PAST GOAL":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+r+" "+EQ.Helpers.unitMap[l]+" PAST GOAL":"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL ":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL":r?"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+r+" "+EQ.Helpers.unitMap[l]+" PAST GOAL":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+r+" "+EQ.Helpers.unitMap[l]+" PAST GOAL":"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL ":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL",f="I just completed the "+i+" at Equinox. #EQXCYCLE",g=i;break;case"Upcoming":h="Im about to ride in the "+i+" @Equinox. #EQXCYCLE",d=n+" DAYS TO GO",f="Im about to ride in the "+i+" at Equinox. #EQXCYCLE",g=i;break;case"InProgress":h="Im riding in the "+i+" @Equinox. #EQXCYCLE",d=null!==j?"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+t+" "+EQ.Helpers.unitMap[l]+" MILES TO GO":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL | "+t+" "+EQ.Helpers.unitMap[l]+" MILES TO GO":"ClubVsClub"===v?w+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL":p+" "+EQ.Helpers.unitMap[l]+" MILES TOTAL",f="Im riding in the "+i+" at Equinox. #EQXCYCLE",g=i}else switch(c){case"Closed":h="Check out this "+i+" @Equinox. Want to join me for the next one? #EQXCYCLE",d=k+" "+EQ.Helpers.unitMap[l]+" TOTAL MILES",f="Have a look at this months "+i+" at Equinox. Who wants to join me for the next one? #EQXCYCLE",g=i;break;case"Upcoming":h="Have a look at next months "+i+" @Equinox. Who wants to join me? #EQXCYCLE",d=n+" DAYS TO GO",f="Have a look at next months "+i+" at Equinox. Who wants to join me? #EQXCYCLE",g=i;break;case"InProgress":h="Check out the "+i+" @Equinox. Who wants to join me? #EQXCYCLE",d=k+" "+EQ.Helpers.unitMap[l]+" TOTAL EQ MILES | "+o+" DAYS LEFT",f="Check out the "+i+" at Equinox. Who wants to join me? #EQXCYCLE",g=i}return{FBshareCopy:d,TWshareCopy:h,FBimage:e,FBtitle:f,FBname:g,shareURL:u}}};f=Backbone.View.extend({template:_.template(jQuery("#challengeRecapTemplate").html()),initialize:function(){this.render()},getRenderData:function(){var a=this.model.toJSON();return _.extend(t,a)},render:function(){if(this.jQueryel.html(this.template(this.getRenderData())),this.shareHasBeenLoaded!==!1)if(j===!0){var a=this.model.get("challengeTypeId"),c=t.getSocialText(a);b.loadComponent("share",this.jQueryel,{fbMode:"share-milestone",type:"share-milestone",linkurl:c.shareURL,fbBlurbCopy:c.FBshareCopy,picture:c.FBimage,twCopy:c.TWshareCopy,title:c.FBtitle,name:c.FBname}),this.shareHasBeenLoaded=!0}else this.jQueryel.find(".challenge-social a").hide();return this}}),g=f.extend({template:_.template(jQuery("#challengePrevUpcomingTemplate").html())}),h=Backbone.View.extend({initialize:function(a){this.template=_.template(a.template.html()),this.render()},render:function(){if(this.jQueryel.html(this.template(this.model.toJSON())),this.shareHasBeenLoaded!==!1)if(j===!0){var a=this.model.get("challengeTypeId"),c=t.getSocialText(a);b.loadComponent("share",this.jQueryel,{fbMode:"share-milestone",type:"share-milestone",linkurl:c.shareURL,fbBlurbCopy:c.FBshareCopy,picture:c.FBimage,twCopy:c.TWshareCopy,title:c.FBtitle,name:c.FBname}),this.shareHasBeenLoaded=!0}else this.jQueryel.find(".challenge-social a").hide();return this}});var u=Backbone.View.extend({events:{"click .close-modal":"closeModal","click .join":"joinChallenge","click .gender":"selectGender"},initialize:function(a){var b;b=a.template.html(),this.tpl=a.template,this.template=_.template(b),this.model.attributes.showGenderSelector=""!==this.model.attributes.gender?" hidden":""},closeModal:function(a){a.preventDefault(),this.jQueryel.addClass("hidden"),this.jQueryel.children(".joinChallengeModalTemplate").addClass("hidden")},openModal:function(){this.jQueryel.removeClass("hidden").show(),this.jQueryel.children(".joinChallengeModalTemplate").removeClass("hidden").show()},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),jQuery("#club-selector").length>0&&(b.loadComponent("group-challenge-leaderboard-filters",jQuery("#club-selector")),o.setupClubSelector()),this},challengeStatus:function(a){var b="Upcoming";return null===a.daysToGo&&(b=null!==a.daysLeft?"InProgress":"Closed"),b},joinChallenge:function(a){a.preventDefault();var b=this,c=b.model,d=!0,e={},f=jQuery(a.target);if(""===c.get("gender")&&jQuery("#join-challenge-gender-selector").length>0&&(b.jQueryel.children(".joinChallengeModalTemplate").find(".gender-error").removeClass("hidden").show(),d=!1),jQuery("#club-selector").length>0&&(""===jQuery("#club-selector div.selected-location").attr("data-club")?(b.jQueryel.children(".joinChallengeModalTemplate").find(".club-error").removeClass("hidden").show(),d=!1):c.set("clubId",jQuery("#club-selector div.selected-location").attr("data-club"))),d){if(f.hasClass("loading"))return;f.addClass("loading"),b.jQueryel.children(".joinChallengeModalTemplate").find(".modal-error").addClass("hidden").hide(),"999"===c.get("clubId")&&c.set("clubId","103"),/Individual|IndividualCollectiveGoal|IndividualVsClub/i.test(n)&&(e.Gender=c.get("gender")),/ClubVsClub|IndividualVsClub/i.test(n)&&(e.FacilityId=c.get("clubId")),EQ.Helpers.postService(s.JOINCHALLENGE(c.get("challengeId")),e).done(function(a){a.success&&"OptIn"===a.success.optStatus?(f.removeClass("loading"),window.location=window.location.pathname+"?challengestate=Joined"+c.get("challengeStatus")):b.jQueryel.children(".joinChallengeModalTemplate").find(".join-error").removeClass("hidden").show()})}},selectGender:function(a){a.preventDefault();var b=jQuery(a.target).parent();b.hasClass("selected")||(b.parent().find("li").removeClass("selected"),b.addClass("selected"),this.model.attributes.gender=jQuery(a.target).attr("data-gender"))}})}(window,window.App),function(a,b){"use strict";var c,d,e,f,g,h=b.Pages.CyclingGroupsChallengeShared={},i={CHALLENGEDETAIL:function(a,b){return"/v3.2/challenges/cycling/"+a+"/detail/"+b},ALLCHALLENGES:function(){return"/v3.2/challenges/cycling"},CHECKOPTSTATUS:function(a){return"/v3.2/challenges/cycling/"+a+"/optstatus"},JOINCHALLENGE:function(a){return"/v3.2/challenges/cycling/"+a+"/join"}};h.init=function(a,b){return jQuery("div.page").hasClass("leaderboard")?!1:void h.setup(a,b)},h.setup=function(a,h){var j,k,l,m,n=EQ.Helpers.getService(i.CHALLENGEDETAIL(a,h));console.log("SETUP :: ",a),console.log("ChallengeProgressView :: ",c),console.log("endpoint :: ",i),n.done(function(a){var g,h={distanceGoal:a.challengeGoal,distanceCurrent:a.me.scores,challengeCategoryType:a.challengeCategoryType,unit:EQ.Helpers.unitMap[a.challengeMetric],topRankings:a.topRankings};console.log("challengeDetail ::::: ",a),g=new Backbone.Model(a),m=new f({model:g,el:jQuery(".join-challenge"),template:jQuery("#user-footer-tempalte")}),j=new c({model:g,el:jQuery("#user-progress"),template:jQuery("#user-progress-tempalte")}),k=new d({model:g,el:jQuery("#cycling-challenge-hero-share-content"),template:jQuery("#user-header-tempalte")}),l=new e({model:g,el:jQuery(".challenge-description"),template:jQuery("#challenge-desc-tempalte")}),b.loadComponent("challenge-progress-bar",jQuery(".progress-module"),h)}),f=Backbone.View.extend({initialize:function(a){var b=this.model.get("challengeTypeId"),c=g?!0:!1,d=o.getChallengeData(b);this.model.set("joinedStatusString",d.joined+d.status),this.model.set("joinedStatusStringUser",d.joined),this.model.set("userLoggedIn",c),this.template=_.template(a.template.html()),this.render()},getRenderData:function(){var a=this.model.toJSON();return _.extend(o,a)},render:function(){return this.jQueryel.html(this.template(this.getRenderData())),this}}),d=Backbone.View.extend({initialize:function(a){this.model.set("userFirstName",this.model.get("me").displayName),this.template=_.template(a.template.html()),this.render()},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this}}),e=Backbone.View.extend({initialize:function(a){var b=this.model.get("challengeTypeId"),c=o.getChallengeData(b);this.model.set("joinedStatusString",c.joined+c.status),this.template=_.template(a.template.html()),this.render()},getRenderData:function(){var a=this.model.toJSON();return _.extend(o,a)},render:function(){return this.jQueryel.html(this.template(this.getRenderData())),this}}),c=Backbone.View.extend({initialize:function(a){var b=this.model.get("totalScores"),c=this.model.get("challengeGoal"),d=this.model.get("me").scores,e=c-d,f=d/this.model.get("me").sessions,g=b/this.model.get("totalParticipants"),h=this.model.get("facilityStats")?this.model.get("facilityStats").totalScores:"",i=this.model.get("facilityStats")?this.model.get("facilityStats").totalSession:"",j=Math.round(h/c*100),k="ClubVsClub"===this.model.get("challengeCategoryType")?h:d,l=a.template.html(),m=!!this.model.get("challengeGoal"),n=Math.round(b/c*100),o=0,p=c>k?-1:c===k?0:1,q=jQuery(".dtm-challengeprogress").length>0,r=jQuery(".dtm-challengesummary").length>0,s=this.model.get("endDate");(r||q)&&c&&(o=Math.abs(c-k)),s&&(s=new Date(s),s=s.getUTCMonth()+1+"."+(s.getUTCDate()-1)+"."+s.getUTCFullYear(),this.model.set("endDate",s)),this.model.set("userFirstName",this.model.get("me").displayName),this.model.set("milesTogo",e),this.model.set("goalMiles",c),this.model.set("pastGoal",o),this.model.set("pastGoalState",p),this.model.set("isGoalSpecific",m),this.model.set("completePercentage",n),this.model.set("facilityCompletePercentage",j),this.model.set("userDistance",d),this.model.set("userAverageDistance",EQ.Helpers.numbers.trimWithFlooring(f,2)),this.model.set("averageDistance",EQ.Helpers.numbers.trimWithFlooring(g,2)),this.model.set("facilityDistance",h),this.model.set("facilityAverageDistance",h&&i?EQ.Helpers.numbers.trimWithFlooring(h/i,2):0),this.template=_.template(l),console.log("THIS NEW MODEL IS :::: ",this.model),this.render()},getRenderData:function(){var a=this.model.toJSON();return _.extend(o,a)},render:function(){if(this.jQueryel.html(this.template(this.getRenderData())),this.shareHasBeenLoaded!==!1){var a,c,d=this.model.get("challengeTypeId"),e=this.model.get("challengeName"),f=o.getChallengeData(d),g=f.joined,h=f.status;if("Joined"===g)switch(h){case"Closed":a="I just completed the "+e+" at Equinox. #EQXCYCLE",c="I just completed the "+e+" @Equinox. #EQXCYCLE";break;case"Upcoming":a="Im about to ride in the "+e+" at Equinox. #EQXCYCLE",c="Im about to ride in the "+e+" @Equinox. #EQXCYCLE";break;case"InProgress":a="Im riding in the "+e+" at Equinox. #EQXCYCLE",c="Im riding in the "+e+" @Equinox. #EQXCYCLE"}else switch(h){case"Closed":a="Have a look at this months "+e+" at Equinox. Who wants to join me for the next one? #EQXCYCLE",c="Check out this "+e+" @Equinox. Want to join me for the next one? #EQXCYCLE";break;case"Upcoming":a="Have a look at next months "+e+" at Equinox. Who wants to join me? #EQXCYCLE",c="Have a look at next months "+e+" @Equinox. Who wants to join me? #EQXCYCLE";break;case"InProgress":a="Check out the "+e+" at Equinox. Who wants to join me? #EQXCYCLE",c="Check out the "+e+" @Equinox. Who wants to join me? #EQXCYCLE"}b.loadComponent("share",this.jQueryel,{fbMode:"share-dialog",type:"referrals",linkurl:document.location.href||window.location.href,sharecopy:a,TWcopy:c}),this.shareHasBeenLoaded=!0}return this}});var o={getChallengeData:function(a){var b,c,d=EQ.Helpers.getService(i.CHALLENGEDETAIL(a),{},{async:!1},!1);return d.done(function(a){b=null===a.me?"NotJoined":"Joined",c="Upcoming",null===a.daysToGo&&(c=null!==a.daysLeft?"InProgress":"Closed")}),{joined:b,status:c}},getChallengeStatus:function(){var a="Upcoming";return null===this.daysToGo&&(a=null!==this.daysLeft?"InProgress":"Closed"),a}}}}(window,window.App),function(a,b){"use strict";var c,d,e={CYCLINGGROUPS:function(){return"/v3.2/groups/cycling"},CHALLENGETYPEHEADER:function(){return"/v3.2/challenges/cycling/typeDetails"},CHALLENGEDETAIL:function(a){return"/v3.2/challenges/cycling/"+a+"/detail"},ALLCHALLENGES:function(){return"/v3.2/challenges/cycling/details"}},f=Backbone.Model.extend({defaults:[{challengeCategoryTypeId:-1,heroImageUrl:"",iconImageUrl:"",mobileHeroImageUrl:""}]}),g=Backbone.Model.extend({defaults:{title:"",description:"",date:"",riders:""}}),h=Backbone.Collection.extend({model:g}),i=Backbone.View.extend({template:_.template(jQuery("#headerTemplate").html()),render:function(){return this.jQueryel.html(this.template(this.getChallengeType(b.Pages.ChallengesLanding.activeChallengeTypeId))),this},getChallengeType:function(a){var b=this.model.toJSON();return _.each(b,function(c,d){return c.challengeCategoryTypeId===a?b[d]:void 0}),b[0]}}),j=Backbone.View.extend({template:_.template(jQuery("#thisMonthChallengeTemplate").html()),initialize:function(){var a=this,b=jQuery.Deferred(),c=this.model.get("challengeTypeId");this.model.set("joinedStatusString",""),this.model.on("change",this.render,this),b=p.getChallengeData(c),jQuery.when(b).done(function(b){a.model.set("joinedStatusString",b.userJoined+b.userStatus),a.model.set("joinedString",b.userJoined)})},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this.model.get("isVisible")||"NotJoined"!==this.model.get("joinedString")||this.jQueryel.hide(),this}}),k=Backbone.View.extend({el:jQuery(".upcoming-challenges .upcoming-list"),render:function(){var a=this;return this.collection.each(function(b){var c=new l({model:b});a.jQueryel.append(c.render().el)}),this}}),l=Backbone.View.extend({template:_.template(jQuery("#upcomingChallengeTemplate").html()),tagName:"li",initialize:function(){var a=this,b=jQuery.Deferred(),c=this.model.get("challengeTypeId");this.model.set("joinedStatusString",""),this.model.on("change",this.render,this),b=p.getChallengeData(c),jQuery.when(b).done(function(b){a.model.set("joinedStatusString",b.userJoined+b.userStatus),a.model.set("joinedString",b.userJoined)})},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this.model.get("isVisible")||"NotJoined"!==this.model.get("joinedString")||this.jQueryel.hide(),this}}),m=Backbone.View.extend({el:jQuery(".all-past-challenges .list"),initialize:function(){this.collection.on("reset",this.render,this)},render:function(){var a=this;return a.jQueryel.empty(),this.collection.each(function(b){var c=new n({model:b});a.jQueryel.append(c.render().el)}),this}}),n=Backbone.View.extend({template:_.template(jQuery("#pastChallengeTemplate").html()),tagName:"li",initialize:function(){var a=this,b=jQuery.Deferred(),c=this.model.get("challengeTypeId");this.model.set("joinedStatusString",""),this.model.on("change",this.render,this),b=p.getChallengeData(c),jQuery.when(b).done(function(b){a.model.set("joinedStatusString",b.userJoined+b.userStatus),a.model.set("joinedString",b.userJoined)})},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this.model.get("isVisible")||"NotJoined"!==this.model.get("joinedString")||this.jQueryel.hide(),this}}),o=Backbone.View.extend({template:_.template(jQuery("#pagination").html()),currentPage:0,events:{"click ul.pagination li a.page":"changePage","click ul.pagination li.back-page":"back","click ul.pagination li.next-page":"next"},render:function(){for(var a=_.template('<li><a href="#" class="page" data-page="<%= (idx - 1) %>"><%= idx %></a></li>'),b="",c=1;c<=this.collection.length;c++)b+=a({idx:c});return this.jQueryel.html(this.template()),this.jQueryel.find(".back-page").after(jQuery(b)),this.updateSelected(this.currentPage),this},changePage:function(a){a.preventDefault(),a.stopImmediatePropagation();var b=jQuery(a.target),d=b.data("page");this.updateSelected(d),c.reset(q[d])},nextPage:function(){this.updateSelected(this.currentPage),c.reset(q[this.currentPage])},back:function(a){jQuery(a.target).hasClass("disabled")||(this.currentPage--,this.nextPage())},next:function(a){jQuery(a.target).hasClass("disabled")||(this.currentPage++,this.nextPage())},updateSelected:function(a){var b=this.jQueryel.find("li");this.currentPage=a,b.removeClass("selected"),b.find('a[data-page="'+(a||"0")+'"]').parent().addClass("selected"),this.jQueryel.find("li.back-page").toggleClass("disabled",0===a),this.jQueryel.find("li.next-page").toggleClass("disabled",a===this.collection.length-1)}}),p={getChallengeData:function(a){var b=jQuery.Deferred();return EQ.Helpers.getService(e.CHALLENGEDETAIL(a)).done(function(a){var c=null===a.me?"NotJoined":"Joined",d="Upcoming";null===a.daysToGo&&(d=null!==a.daysLeft?"InProgress":"Closed");var e={userJoined:c,userStatus:d};b.resolve(e)}).fail(function(a){b.resolve(a)}),b}},q=[];b.Pages.ChallengesLanding={activeChallengeTypeId:-1,init:function(){EQ.Helpers.getService(e.CYCLINGGROUPS()).done(function(a){a.activeChallengeInfo&&b.Pages.ChallengesLanding.setActiveChallengeType(a.activeChallengeInfo.challengeTypeId),b.Pages.ChallengesLanding.runApi()})},runApi:function(){EQ.Helpers.getService(e.CHALLENGETYPEHEADER()).done(this.renderHeader),EQ.Helpers.getService(e.ALLCHALLENGES()).done(this.renderChallenges)},setActiveChallengeType:function(a){this.activeChallengeTypeId=a},renderHeader:function(a){var b=new f(a),c=new i({model:b});jQuery(".header").append(c.render().el)},renderThisMonthChallenge:function(a){var b=new g(a),c=new j({model:b});jQuery(".this-month-challenge").append(c.render().el)},renderChallenges:function(a){var f=a.activeChallenge,g=a.prevChallenges,i=a.upcomingChallenges;if(f&&EQ.Helpers.getService(e.CHALLENGEDETAIL(f.challengeTypeId)).done(function(a){var c=_.merge(f,a);b.Pages.ChallengesLanding.renderThisMonthChallenge(c)}),i.length>0){var j=new h(_.take(i,2)),l=new k({collection:j});l.render()}else jQuery(".upcoming-challenges").hide();var n=[],p=0,r=4;
if(g.length>0){_.each(g,function(a){n.push(a),p++,p===r&&(q.push(n),p=0,n=[])}),p>0&&q.push(n);var s=new h(q),t=new o({collection:s});jQuery(".all-past-challenges .navigation").append(t.render().el),c=new h(q[0]),d=new m({collection:c}),d.render(),g.length<=4&&jQuery(".all-past-challenges .navigation").hide()}else jQuery(".all-past-challenges").hide(),jQuery(".upcoming-challenges").addClass("no-past-challenges")}}}(window,window.App),function(a){"use strict";a.Components["cycling-milestones"]=function(a){console.log("MILESTONE INIT",a)}}(window.App),function(a,b){"use strict";var c=b.Pages.CyclingPatch={};c.init=function(){var a=3,c=jQuery(".cycling-hero ul.section-carousel"),e=jQuery(".feat ul.section-carousel"),f=jQuery(".team ul.section-carousel");a=c.find("li").length,console.log("APP::::::::::::::::::::::::::::: ",b),b.loadComponent("owl-slider",c,d.getSliderOptions(a)),a=e.find("li").length,b.loadComponent("owl-slider",e,d.getSliderOptions(a)),a=f.find("li").length,b.loadComponent("owl-slider",f,d.getSliderOptions(a));var g=jQuery(".bio-overlay-template").html();jQuery(".view-full-bio").on("click",function(){if(jQuery(window).width()<768){var a="View full bio"===jQuery(this).text()?"Hide full bio":"View full bio";jQuery(this).siblings(".more-info").toggleClass("hidden"),jQuery(this).text(a),jQuery(".meet-our-experts").data("owlCarousel").updateVars()}else{var b=jQuery(this).closest(".item-info").html(),c=jQuery(this).siblings(".more-info");jQuery(".page").append(g),jQuery(".bio-overlay-container .profile-pic-info").append(b),jQuery(".bio-overlay-container .profile-pic-info .more-info").addClass("hidden"),jQuery(".bio-overlay-container .view-full-bio").addClass("hidden"),c.clone().appendTo(jQuery(".bio-overlay-container .profile-info")),jQuery(".profile-info .more-info").removeClass("hidden")}}),jQuery("body").on("click",".close-more-info",function(a){a.preventDefault(),jQuery(window).width()<768?jQuery(this).parent().siblings(".view-full-bio").trigger("click"):jQuery(this).closest(".bio-overlay").remove()})};var d={getSliderOptions:function(a){var b={singleItem:!1,items:a,setAsSingle:!0,itemsDesktop:[1200,a],itemsTablet:[1023,a],itemsMobile:[768,1]};return b}};jQuery(document).ready(function(){c.init()})}(window,window.App),function(a,b){"use strict";b.Pages.GroupFitness={};var c=b.Pages.GroupFitness;c.init=function(){c.omnitCall()},c.omnitCall=function(){jQuery(".search-menu li a").on("click",function(){var a=this.href.split("/")[this.href.split("/").length-1];"search"===a?(window.tagData.searchLink=window.tagData.searchLink||{},window.tagData.searchLink={type:"findaclass",value:""},window.track("clickClassSearchLink",window.tagData.searchLink)):"bookabike"===a&&(window.tagData.searchLink=window.tagData.searchLink||{},window.tagData.searchLink={type:"bike",value:""},window.track("clickClassSearchLink",window.tagData.searchLink))})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.GroupLeaderboard={},d={},e=new moment;d.leaderboardType="group",d.wrapperId="#group-leaderboard-component",d.params={},d.params.year=e.year(),d.params.month=e.month()+1,d.params.metric="distance",d.params.ageRange="all";var f,g,h,i,j,k=jQuery("#ageRange"),l=jQuery("#timeFrame"),m=".select-group-options .selected";user&&(d.params.facilityId=user.FacilityId),c.init=function(){var a;return jQuery("div.page").hasClass("challenge")?!1:void(a=EQ.Helpers.getService("/v1/me").done(function(a){d.params.gender=a.profile.gender.toLowerCase(),p();var e=c.getRegionFacilities();d.params.facilityId=e,n(d.params.gender),b.loadComponent("group-challenge-leaderboard-filters",jQuery("#club")),q()}).fail(function(){d.params.gender="all",p(),b.loadComponent("group-challenge-leaderboard-filters",jQuery("#club")),q()}))},c.getRegionFacilities=function(){var a,b="";return EQ.Helpers.getService("/v1/facilities/"+user.FacilityId,{},{async:!1},!1,!0,!0).done(function(b){a=b.facility.region,a=a.split("/"),a=a[0]}),EQ.Helpers.getService("/v1/facilities",{region:a},{async:!1},!1,!0,!0).done(function(a){_.each(a.facilities,function(a){b+=a.facilityId+","})}),b};var n=function(){b.loadComponent("group-challenge-leaderboard",d)},o=function(a,b){""!==a?"this-month"===a?(d.params.month=e.month()+1,d.params.year=e.year()):"last-month"===a&&(0===e.month()?(d.params.month=12,d.params.year=e.year()-1):(d.params.month=e.month(),d.params.year=e.year())):""!==b&&("this-year"===b?(d.params.month="",d.params.year=e.year()):"last-year"===b&&(d.params.month="",d.params.year=e.year()-1))},p=function(){var a=d.params.gender,b=k.find(m).text(),c=l.find(m).text();jQuery(".select-group#ageRange .select-group-title .filter-title").text(b),jQuery('#gender div[data-gender="'+a+'"]').addClass("selected"),jQuery(".select-group#gender .select-group-title .filter-title").text(a),jQuery(".select-group#timeFrame .select-group-title .filter-title").text(c)},q=function(){jQuery("#current-age-range span").text(jQuery("#ageRange .filter-title").text()),jQuery("#current-gender span").text(jQuery("#gender .filter-title").text()),jQuery("#current-time-frame").text(jQuery("#timeFrame .filter-title").text())},r=function(a){var b;b=a?jQuery(a+".select-wrapper.active"):jQuery("#leaderboardFilters .select-wrapper.active"),b.removeClass("active"),b.find(".filter-icon").toggleClass("hidden")},s=function(){var a=jQuery("#leaderboardFilters .desktop-selected");a.removeClass("desktop-selected").parents(".select-wrapper").find(".select-group-options").addClass("desktop-hidden")};jQuery(document).ready(function(){return jQuery("div.page").hasClass("challenge")?!1:(jQuery("#leaderboardFilters .select-wrapper").on("click",function(a){a.stopPropagation(),d.currentPage=0;var b=jQuery(this);b.hasClass("active")||jQuery(".select-wrapper.active").removeClass("active").find(".filter-icon").toggleClass("hidden"),b.toggleClass("active"),b.find(".filter-icon").toggleClass("hidden"),b.is("#club")&&jQuery(".select-group-title.desktop-selected").removeClass("desktop-selected").parent().find(".select-group-options").addClass("desktop-hidden")}),jQuery("#leaderboardFilters .select-group-title").on("click",function(a){a.stopPropagation();var b=jQuery(this),c=b.parent(),d=b.parents("#club");d.length||(b.hasClass("selected")||jQuery(".select-group-title.selected",this).removeClass("selected").parent().find(".select-group-options").addClass("hidden"),b.hasClass("desktop-selected")||s(),b.toggleClass("selected").toggleClass("desktop-selected"),c.find(".select-group-options").toggleClass("hidden").toggleClass("desktop-hidden"),b.find(".icon").toggleClass("hidden"),r("#club"))}),jQuery("#club").on("click",".select-group-title",function(a){a.stopPropagation();var b=jQuery(this),c=b.find(".region-text").text(),e=b.parent(),f=jQuery("#club");b.hasClass("selected")||jQuery(".select-group-title.selected",f).removeClass("selected").parent().find(".select-group-options").addClass("hidden"),b.addClass("selected"),b.hasClass("desktop-selected")||s(),f.hasClass("region-filter")?(f.find(".dynamic-selection").text(c),null!==b.data("region")&&(d.params.facilityId=b.data("region"),h=b.data("region")),n(),r()):(e.find(".select-group-options").toggleClass("hidden").toggleClass("desktop-hidden"),b.find(".icon").toggleClass("hidden"))}),jQuery("#leaderboardFilters .select-group-options div").on("click",function(a){a.stopPropagation();var b=jQuery(this),c=b.text(),e=b.parents(".select-group"),f=b.parents(".select-wrapper"),g=e.find(".select-group-title .filter-title");if(d.params.pageNumber=1,b.parent().find("div.selected").removeClass("selected"),b.addClass("selected"),f.hasClass("dynamic-title")&&f.find(".dynamic-selection").text(c),e.is("#ageRange"))d.params.ageRange=b.data("age"),jQuery("#current-age-range span").text(c),g.text(c);else if(e.is("#gender"))d.params.gender=b.data("gender"),jQuery("#current-gender span").text(c),g.text(c);else if(e.is("#timeFrame")){var h=b.data("month"),i=b.data("year");o(h,i),jQuery("#current-time-frame").text(c),g.text(b.text())}else e.is("#metric")&&(d.params.metric=b.data("metric"),r());n(),s()}),jQuery("#club").on("click",".select-group-options div",function(a){a.stopPropagation();var b=jQuery(this),c=b.text(),e=b.parents(".select-wrapper");jQuery("#club .select-group-options div.selected").removeClass("selected"),b.addClass("selected"),e.find(".dynamic-selection").text(c),null!==b.data("club")&&(d.params.facilityId=b.data("club"),i=b.data("club")),r(),n()}),jQuery("#leaderboardFilters .select").on("click",function(a){a.stopPropagation()}),jQuery("body").on("click",function(){r(),s()}),jQuery("#club").on("click",function(){s()}),jQuery("#sortBy dl dd").on("click",function(){var a=jQuery(this);a.hasClass("desktop-selected")||s(),a.toggleClass("desktop-selected");var b=a.parents(".select-wrapper");b.find(".select-group-options").toggleClass("desktop-hidden")}),void jQuery(".tier-1-filters a").on("click",function(){jQuery(".tier-1-filters a.active").removeClass("active");var a=jQuery(this),b="999"!==window.userProfileJson.FacilityId?window.userProfileJson.FacilityId:"102",k=EQ.Helpers.getFacilityById(b);d.params.showFacebookFriends=!1,d.params.pageNumber=1,a.addClass("active"),a.is("#club-filter")?(jQuery("#club").removeClass("region-filter").removeClass("hidden"),j=jQuery("#club .select-group-options .selected"),g=j.text(),i=j.data("club"),null===i?(jQuery(".selected-location").text(k.ClubName),d.params.pageNumber="",d.params.facilityId=user.FacilityId):(""!==g&&jQuery(".selected-location").text(g),d.params.facilityId=i)):a.is("#region-filter")?(f=jQuery("#club .select-group-title.selected"),g=f.find(".region-text").text(),h=f.data("region"),jQuery("#club").addClass("region-filter").removeClass("hidden"),null===h?(jQuery(".selected-location").text(k.Region),d.params.pageNumber="",d.params.facilityId=c.getRegionFacilities()):(""!==g&&jQuery(".selected-location").text(g),d.params.facilityId=h)):a.is("#all-filter")?(jQuery("#club").removeClass("region-filter").addClass("hidden"),jQuery("#ageRange div").removeClass("selected"),jQuery('#ageRange div[data-age="all"]').addClass("selected"),jQuery(".select-group#ageRange .select-group-title .filter-title").text("ALL"),jQuery("#current-age-range span").text("ALL"),jQuery("#gender div").removeClass("selected"),jQuery('#gender div[data-gender="all"]').addClass("selected"),jQuery(".select-group#gender .select-group-title .filter-title").text("ALL"),jQuery("#current-gender span").text("ALL"),jQuery("#timeFrame div").removeClass("selected"),jQuery('#timeFrame div[data-year="this-year"]').addClass("selected"),jQuery(".select-group#timeFrame .select-group-title .filter-title").text("THIS YEAR"),jQuery("#current-time-frame").text("THIS YEAR"),jQuery("#metric div").removeClass("selected"),jQuery('#metric div[data-metric="distance"]').addClass("selected"),jQuery(".select-wrapper#sortBy .dynamic-selection").text("DISTANCE"),d.params={metric:"distance",facilityId:"",ageRange:"none",year:e.year(),month:"",gender:"all"}):a.is("#friends-filter")&&(jQuery("#club").removeClass("region-filter").addClass("hidden"),d.params.facilityId="",d.params.showFacebookFriends=!0),n()}))})}(window,window.App),function(a,b){"use strict";var c=b.Pages.Home={},d=jQuery("body"),e=jQuery(a);c.fitElement={currentTop:0,currentPage:0,hideTimeout:void 0,isSupported:function(){return!1},isTouch:function(){return"undefined"!=typeof document.documentElement.ontouchstart},bind:function(){var a=this;e.on("orientationchange",function(){c.fitElement.isTouch()&&c.fitElement.isSupported()&&a.touchSupport(a.isSupported()),a.jQueryel.removeClass("animating"),a.jQuerychildren.removeClass("active"),jQuery(".more-button").removeClass("hidden scrolling"),c.fitElement.isSupported()===!1?(d.removeClass("closed-nav"),d.addClass("no-snap")):(d.addClass("closed-nav"),d.removeClass("no-snap")),c.fitElement.isTouch()&&c.fitElement.isSupported()&&(a.currentPage=0,a.setScrollTop(0)),jQuery(".elevator a").removeClass("selected"),jQuery(".elevator a").eq(0).addClass("selected"),jQuery(".page-wrapper").data("plugin_stellar")&&jQuery(".page-wrapper").data("plugin_stellar").refresh(),c.fitElement.isTouch()&&c.fitElement.isSupported()&&void 0===jQuery(".page-wrapper").data("plugin_stellar")&&jQuery(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1})}),this.jQueryel.on("webkitTransitionEnd transitionend",function(b){b.target===a.jQueryel[0]&&(a.jQueryel.removeClass("animating"),jQuery(".more-button").removeClass("scrolling"),c.fitElement.hideTimeout=setTimeout(function(){jQuery(".elevator").addClass("hide")},2e3))}),jQuery("nav.main .full-wrapper").on("touchend",function(a){a.stopPropagation()}).on("touchmove",function(a){a.preventDefault()});for(var b=this.jQuerychildren.length-1,f=0;b>f;f++){var g=jQuery('<a href="#" class="elevator-button" data-index="'+f+'"><span class="inner"></span></a>');jQuery(".elevator").append(g)}jQuery(".elevator a").eq(0).addClass("selected"),jQuery(".elevator-trigger").on("click",this.elevator),jQuery(".elevator-button").on("click",this.elevator),jQuery(".more-button-desktop").on("click",this.elevator),jQuery(".more-button").on("click",function(){c.fitElement.currentPage<c.fitElement.jQuerychildren.length-2&&(c.fitElement.currentPage++,c.fitElement.goTo())})},init:function(a,b){this.jQueryel=jQuery(a),this.jQuerychildren=this.jQueryel.find(b),this.jQuerychildren=this.jQuerychildren.filter(function(a,b){return 0===jQuery(b).find(".no-snap").length}),this.bind(),this.isSupported()&&this.touchSupport(!0)},getScrollTop:function(a){a=a||this.jQueryel;var b=a.css("transform");return"none"!==b?-1*parseInt(b.match(/(-?[0-9]+)/g)[5],10):0},setScrollTop:function(a){this.maxScrollTop=this.jQueryel.height()-this.jQuerychildren.eq(0).height(),1>a?a>=-this.maxScrollTop&&this.jQueryel.css("transform","translate3d(0, "+a+"px, 0)"):this.jQueryel.css("transform","translate3d(0, 0, 0)")},goNext:function(){return this.currentPage===this.jQuerychildren.length-1?!1:(this.currentPage++,this.goTo(),!0)},goPrev:function(){return 0===this.currentPage?!1:(this.currentPage--,this.goTo(),!0)},goTo:function(){var a=this.jQuerychildren.eq(this.currentPage),b=this.jQueryel;this.currentPage?d.removeClass("closed-nav"):d.addClass("closed-nav"),clearTimeout(this.hideTimeout);var c=jQuery(".elevator a"),e=jQuery(".elevator a.selected"),f=jQuery(".elevator");e.removeClass("selected"),c.eq(this.currentPage).addClass("selected"),f.removeClass("hide"),a.find(".carousel").first().hasClass("black")===!0||a.find(".rich-content").first().hasClass("black")===!0?f.addClass("black"):f.removeClass("black"),jQuery(".more-button").addClass("scrolling"),jQuery(".more-button").removeClass("hidden"),b.addClass("animating"),this.jQuerychildren.removeClass("active"),a.addClass("active"),"Footer"!==a.data("template")?this.setScrollTop(-a.position().top):(f.addClass("hide"),this.setScrollTop(-(b.height()-this.jQuerychildren.eq(0).height()))),this.currentPage>=1&&jQuery(".more-button").addClass("hidden")},elevator:function(a){if(a.preventDefault(),c.fitElement.isSupported()===!0)jQuery(".elevator a").removeClass("selected"),jQuery(".elevator a").eq(jQuery(this).data("index")).addClass("selected"),c.fitElement.currentPage=+jQuery(this).data("index"),c.fitElement.goTo();else{var b=jQuery(".page-snap").eq(jQuery(this).data("index")).offset().top-jQuery("nav.main").height();jQuery("body").animate({scrollTop:b})}}},c.fitElement.touchSupport=function(a){var b,c,e,f,g,h,i="touchstart",j="touchmove",k="touchend",l=!1,m=function(d){if(0===jQuery(d.target).closest(".no-snap").length||0===jQuery(d.target).hasClass("no-snap").length){var g=d.touches[0];e||a.jQueryel.is(".animating")?d.preventDefault():(e=g.pageY,f=g.pageX,c=a.getScrollTop(),b.addEventListener(j,n,!1),b.addEventListener(k,o,!1))}},n=function(b){if(0===jQuery(b.target).closest(".no-snap").length||0===jQuery(b.target).hasClass("no-snap").length){var d=b.touches[0];h=d.pageY-e,g=d.pageX-f,l=Math.abs(g)>Math.abs(h),l||(b.preventDefault(),a.setScrollTop(h-c))}},o=function(d){(0===jQuery(d.target).closest(".no-snap").length||0===jQuery(d.target).hasClass("no-snap").length)&&(!l&&Math.abs(h)>10?0>h?a.goNext():h>0&&a.goPrev():a.setScrollTop(-c),h=null,e=null,l=!1,b.removeEventListener(j,n,!1),b.removeEventListener(k,o,!1))};return function(c){return b=a.jQueryel[0],c?(b.addEventListener(i,m,!1),a.currentPage?a.goTo():(d.addClass("closed-nav"),d.scrollTop(0)),d.addClass("page-snap-enabled"),void 0):(a.setScrollTop(0),a.currentPage=0,d.removeClass("page-snap-enabled closed-nav"),b.removeEventListener(i,m,!1))}}(c.fitElement),c.omnitCall=function(){jQuery(".search-menu li a").on("click",function(){var a=this.href.split("/")[this.href.split("/").length-1];"search"===a?(window.tagData.searchLink=window.tagData.searchLink||{},window.tagData.searchLink={type:"findaclass",value:""},window.track("clickClassSearchLink",window.tagData.searchLink)):"bookabike"===a&&(window.tagData.searchLink=window.tagData.searchLink||{},window.tagData.searchLink={type:"bike",value:""},window.track("clickClassSearchLink",window.tagData.searchLink))})},c.init=function(){if(console.log("init callled"),c.fitElement.isSupported()===!1&&jQuery(".home-splash").height(jQuery(window).height()-jQuery("nav.main").height()),c.omnitCall(),c.fitElement.init(".page-wrapper",".page-snap"),c.fitElement.isTouch()&&c.fitElement.isSupported()){jQuery(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1});var a="HomePageTopParallax"===jQuery(".page-snap").data("template");a&&jQuery(".dtm-homepagetopparallax").addClass("active")}c.showRecommendedClasses()},c.showRecommendedClasses=function(){jQuery('[data-component="analytics-recomnded-classes"]').length?jQuery(".recommended-classes-home").removeClass("hidden"):jQuery(".recommended-classes").removeClass("hidden")}}(window,window.App),function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=b.Pages.JanChallenge2015={},w=[],x=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,y={MONTHPROGRESS:function(){return"/v3.1/janchallenge2015/overallprogress"},WEEKSCORES:function(){return"/v3.1/janchallenge2015/allweekscores"},SCORECARD:function(a){return"/v3.1/janchallenge2015/challenges/"+a+"/scorecard"},CHALLENGES:function(){return"/v3.1/janchallenge2015/challenges"},INCHALLENGE:function(){return"/v3.1/janchallenge2015/inchallenge"},FACILITYDETAILS:function(a){return"/v1/facilities/"+a}},z="--",A={},B=[],C=!0,D=jQuery(".tpl-weekchallengegroupend").length;window.requestAnimationFrame=x,v.init=function(){console.log("init triggered ");var a=jQuery(".tpl-weekendchallenge").length;switch(o=jQuery("#scorecard-wrapper .scorecard"),EQ.Helpers.getDevicePlatform()){case"ios":s="orientationchange";break;case"android":s="orientationchange";break;default:s="resize"}r=D?jQuery(".dtm-challengescorecardend li:not(.hidden) a"):jQuery(".dtm-challengescorecard .selected"),jQuery(window).bind("scroll",v.checkView),jQuery(window).bind(s,function(){clearTimeout(t),t=setTimeout(function(){v.refreshScorecard(r.attr("data-tab"))},250)}),EQ.Helpers.getService(y.INCHALLENGE()).done(function(b){var c=jQuery.Deferred(),d=EQ.Helpers.getService(y.CHALLENGES());null!==b.optInFacilityId?c=EQ.Helpers.getService(y.FACILITYDETAILS(b.optInFacilityId)):c.resolve({facility:{currentDateTime:new moment,name:"--"}}),EQ.Helpers.when(d,c).done(function(b){var c=b[0];console.log("DONE::: challengeData ",c),j=b[1].facility,z=j.webName,q=c.challenges.length;var d=4===q?"week4":"week3",e=v.getCurrentWeek(c.challenges,j.currentDateTime);l=e.week?e.week:d,m=e.id?e.id:c.challenges[0].challengeId,n=!v.isChallengeStarted(j.currentDateTime,c.challenges[0]),l=n?"week1":l.toLowerCase(),k=b[1].facility.currentDateTime,A=b[1].facility.timeZone,a&&window.currentWeekendChallenge&&(v.addWeekendChallenge(),v.checkView()),1!==q||D?1===q&&D?(jQuery("#week-tabs li").addClass("two"),jQuery("#week-tabs li").eq(1).hide(),jQuery("#week-tabs li").eq(2).hide()):3===q?jQuery("#week-tabs li").addClass("three"):jQuery("#week-tabs li").addClass("four"):(jQuery("#week-tabs li").addClass("one"),jQuery("#week-tabs li").eq(1).hide(),jQuery("#week-tabs li").eq(2).hide()),D&&jQuery("#week-tabs li").addClass("challenge-over"),EQ.Helpers.getService(y.MONTHPROGRESS()).done(function(a){u=v.isChallengeStarted(j.currentDateTime,a),v.displayMonthProgress(new Backbone.Model(a)),EQ.Helpers.getService(y.WEEKSCORES()).done(function(a){a.allWeekRanks?v.displayWeekScores(new Backbone.Model(a)):v.weekScoresZeroState()}).fail(v.weekScoresZeroState),EQ.Helpers.getService(y.SCORECARD(m)).done(function(a){console.log("SCORECARD RESPONSE ::: ",a),null!==a.weeklyScoreCard&&a.weeklyScoreCard.weeklyScore?v.displayScorecards(a):v.scoredataZeroState()}).fail(function(){v.scoredataZeroState()})}).fail(function(){v.challengeHeroZeroState(),v.weekScoresZeroState(),v.scoredataZeroState()})})}),jQuery(".tpl-challengescorecard nav ul li a").on("click",v.showChallengeScorecard),jQuery(".tpl-challengescorecardend nav ul li a").on("click",function(a){a.preventDefault()}),p=jQuery(".tpl-weekchallengegroup nav ul li a, .tpl-weekchallengegroupend nav ul li a"),p.on("click",v.weekTabEvent);var b=3===jQuery("#scoringCarousel li").length||3===jQuery("#monthly-scorecard .item").length||3===jQuery("#weekly-scorecard .item").length?3:(window.user&&1!==window.userProfileJson.SourceSystem,4);jQuery("#weekly-scorecard").owlCarousel({avoidRidiculouslySpecificOption:!0,itemsCustom:[[0,1],[1024,b]],afterUpdate:function(){v.checkView()},afterMove:function(){setTimeout(v.checkView,250)},afterInit:function(){v.checkView()}}),jQuery("#monthly-scorecard").owlCarousel({avoidRidiculouslySpecificOption:!0,itemsCustom:[[0,1],[1024,b]],afterUpdate:function(){v.checkView()},afterMove:function(){setTimeout(v.checkView,250)},afterInit:function(){v.checkView()}}),jQuery("#scoringCarousel").owlCarousel({avoidRidiculouslySpecificOption:!0,itemsCustom:[[0,1],[1024,b]]})},v.isChallengeStarted=function(a,b){var c=new moment(b.startDate),d=new moment(a);return d.diff(c,"seconds")<=0?!1:!0},v.isChallengeLastday=function(a){var b=new moment(a.endDate),c=new moment;return 0===c.diff(b,"days")&&b.diff(c,"milliseconds")>=0?!0:!1},v.weekTabEvent=function(a){a.preventDefault();var b=jQuery(this),c=b.attr("data-tab"),d=b.attr("data-challenge-id"),e=jQuery(".challenge-scorecard-over li.li-weekly"),f=jQuery(".challenge-scorecard-over li.li-monthly");return b.hasClass("selected")||b.hasClass("disabled")?!1:(jQuery("#challenge-wrapper .challenge").addClass("hidden"),jQuery("#"+c+"-challenge").removeClass("hidden"),b.parents("ul").find("a.selected").removeClass("selected"),b.addClass("selected"),e.toggleClass("hidden","results"===c),f.toggleClass("hidden","results"!==c),r=D?jQuery(".dtm-challengescorecardend li:not(.hidden) a"):jQuery(".dtm-challengescorecard .selected"),d&&EQ.Helpers.getService(y.SCORECARD(d)).done(function(a){console.log("response ::: ",a),null!==a.weeklyScoreCard&&a.hasOwnProperty("weeklyScoreCard")?v.displayScorecards(a):v.scoredataZeroState()}).fail(function(){v.scoredataZeroState()}),jQuery('div [id^="digital-challenge-week"]').addClass("hidden"),void jQuery("#digital-challenge-"+c).removeClass("hidden"))},v.refreshScorecard=function(a){var b=jQuery("#"+a+"-scorecard"),c=o.not(b);c.addClass("hidden"),b.css("z-index","-999").removeClass("hidden").css("opacity",1),jQuery("canvas").remove(),setTimeout(function(){v.resizeRedraw(),b.css("z-index","auto"),jQuery("body").innerWidth()>1024?b.parents("header").css("height",b.outerHeight(!0)+90):b.removeAttr("height"),setTimeout(v.checkView,50)},100)},v.showChallengeScorecard=function(a){a.preventDefault();var b=jQuery(this);b.hasClass("selected")||(v.refreshScorecard(b.attr("data-tab")),b.parents("ul").find("a.selected").removeClass("selected"),b.addClass("selected"))},v.challengeHeroZeroState=function(){var a={userRank:0,overallRanks:0,facilityName:z,points:0,daysLeft:0};v.displayMonthProgress(new Backbone.Model(a))},v.weekScoresZeroState=function(){var a={allWeekRanks:[{challengeId:1,name:"week1",rank:0,points:0,startDate:B[0].start,endDate:B[0].end},{challengeId:2,name:"week2",rank:0,points:0,startDate:B[1].start,endDate:B[1].end},{challengeId:4,name:"week4",rank:0,points:0,startDate:B[2].start,endDate:B[2].end},{challengeId:3,name:"week3",rank:0,points:0,startDate:B[3].start,endDate:B[3].end}]};v.displayWeekScores(new Backbone.Model(a))},v.scoredataZeroState=function(){var a={weeklyScoreCard:{weeklyScore:[{categoryId:1,categoryName:"Club Check-in",points:0,maxPoints:0},{categoryId:2,categoryName:"In-Club Activity",points:0,maxPoints:0},{categoryId:3,categoryName:"Referrals Bonus",points:0,maxPoints:0},{categoryId:4,categoryName:"Weekly Digital Activity",points:0,maxPoints:0},{categoryId:5,categoryName:"Weekend Bonus",points:0,maxPoints:0}]},monthlyScoreCard:{monthlyScore:[{categoryId:1,categoryName:"Club Check-in",points:0,maxPoints:0},{categoryId:2,categoryName:"In-Club Activity",points:0,maxPoints:0},{categoryId:3,categoryName:"Referrals Bonus",points:0,maxPoints:0},{categoryId:4,categoryName:"Weekly Digital Activity",points:0,maxPoints:0},{categoryId:5,categoryName:"Weekend Bonus",points:0,maxPoints:0}]}};v.displayScorecards(a)},v.checkView=function(){function a(a){if(!a.length)return!1;var b=jQuery(document).scrollTop(),c=b+jQuery(window).height(),d=a.offset().top,e=jQuery(window).width(),f=a.offset().left;return c>=d&&e>f&&a.is(":visible")}jQuery.each(w,function(b,c){var d=c.timeLeft?c.timeLeft:c.points,e=c.timeTotal?c.timeTotal:c.max;!c.active&&a(c.el)&&(v[c.func](c.el,d,e),c.active=!0)})},v.displayDigitalChallenge=function(){if(C){var a="#digital-challenge-"+l;jQuery(a).removeClass("hidden"),C=!1}},v.weekendCountdown=function(a,b,c){function d(a){var e=1-a,q=Math.floor(e*c);q=q>b?q:b,1===q&&k.text("Hour left!"),console.log("displayHours= "+q),j.html(q),i.clearRect(0,0,i.canvas.width,i.canvas.height),i.beginPath(),i.arc(f,g,h,-p,o*e-p,n),i.stroke(),m++,l>=m?x(function(){d(m/100)}):(j.html(b),1===b&&k.text("Hour left!"))}var e=jQuery("<canvas/>");a.append(e);var f,g,h,i=e[0].getContext("2d"),j=a.find(".number"),k=a.find(".hours"),l=100-Math.ceil(b/c*100),m=0,n=!0,o=2*Math.PI,p=Math.PI/2;i.canvas.width=e.parent().width(),i.canvas.height=e.parent().height(),i.lineWidth=2,i.strokeStyle="#c2ce00",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=2,i.shadowColor="#656565",f=i.canvas.width/2,g=i.canvas.height/2,h=f-i.lineWidth+1,d()},v.animateScorecard=function(a,b,c){function d(a){a=a||0;var e=Math.floor(a*c);e=b>e?e:b,j.html(e),i.clearRect(0,0,i.canvas.width,i.canvas.height),i.beginPath(),i.arc(f,g,h,-o,n*a-o,m),i.stroke(),l++,k>=l?x(function(){d(l/100)}):j.html(b)}var e=jQuery("<canvas/>");a.find("canvas").remove(),a.append(e);var f,g,h,i=e[0].getContext("2d"),j=a.find(".number"),k=Math.ceil(b/c*100),l=0,m=!1,n=2*Math.PI,o=Math.PI/2;i.canvas.width=e.parent().width(),i.canvas.height=i.canvas.width,i.lineWidth=i.canvas.width/2/9,i.strokeStyle="#c2ce00",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=2,i.shadowColor="#f0ff02",f=i.canvas.width/2,g=i.canvas.height/2,h=f-i.lineWidth/2,d()},v.resizeRedraw=function(){jQuery("canvas").remove(),jQuery.each(w,function(a,b){var c=b.points?b.points:b.timeLeft,d=b.max?b.max:b.timeTotal;b.active&&v[b.func](b.el,c,d)})},v.numberSuffix=function(a){var b=EQ.Helpers.ordinate(a);return b.num+"<sup>"+b.ord+"</sup>"},v.getDateRange=function(a,b){var c=["January","February","March","April","May","June","July","August","September","October","November","December"],d=new moment(a),e=new moment(b),f=d.month()!==e.month()?" - "+c[e.month()]+" ":"-";return c[d.month()]+" "+moment(d).date()+f+e.subtract(1,"days").date()},v.getCurrentWeek=function(a,b){var c,d,e={},f=b?new moment(b,moment.ISO_8601).utc():(new moment).utc();return _.forEach(a,function(a){c=new moment(a.startDate).utc(),d=new moment(a.endDate).utc(),B.push({start:c,end:d,challengeId:a.challengeId,name:a.name}),f.isBetween(c,d)&&(e={week:a.name,id:a.challengeId})}),e},v.setupWeekTabs=function(){var a=jQuery("#week-tabs li a"),b=l.substring(l.length-1,l.length),c=B.length;b--,console.log("currentWeek :: ",l),a.each(function(a,d){var e=jQuery(d),f=jQuery(".results-tab");c>a&&e.attr("data-challenge-id",B[a].challengeId),n||(b>=a&&e.removeClass("disabled"),e.hasClass("results-tab")&&e.removeClass("disabled")),e.attr("data-tab")!==l||D?D&&(f.addClass("selected"),f.attr("data-challenge-id",B[0].challengeId)):e.addClass("selected")})},v.displayMonthProgress=function(a){var b,d;i=new c({model:a,el:jQuery("#challenge-hero-content")}),b=jQuery(".stats li.daysleft .days"),d=jQuery(".stats li.daysleft .subtitle"),"0"===b.text()?v.isChallengeLastday(a.attributes)?(b.remove(),d.text("Last Day").addClass("lastday").removeClass("subtitle")):d.text("Day Left"):"1"===b.text()&&d.text("Day Left")},v.displayWeekScores=function(a){a.set({isLeaderBoardVisible:u}),h=new d({model:a}),D?jQuery("#results-challenge").removeClass("hidden"):jQuery("#"+l+"-challenge").removeClass("hidden"),v.setupWeekTabs()},v.displayScorecards=function(a){w.length=0,v.populateChallengeData("weekly",v.parseScoreCardObj(a.weeklyScoreCard.weeklyScore)),v.populateChallengeData("monthly",v.parseScoreCardObj(a.monthlyScoreCard.monthlyScore)),v.displayDigitalChallenge(),v.refreshScorecard(r.attr("data-tab"))},v.populateChallengeData=function(a,b){for(var c,d=-1,e=b.length;++d<e;)c={},c.max=b[d].maxPoints,c.points=b[d].points,c.active=!1,c.func="animateScorecard",c.el=jQuery("#"+a+"-"+b[d].categoryName.replace(/\s+/g,"-").toLowerCase()),w.push(c)},v.parseScoreCardObj=function(a){Array.prototype.sum=function(a){for(var b=0,c=0,d=this.length;d>c;c++)b+=this[c][a];return b};var b=_.groupBy(a,"categoryId"),c=[],d={};return _.each(b,function(a){a.length>1?(d.maxPoints=a.sum("maxPoints"),d.points=a[0].points,d.categoryName=5===a[0].categoryId?"Weekend Bonus":a[0].categoryName,d.categoryId=a[0].categoryId,c.push(d)):c.push(a[0])}),c},v.addWeekendChallenge=function(){var a=new moment(v.convertStringDate(window.currentWeekendChallenge.startDate)).utcOffset(0),b=new moment(v.convertStringDate(window.currentWeekendChallenge.endDate)).utcOffset(0),c=new moment(k,moment.ISO_8601).utcOffset(0).endOf("hour"),d=b.diff(a,"hours"),e=b.diff(c,"hours"),f={};f.timeLeft=e,f.timeTotal=d,f.active=!1,f.func="weekendCountdown",f.el=jQuery("#weekend-challenge"),w.push(f)},v.convertStringDate=function(a){var b=a.substr(0,4),c=a.substr(4,2),d=a.substr(6,2),e=a.substr(9,2),f=a.substr(11,2),g=a.substr(13,2);return b+"-"+c+"-"+d+"T"+e+":"+f+":"+g},c=Backbone.View.extend({template:_.template(jQuery("#challengeHeroTemplate").html()),initialize:function(a){var b=this.model.get("userRank")?v.numberSuffix(+this.model.get("userRank")):"--";if(this.model.set("userRank",b),this.jQueryel=a.el,n){var c=moment(),d=moment(this.model.get("startDate")),e=d.diff(c,"days");this.model.set("daysLeft",e+1)}this.render()},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this}}),d=Backbone.View.extend({el:jQuery("#challenge-wrapper"),initialize:function(){this.render()},events:{"click a.social":"socialShare"},render:function(){var a=new Backbone.Collection(this.model.get("allWeekRanks")),b={};if(a.each(function(a){a.attributes.dateRange=v.getDateRange(a.attributes.startDate,a.attributes.endDate),a.attributes.userAvatar=APIUrl+"/v3.1/me/picture",a.attributes.isLeaderBoardVisible=this.model.get("isLeaderBoardVisible");var c=new e({model:a,template:"week-challenge-template-"+a.attributes.name.replace(" ","").toLowerCase()});this.jQueryel.append(c.render().el),D&&(b[a.attributes.name.toLowerCase()]=a.attributes.points),n&&jQuery(".cta-wrapper a").attr("href","#")},this),D){var c=new Backbone.Model(b);c.set({isLeaderBoardVisible:this.model.get("isLeaderBoardVisible")});var d=new e({model:c,template:"week-challenge-template-results"});this.jQueryel.append(d.render().el)}},socialShare:function(a){a.preventDefault();var b=jQuery(a.target).parent().parent(),c=jQuery(a.target).parent().attr("data-social"),d="https:"+MainDomain+"/corporatechallenge/share",e=b.find(".share-image").data("share-image");-1===e.indexOf("equinox.com")&&(e="https:"+MainDomain+e),e=e.split("?"),e=e[0],console.log("picture",e),"facebook"===c?window.FB.ui({method:"feed",link:d,name:"#EQXCHALLENGE",caption:b.find(".facebook-copy").attr("data-facebook-copy"),description:b.find(".facebook-copy-bottom").attr("data-facebook-copy-bottom"),picture:e,message:""}):window.open("https://twitter.com/intent/tweet?url="+d+"&text="+b.find(".twitter-copy").attr("data-twitter-copy"))}}),e=Backbone.View.extend({initialize:function(a){var b=this.model.get("rank")?v.numberSuffix(+this.model.get("rank")):"--";this.model.set("facilityName",z),this.model.set("rank",b),this.template=_.template(jQuery("#"+a.template).html())},render:function(){return this.jQueryel.html(this.template(this.model.toJSON())),this}}),f=Backbone.View.extend({initialize:function(){this.render()},render:function(){var a=new Backbone.Collection(this.model.get("allWeekRanks")),b=v.getCurrentWeek(this.model.get("allWeekRanks"),this.model.get("currentDateTime")),c={},d=4===q?"week4":"week3";
b=b.week?b.week:d,a.each(function(a){a.attributes.name===b&&(c.userAvatar=APIUrl+"/v3.1/me/picture",c.facilityName=z,c.rank=a.attributes.rank?v.numberSuffix(a.attributes.rank):"--",c.weekName=a.attributes.name,c.points=a.attributes.points)},this);var e=_.template(jQuery("#challengehomepagemodule-week-template").html(),c);this.jQueryel.html(e)}}),g=Backbone.View.extend({initialize:function(){this.render()},render:function(){var a={};a.rank=this.model.attributes.userRank?v.numberSuffix(this.model.attributes.userRank):"--",a.points=this.model.attributes.points,a.facilityName=this.model.attributes.facilityName;var b=_.template(jQuery("#challengehomepagemodule-month-template").html(),a);this.jQueryel.html(b)}}),window.getMappings=function(){}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Join={};c.SelectClub={},c.SelectMembership={},c.MembershipPurchase={},c.ThankYouPage={},c.SelectClub.FindByZip=function(a,b){var c=APIEndpoint+"/facilities",d=jQuery('input[name="SearchByZip.ZipCode"]').val();jQuery.get(c,{zip:d,numberFacilities:5,radius:1e3},function(c){if(a&&"function"==typeof a)if(0===c.facilities.length)EQ.Geo.getLatLng(function(){EQ.Geo.getNearestClub(function(b){return null===b||void 0===b?(a(),!1):(debug("[GetNearestClub] ",b),jQuery(".nearme").data("clubSelector").set(b),a(),void 0)})},b);else{var d=c.facilities[0];jQuery(".nearme").data("clubSelector").set(d),a()}}).fail(function(){EQ.Geo.getLatLng(function(){EQ.Geo.getNearestClub(function(b){return null===b||void 0===b?(a(),!1):(debug("[GetNearestClub] ",b),jQuery(".nearme").data("clubSelector").set(b),a(),void 0)})},b)})},c.SelectClub.bind=function(){jQuery(".search").on("submit",function(a){a.preventDefault(),jQuery(this).data("publicMethods").isValid()&&(jQuery('input[type="submit"]').data("original-text",jQuery('input[type="submit"]').val()).val("Loading...").attr("disabled",!0),c.SelectClub.FindByZip(function(){jQuery("form").addClass("is-hidden"),jQuery(".nearme-wrapper").removeClass("is-hidden"),jQuery(".tpl-ctacallout a").css("display","block")},function(){jQuery('input[type="submit"]').val(jQuery('input[type="submit"]').data("original-text")).attr("disabled",!1),jQuery("form").find(".is-error").removeClass("hidden").text("Please try again later or enable Geolocation.")}),jQuery('.nearme select[name="facilities"]').on("change",function(){var a=jQuery(".nearme").data("clubSelector").get().URL,b=a.split("/");jQuery(".tpl-ctacallout a").attr("href","/join/"+b[b.length-1])}))})},c.SelectClub.init=function(){c.SelectClub.bind()},c.SelectMembership.bind=function(){jQuery("a.join-now").on("click",function(a){a.preventDefault(),jQuery(this).next("form").submit()})},c.SelectMembership.promotions=function(){var a=0;jQuery(".membership-price-info").each(function(){jQuery(this).height()>=a&&(a=jQuery(this).height())}),jQuery(".membership-price-info").height(a)},c.SelectMembership.init=function(){c.SelectMembership.bind(),c.SelectMembership.promotions(),jQuery(window).on("resize",_.throttle(function(){c.SelectMembership.promotions()},400))},c.MembershipPurchase.Submit=function(){var a=APIEndpoint+"/registration/residential";jQuery(".personal-information .submit").attr("disabled",!0),jQuery(".personal-information .submit").val("Purchasing...");var b=jQuery(".personal-info"),d=jQuery(".billing-info"),e=b.find('input[name="Plan.CountryName"]').val(),f={firstName:b.find('input[name="MemberInformation.FirstName"]').val(),lastName:b.find('input[name="MemberInformation.LName"]').val(),emailAddress:b.find('input[name="MemberInformation.EmailAddress"]').val(),phoneNumber:b.find('input[name="MemberInformation.PhoneNumber"]').val(),address:{street:b.find('input[name="MemberInformation.Address1"]').val(),"street-additional":b.find('input[name="MemberInformation.Address2"]').val(),city:b.find('input[name="MemberInformation.City"]').val(),state:b.find('select[name="MemberInformation.State"]').val(),province:"",zip:b.find('input[name="MemberInformation.ZipCode"]').val(),country:e,stateProvince:"US"!==e&&"CA"!==e?b.find('input[name="MemberInformation.State"]').val():b.find('select[name="MemberInformation.State"]').val()}},g={emailAddress:d.find('input[name="BillingInformation.EmailAddress"]').val(),phoneNumber:d.find('input[name="BillingInformation.PhoneNumber"]').val(),address:{street:d.find('input[name="BillingInformation.Address1"]').val(),"street-additional":d.find('input[name="BillingInformation.Address2"]').val(),city:d.find('input[name="BillingInformation.City"]').val(),state:d.find('select[name="BillingInformation.State"]').val(),province:"",zip:d.find('input[name="BillingInformation.ZipCode"]').val(),country:e,stateProvince:"US"!==e&&"CA"!==e?d.find('input[name="BillingInformation.State"]').val():d.find('select[name="BillingInformation.State"]').val()}},h={facilityId:b.find('input[name="Plan.FacilityId"]').val(),membershipPlanId:b.find('input[name="Plan.PlanId"]').val(),countryId:b.find('input[name="sourceSystem"]').val(),member:f,billing:g,creditCard:{nameOnCard:d.find('input[name="BillingInformation.NameOnCard"]').val(),cardNumber:d.find('input[name="BillingInformation.CreditCardNumber"]').val(),expirationMonth:d.find('select[name="BillingInformation.ExpirationMonth"]').val(),expirationYear:d.find('select[name="BillingInformation.ExpirationYear"]').val(),cvc:d.find('input[name="BillingInformation.CreditCardSecurityCode"]').val()}};jQuery('input[name="usepersonal"]').is(":checked")?h.billing=h.member:(h.billing.firstName=h.member.firstName,h.billing.lastName=h.member.lastName);var i=function(a){var b=jQuery('.tpl-submitcallout input[type="submit"]');b.attr("disabled",!1),b.val(b.data("oldCopy")),jQuery(".is-error").removeClass("hidden").text(a),jQuery("body, html").animate({scrollTop:jQuery(".is-error").offset().top-100})};jQuery.ajax({type:"POST",url:a,contentType:"application/json",data:JSON.stringify(h),dataType:"json",success:function(a){a.error?i(a.error.message):(a=jQuery.extend({facilityId:h.facilityId,emailAddress:b.find('input[name="MemberInformation.EmailAddress"]').val(),facilityRegion:b.find('input[name="Plan.Region"]').val(),membershipPlanId:h.membershipPlanId},a),c.MembershipPurchase.ThankYou(a))},error:function(a){i(a.responseJSON.error.message)}})},c.MembershipPurchase.ThankYou=function(a){if(!a.error){var b=jQuery(".personal-info"),c=jQuery("<form />");c.attr("action","/join/thank-you").attr("method","POST");var d=b.find('input[name="MemberInformation.FirstName"]').val(),e=jQuery("div.total-due span.price strong").html(),f=jQuery('<input type="hidden"/>').attr("name","Name").val(d.charAt(0).toUpperCase()+d.slice(1)),g=jQuery('<input type="hidden"/>').attr("name","Charge").val(e),h=jQuery('<input type="hidden"/>').attr("name","Card.Type").val(a.cardType),i=jQuery('<input type="hidden"/>').attr("name","Card.Number").val(a.lastFour),j=jQuery('<input type="hidden"/>').attr("name","Barcode").val(a.barcodeKey),k=jQuery('<input type="hidden"/>').attr("name","FacilityId").val(a.facilityId),l=jQuery('<input type="hidden"/>').attr("name","EmailAddress").val(a.emailAddress),m=jQuery('<input type="hidden"/>').attr("name","FacilityRegion").val(a.facilityRegion),n=jQuery('<input type="hidden"/>').attr("name","MembershipPlanId").val(a.membershipPlanId),o=jQuery('<input type="hidden"/>').attr("name","lastName").val(a.lastName),p=jQuery('<input type="hidden"/>').attr("name","country").val(a.country);c.append(f),c.append(g),c.append(h),c.append(i),c.append(j),c.append(k),c.append(l),c.append(m),c.append(n),c.append(o),c.append(p),jQuery("body").append(c),localStorage.setItem("activateJSON",JSON.stringify({country:a.country,barcode:a.barcodeKey,lastName:a.lastName})),c.submit()}},c.MembershipPurchase.bind=function(){jQuery('input[name="usepersonal"]').on("change",function(){var a=jQuery(this).is(":checked");jQuery(".billing-info .information").toggle(!a),jQuery(".billing-info .information input").attr("disabled",a),jQuery(".billing-info .information select").attr("disabled",a)}),jQuery('input[name="usepersonal"]').trigger("change"),jQuery('.tpl-submitcallout input[type="submit"]').on("click",function(){var a=jQuery('.tpl-submitcallout input[type="submit"]');jQuery("form.personal-information").data("publicMethods").isValid()&&(a.attr("disabled",!0),a.data("oldCopy",a.val()),a.val("Loading..."),jQuery("form.personal-information").submit())}),jQuery("form.personal-information").on("submit",function(a){a.preventDefault(),c.MembershipPurchase.Submit()})},c.MembershipPurchase.init=function(){c.MembershipPurchase.bind()},c.ThankYouPage.ActivateAccount=function(a,b){debug("activate]",a);var c=APIEndpoint+"/registration/validateuser";jQuery.ajax({type:"POST",url:c,contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(c){if(c.error)b.hideLoader(),jQuery(".tpl-ctacallout a").show(),jQuery(".tpl-ctacallout .message").hide();else{var d=jQuery("<form />");d.attr("action","/activate/signin").attr("method","POST");var e=jQuery('<input type="hidden"/>').attr("name","LastName").val(c.lastName),f=jQuery('<input type="hidden"/>').attr("name","FirstName").val(c.firstName),g=jQuery('<input type="hidden"/>').attr("name","Country").val(a.country),h=jQuery('<input type="hidden"/>').attr("name","Barcode").val(c.barcodeId),i=jQuery('<input type="hidden"/>').attr("name","Email").val(c.emailAddress);d.append(e),d.append(f),d.append(g),d.append(h),d.append(i),jQuery("body").append(d),d.submit()}},error:function(){b.hideLoader(),jQuery(".tpl-ctacallout .message").hide(),jQuery(".tpl-ctacallout a").show()}})},c.ThankYouPage.init=function(){var a={barcode:transactionDetail.Barcode,country:transactionDetail.Country,lastName:transactionDetail.LastName};jQuery(".tpl-ctacallout a").hide(),jQuery(".tpl-ctacallout").append('<p class="message"><strong>Please wait while we set up your online account</strong></p>');var b=EQ.Helpers.loaderAndErrorHandler(jQuery(".tpl-ctacallout"),{type:"popup"});b.showLoader(),setTimeout(function(){c.ThankYouPage.ActivateAccount(a,b)},100)}}(window,window.App),function(a,b){"use strict";var c=b.Pages.LeadSurvey={},d={Get_LeadPrincipalQuestion:APIBaseUrl+"/v1/lead/fitnesssurvey/initial-questions",Post_PrincipalQuestionMember:APIBaseUrl+"/v1/lead/fitnesssurvey/compute",Post_SaveFinal:APIBaseUrl+"/v1/lead/fitnesssurvey/save-survey"},e={},f={},g={};c.Common={disableSubmit:function(a){a.find(".button").addClass("loading")},enableSubmit:function(a){a.find(".button").removeClass("loading")},buildLoader:function(a){var b=EQ.Helpers.loaderAndErrorHandler(a.find(".loaderAnim"),{color:"black"});return this.loaderAndError=b,b},save:function(a){var b=this,c=b.buildLoader(a.jQueryel),d=a.jQueryel.find(".button").text();a.jQueryel.find(".button").hasClass("loading")||(c.showLoader(),a.jQueryel.find(".button").addClass("loading").text("Loading..."),jQuery.ajax({type:"POST",url:a.jQueryurl,data:JSON.stringify(a.jQuerydata),contentType:"application/json",xhrFields:{withCredentials:!0},headers:{"Eqx-Version":"1"},async:!0}).success(function(b){"false"===b.Success?(c.showError(),a.jQueryel.find(".button").removeClass("loading").text(d)):(c.hideLoader(),a.jQueryel.find(".button").removeClass("loading").text(d),a.jQuerycallback(b))}).error(function(){c.showError(),a.jQueryel.find(".button").removeClass("loading").text(d)}))},generateData:function(a){var b,c=[],d=[],f={};return a.find(".questionContainer .row").each(function(){jQuery(this).removeClass("error");var e=jQuery(this).find(".answer-options");if(e.find("input").is(":radio")){var f=jQuery(this).find('input[type="radio"]:checked').val();"undefined"!=typeof f?a.hasClass("preferenceQuestion")?c.push({answerId:jQuery(this).find(".selected").find("input").attr("id").toString(),additionalInfo:""}):d.push(jQuery(this).find(".selected").find("input").attr("id")):jQuery(this).addClass("error")}else if(e.find("input").is(":checkbox"))if(b=e.find(":checked").length,b>0)for(var g=0;b>g;g++){var h=e.find(":checked").eq(g).closest(".checkbox").find(".control input").attr("id"),i=e.find(":checked").eq(g).closest(".checkbox").find(".control input").val();"other"!==i.toLowerCase()&&c.push({answerId:h,additionalInfo:""})}else jQuery(this).addClass("error")}),a.find(".questionContainer .row.error").length&&jQuery("html, body").animate({scrollTop:a.find(".questionContainer .row.error").offset().top-100}),a.hasClass("preferenceQuestion")?(jQuery.each(e.Answers,function(a,b){c.push({answerId:b,additionalInfo:""})}),f.UserAnswerIds=c,f.ComputedCodeSummaryId=g.computedCodeSummaryId,f.DichotomySummary=g.dichotomySummary,f.EmailAddress=a.parents("#leadSurvey").find("#emailAddress").val(),f.FacilityId=a.parents("#leadSurvey").find("#facilityId").val(),f.NameFirst=a.parents("#leadSurvey").find("#nameFirst").val(),f.NameLast=a.parents("#leadSurvey").find("#nameLast").val(),f.OutreachCode=a.parents("#leadSurvey").find("#outreachCode").val(),f.Phone=a.parents("#leadSurvey").find("#phone").val(),f.TokenId=a.parents("#leadSurvey").find("#tokenId").val(),0===a.find(".questionContainer .row.error").length?f:!1):(f.Answers=d,0===a.find(".questionContainer .row.error").length?f:!1)}},c.beginSurvey=function(){var a=Backbone.Model.extend(),h=Backbone.Collection.extend({model:a,url:d.Get_LeadPrincipalQuestion}),i=Backbone.View.extend({el:"#principalQuestion",template:_.template(jQuery("#leadPrincipalStepView").html()),events:{"click .submitStep1":"principalStepSubmitData"},initialize:function(){var a=this,b=c.Common.buildLoader(a.jQueryel);b.showLoader()},render:function(){var a=this;a.jQueryel.find(".loaderAnim").empty(),c.Common.disableSubmit(a.jQueryel),a.jQueryel.find(".questionContainer").html(a.template({data:l.toJSON()})),a.jQueryel.removeClass("hidden"),a.jQueryel.find(".questionContainer .radio").each(function(){b.loadComponent("radio",jQuery(this),{})}),c.Common.enableSubmit(a.jQueryel)},submitCallback:function(a){var b;0!==a.computedCodeSummaryId&&a.dichotomySummary?(f=a,b=new j({collection:f}),console.log(b)):a.questions.length&&(b=new j({collection:a}),console.log(b)),jQuery("html, body").animate({scrollTop:0})},principalStepSubmitData:function(){var a=this,b=c.Common.generateData(a.jQueryel);e.Answers=b.Answers,b&&c.Common.save({jQueryel:jQuery(".principalQuestion"),jQueryurl:d.Post_PrincipalQuestionMember,jQuerydata:b,jQuerycallback:a.submitCallback})}}),j=Backbone.View.extend({el:"#tieBreakerQuestion",template:_.template(jQuery("#leadTieBreakerStepView").html()),events:{"click .submitStep2":"tieBreakerStepSubmitData"},submitCallback:function(a){if(a.preferenceQuestions.length){g=jQuery.isEmptyObject(f)?a:f;var b=new k({collection:a});console.log(b)}jQuery("html, body").animate({scrollTop:0})},tieBreakerStepSubmitData:function(){var a=this,b=c.Common.generateData(a.jQueryel);"undefined"!==b.Answers&&void 0!==b.Answers&&(e.Answers=e.Answers.concat(b.Answers),jQuery.isEmptyObject(f)||a.submitCallback(f)),jQuery.isEmptyObject(f)&&b&&c.Common.save({jQueryel:jQuery(".tieBreakerQuestion"),jQueryurl:d.Post_PrincipalQuestionMember,jQuerydata:e,jQuerycallback:a.submitCallback})},initialize:function(){this.jQueryel.find(".questionContainer").html(this.template({data:this.collection})),jQuery("#principalQuestion").html(""),this.jQueryel.removeClass("hidden"),this.jQueryel.find(".questionContainer .radio").each(function(){b.loadComponent("radio",jQuery(this),{})})}}),k=Backbone.View.extend({el:"#preferenceQuestion",template:_.template(jQuery("#preferenceStepView").html()),events:{"click .submitStep3":"preferenceStepSubmitData"},submitCallback:function(a){console.log("Final Data has been Saved !!!!  Responce = "+a),this.jQueryel.remove(),jQuery(".codeMember-hero").remove(),jQuery("#thankYouMsg").removeClass("hidden"),jQuery("html, body").animate({scrollTop:0})},preferenceStepSubmitData:function(){var a=this,b=c.Common.generateData(a.jQueryel);b&&c.Common.save({jQueryel:jQuery(".preferenceQuestion"),jQueryurl:d.Post_SaveFinal,jQuerydata:b,jQuerycallback:a.submitCallback})},initialize:function(){this.jQueryel.find(".questionContainer").html(this.template({data:this.collection})),jQuery("#tieBreakerQuestion").html(""),this.jQueryel.removeClass("hidden"),this.jQueryel.find(".questionContainer .radio").each(function(){b.loadComponent("radio",jQuery(this),{})}),this.jQueryel.find(".questionContainer .checkbox").each(function(){b.loadComponent("checkbox",jQuery(this),{})})}}),l=new h;l.fetch({success:function(){var a=new i;a.render()},error:function(){console.log("Yor got some error!")}})},c.init=function(){var a=c.Common.buildLoader(jQuery(".principalQuestion"));a.showLoader(),c.beginSurvey()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Leaderboard={};c.init=function(a){b.loadComponent("cycling-leaderboard",a,c.getGender("gender"))},c.getGender=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Login={},d=jQuery("form.login");c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:"Login.RememberMe"},function(b,d,e){if(202===e.status){if("LegacyUser"===b.code)return void c.ChangeLegacyUserName(b);if("SpaOnlyUser"===b.code)return void c.RedirectToSpaPage(b)}var f=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl"));if("false"===f){var g=b.hasAnsweredOnboardingQuestions||!1;g?a.location.href="/":a.location.href="/questionnaire/start"}else a.location.href=f})},c.ChangeLegacyUserName=function(a){var b=jQuery("<form></form>");b.attr("action","/help/change/username").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","email").val(a.email),d=jQuery('<input type="hidden"/>').attr("name","userName").val(a.userName);b.append(c),b.append(d),jQuery("body").append(b),b.submit()},c.RedirectToSpaPage=function(a){var b=jQuery("<form />");b.attr("action","/help/upgrade/spa-member").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","firstName").val(a.firstName),d=jQuery('<input type="hidden"/>').attr("name","userId").val(a.userId),e=jQuery('<input type="hidden"/>').attr("name","lastName").val(a.lastName);b.append(c),b.append(d),b.append(e),jQuery("body").append(b),b.submit()},c.Facebook={bind:function(){jQuery(".login-facebook").on("click",c.Facebook.intent.bind(c.Facebook))},intent:function(){window.track("regLoginWithFB"),this.getToken(function(b){debug("FBT:",b.accessToken),jQuery.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:b.accessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(b,d,e){if(EQ.Helpers.createCookie("IsFBLogin",!0,1),202===e.status){if("LegacyUser"===b.code)return void c.ChangeLegacyUserName(b);if("SpaOnlyUser"===b.code)return void c.RedirectToSpaPage(b)}var f=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl"));if("false"===f){var g=b.hasAnsweredOnboardingQuestions===!0;g?a.location.href="/":a.location.href="/questionnaire/start"}else a.location.href=f}).fail(function(b){try{var c=b.responseJSON,d=c.error?c.error.message:c.message;50019===c.error.messageId?FB.api("/me",function(b){a.location.href="/login/connect?firstName="+b.first_name+"&lastName="+b.last_name}):jQuery(".is-error").text(d).removeClass("hidden")}catch(e){jQuery(".is-error").text("").addClass("hidden")}})})},getToken:function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse)},{scope:"email,user_likes,user_friends"})}},c.init=function(){debug("[Login] Init"),"undefined"!=typeof a.user&&a.user&&(a.location.href="/"),d.on("submit",function(a){a.preventDefault(),c.validateAndSubmit()}),b.Events.on("fbsdk:loaded",function(){c.Facebook.bind()})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Mock={},d=a._;c.Book={},c.Book.init=function(){debug("[Mock.Book] Init"),c.Book.bind()},c.Book.bind=function(){jQuery(".bike-filters > li > a").on("click",function(){jQuery(this).addClass("active"),jQuery(this).find("input").focus()}),jQuery(".bike-filters ul li a").on("click",function(){jQuery(this).toggleClass("active")}),jQuery(".remove-filter").on("click",function(a){a.stopPropagation(),jQuery(this).prev().val(""),jQuery(".bike-filters li a.active").removeClass("active")}),jQuery(".bike-filters .checkbox").on("change",function(){var a=jQuery(this).find(".label").text(),b=jQuery(this).closest("ul[data-icon]").attr("data-icon"),c=jQuery('<li data-filter="'+a+'" class="'+b+'"><span>'+a+"</span></li>");jQuery(this).hasClass("checked")?c.appendTo(".added-filters"):jQuery('.added-filters li[data-filter="'+a+'"]').remove()})},c.Book.drawMap=function(){var a,b=jQuery(".bikes-graphic"),e=b.width(),f=c.Book.jsonMap,g=f.layout.width/e,h=f.layout.bikes,i=f.layout.doors;a=Math.floor(e*f.layout.heigth/f.layout.width),d.each(h,function(a){c.Book.drawBike(a,g)}),d.each(i,function(a){c.Book.drawDoor(a,g)})},c.Book.drawBike=function(a,b){var c=jQuery(".bikes-graphic"),d=jQuery('<div class="bike">'+a.localId+"</div>"),e=Math.floor(a.studioGridX/b),f=Math.floor(a.studioGridY/b);c.append(d),d.css({top:f+"px",left:e+"px"}),a.isDisabled===!0&&d.addClass("unavailable"),a.reserved===!0&&d.addClass("selected")},c.Book.drawDoor=function(a,b){var c=jQuery(".bikes-graphic"),d=jQuery('<div class="door icon-door"></div>'),e=Math.floor(a.studioGridX/b),f=Math.floor(a.studioGridY/b);c.append(d),d.css({top:f+"px",left:e+"px"})},c.Book.jsonMap={reservation:{result:null},layout:{clubId:113,clubName:"50th St. @ Broadway",heigth:475,width:925,id:104,name:"Cycling Studio",bikes:[{clubId:113,studioId:104,studioGridY:145,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1415,isDisabled:!1,localId:1,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1416,isDisabled:!1,localId:2,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1417,isDisabled:!1,localId:3,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1418,isDisabled:!1,localId:4,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1419,isDisabled:!1,localId:5,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1420,isDisabled:!1,localId:6,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1421,isDisabled:!1,localId:7,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2747,isDisabled:!1,localId:8,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2839,isDisabled:!1,localId:9,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:140,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2840,isDisabled:!1,localId:10,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2841,isDisabled:!1,localId:11,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2842,isDisabled:!1,localId:12,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2843,isDisabled:!1,localId:13,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2844,isDisabled:!1,localId:14,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2845,isDisabled:!1,localId:15,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2846,isDisabled:!1,localId:16,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2847,isDisabled:!1,localId:17,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2848,isDisabled:!1,localId:18,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2849,isDisabled:!1,localId:19,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2850,isDisabled:!1,localId:20,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:480,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2851,isDisabled:!1,localId:21,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:415,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2852,isDisabled:!1,localId:22,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:350,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2853,isDisabled:!1,localId:23,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:290,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2854,isDisabled:!1,localId:24,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:230,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2855,isDisabled:!1,localId:25,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:165,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2856,isDisabled:!1,localId:26,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2857,isDisabled:!1,localId:27,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:445,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2858,isDisabled:!1,localId:28,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:330,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3160,isDisabled:!1,localId:29,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:260,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3612,isDisabled:!1,localId:30,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:190,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3613,isDisabled:!1,localId:31,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:120,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3614,isDisabled:!1,localId:32,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3615,isDisabled:!1,localId:33,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1}],doors:[{clubId:113,studioId:104,studioGridY:35,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null},{clubId:113,studioId:104,studioGridY:85,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}],instructors:[{clubId:113,studioId:104,studioGridY:55,studioGridX:100,gridItemTypeId:2,gridItemType:"Instructor",gridItemImage:"instructor.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}]},strikes:{count:0,expiresOn:"2014-02-22T06:05:34.9173881-05:00"}}}(window,window.App),function(a,b){"use strict";var c,d,e,f,g,h,i,j,k=b.Pages.Leads={},l={},m=Backbone.Model.extend({defaults:{ScheduledVisitDay:"",ScheduledVisitTime:"",Address:"",FacilityId:""}});k.POPUP_LEAD="POPUP LEAD",k.PAGE_LEAD="PAGE LEAD",k.ERROR="ERROR",k.common={scrollWindow:function(a){switch(a.scrollFor){case k.POPUP_LEAD:jQuery("html, body").animate({scrollTop:0});break;case k.PAGE_LEAD:jQuery("#schedule-a-visit").length?jQuery("html, body").animate({scrollTop:jQuery("#schedule-a-visit").offset().top-jQuery('[data-component="navigation"]').height()+20}):jQuery(".promo").length||jQuery("html, body").animate({scrollTop:jQuery('[data-component="navigation"]').height()+20});break;case k.ERROR:jQuery("html, body").animate({scrollTop:a.context.jQuery(".error").offset().top-(a.whichLead===k.PAGE_LEAD?jQuery('[data-component="navigation"]').height()+20:20)})}},fillRegionClubDropdown:function(b){var c,e="Select a region",f=""!==b.clubDefaultText1?b.clubDefaultText1:"You must select a region first",g="Select a club",i=b.jQueryregion.find("select"),j=b.jQueryclub.find("select"),l='<option data-slug="">'+e+"</option>",m={};f=h?f:g,jQuery.each(a.allRegionsData,function(a,b){if(b&&b.SubRegions&&b.SubRegions.length){var c=[];l+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",jQuery.each(b.SubRegions,function(a,b){c=c.concat(b.Facilities)}),m[b.Name]=c}else l+='<option data-slug="'+b.ShortName+'">'+b.Name+"</option>",m[b.Name]=b.Facilities}),i.html(l),j.prepend('<option selected data-id="">'+f+"</option>"),d||j.on("change",function(){c=parseInt(b.jQueryclub.find("select option").filter(":selected").data("id"),10),b.jQueryoptionSelector.addClass("hidden"),b.jQueryappointmentSchedule.addClass("hidden"),c&&k.common.checkForPilotClubs({dom:b,facilityId:c})}),i.on("change",function(){var a=m[jQuery(this).val()],b="";a?(jQuery.each(a,function(a,c){(c.IsAvailableOnline!==!1||c.IsPresale!==!1)&&(b+='<option data-isPilateSurvey="'+c.IsSurveyPilot+'" data-id="'+c.Id+'">'+c.ClubName+"</option>")}),j.html(b),j.each(function(){var a=jQuery(this).children("option");a.sort(function(a,b){return a.value.localeCompare(b.value)}),jQuery(this).empty().append(a)}),j.prepend('<option selected data-id="">'+g+"</option>"),j.prop("selectedIndex",0).trigger("change")):(j.siblings(".option").html(f),j.html('<option selected data-id="">'+f+"</option>"))}),i.trigger("change")},defaultRegionClubSelect:function(a){var b=a.jQueryregion.find("select"),c=a.jQueryclub.find("select");window.currentClub&&(window.selectedRegion&&b.find("option").each(function(a,c){jQuery(c).data("slug")===window.selectedRegion&&b.prop("selectedIndex",a).trigger("change");
}),window.currentClub&&c.find("option").each(function(a,b){jQuery(b).data("id")===+window.currentClub&&c.prop("selectedIndex",a).trigger("change")}))},filldaytimingsDropdown:function(a){var b,c="Choose your preferred day",d="You must select a day first",e=jQuery(".days-dropdown"),f=jQuery(".time-dropdown"),g="Choose your preferred time",h=e.find("select"),i=f.find("select"),j='<option data-val="">'+c+"</option>";jQuery.each(a.dateRangeWithTime,function(b){var c=moment(a.dateRangeWithTime[b].date).format("dddd,[ ]MMM D");j+='<option data-pos="'+b+'" data-date="'+a.dateRangeWithTime[b].date+'">'+c+"</option>"}),h.html(j),i.siblings(".option").html(d),i.prepend('<option selected data-id="">'+d+"</option>"),h.on("change",function(){var c=jQuery(this).find(":selected").data("pos");b="";var d;if(void 0!==c&&null!==c){d=a.dateRangeWithTime[c].timeSlots;for(var e in d)if(d.hasOwnProperty(e)){var f=moment(d[e],["h:mm"]).format("h:mm A");b+='<option data-ele="'+e+'" data-time="'+d[e]+'">'+f+"</option>"}}i.html(b),i.prepend('<option selected data-id="">'+g+"</option>"),i.trigger("change")}),h.trigger("change")},getAppointmentSchedule:function(a){var b=APIBaseUrl+"/v1/lead/leadappointment-schedule/"+a.facilityId,c=jQuery(".schedule-visit-text-step1"),d=jQuery("schedule-button-step1");jQuery.ajax({url:b}).done(function(b){a.dom.jQueryoptionSelector.find(".loaderAnim").html(""),a.dom.jQueryappointmentSchedule.removeClass("hidden"),d.removeClass("hidden"),c.removeClass("hidden"),k.common.filldaytimingsDropdown(b)}).fail(function(){console.log("Unable to schedule for appointment")})},checkForPilotClubs:function(a){var b=APIBaseUrl+"/v1/lead/leadappointment-schedule/"+a.facilityId,c=a.dom.jQuerypilotFacilityIds.val().split(",");jQuery.ajax({url:b}).done(function(b){b.isPilotFacility&&(a.dom.jQueryoptionSelector.removeClass("hidden"),k.common.checkForOptionSelected({dom:a.dom,facilityId:a.facilityId}))}).fail(function(){console.log("Unable schedule for appointment")}),_.contains(c,a.facilityId.toString())?(a.dom.jQueryappointmentCheckbox.removeClass("hidden"),a.dom.jQuerysmsLegalCopy.removeClass("hidden")):(a.dom.jQueryappointmentCheckbox.addClass("hidden"),a.dom.jQuerysmsLegalCopy.addClass("hidden"))},checkForOptionSelected:function(a){var b,c=a.dom.jQueryoptionSelector;c.on("change",function(){b=jQuery("option:selected",this).text(),console.log(b),"Schedule an Appointment"===b?(k.common.getAppointmentSchedule({dom:a.dom,facilityId:a.facilityId}),a.dom.jQueryoptionSelector.find(".loaderAnim").html('<div class="loader"><div class="loader-circles bounce1"></div><div class="loader-circles bounce2"></div><div class="loader-circles bounce3"></div></div>')):a.dom.jQueryappointmentSchedule.addClass("hidden")}),c.find("select").prop("selectedIndex",0).trigger("change")},validateStep1:function(a){var b={email:function(a){return/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},digits:function(a){return/^\d+jQuery/.test(a)},phone:function(a){return/^[0-9\-()\s]*jQuery/.test(a)},onlyAlphanumericAndSpaces:function(a){return/^[a-zA-Z\s]+jQuery/.test(a)}};if(a.context.jQuery(".error").removeClass("error"),a.dom.jQueryfirstName.val().length<1||b.onlyAlphanumericAndSpaces(a.dom.jQueryfirstName.val())===!1?(a.dom.jQueryfirstName.addClass("error"),a.dom.jQueryfirstName.closest(".control").siblings(".control-title").addClass("error")):(a.dom.jQueryfirstName.removeClass("error"),a.dom.jQueryfirstName.closest(".control").siblings(".control-title").removeClass("error")),a.dom.jQuerylastName.val().length<1||b.onlyAlphanumericAndSpaces(a.dom.jQuerylastName.val())===!1?(a.dom.jQuerylastName.addClass("error"),a.dom.jQuerylastName.closest(".control").siblings(".control-title").addClass("error")):(a.dom.jQuerylastName.removeClass("error"),a.dom.jQuerylastName.closest(".control").siblings(".control-title").removeClass("error")),1===a.dom.jQueryemail.length&&(a.dom.jQueryemail.val().length<3||b.email(a.dom.jQueryemail.val())===!1?(a.dom.jQueryemail.addClass("error"),a.dom.jQueryemail.closest(".control").siblings(".control-title").addClass("error")):(a.dom.jQueryemail.removeClass("error"),a.dom.jQueryemail.closest(".control").siblings(".control-title").removeClass("error"))),a.dom.jQueryphone.val().length<1?(a.dom.jQueryphone.addClass("error"),a.dom.jQueryphone.closest(".control").siblings(".control-title").addClass("error")):a.dom.jQueryphone.val().length>1&&b.phone(a.dom.jQueryphone.val())===!0?(a.dom.jQueryphone.removeClass("error"),a.dom.jQueryphone.closest(".control").siblings(".control-title").removeClass("error")):(a.dom.jQueryphone.removeClass("error"),a.dom.jQueryphone.closest(".control").siblings(".control-title").removeClass("error")),jQuery("#barcode").length&&(""===jQuery("#barcode").val()?(jQuery("#barcode").addClass("error"),jQuery("#barcode").closest(".control").siblings(".control-title").addClass("error")):(jQuery("#barcode").removeClass("error"),jQuery("#barcode").closest(".control").siblings(".control-title").removeClass("error"))),""===a.dom.jQueryregion.find("select option").filter(":selected").data("slug")?(a.dom.jQueryregion.addClass("error"),a.dom.jQueryregion.closest(".control").siblings(".control-title").addClass("error")):(a.dom.jQueryregion.removeClass("error"),a.dom.jQueryregion.closest(".control").siblings(".control-title").removeClass("error")),""===a.dom.jQueryclub.find("select option").filter(":selected").data("id")?(a.dom.jQueryclub.addClass("error"),a.dom.jQueryclub.closest(".control").siblings(".control-title").addClass("error")):(a.dom.jQueryclub.removeClass("error"),a.dom.jQueryclub.closest(".control").siblings(".control-title").removeClass("error")),a.dom.jQueryappointmentSchedule.is(":visible")){var c=a.dom.jQuerydays,d=a.dom.jQuerytime;""===c.find("select option").filter(":selected").data("val")?(c.addClass("error"),c.closest(".control").siblings(".control-title").addClass("error")):(c.removeClass("error"),c.closest(".control").siblings(".control-title").removeClass("error")),""===d.find("select option").filter(":selected").data("id")?(d.addClass("error"),d.closest(".control").siblings(".control-title").addClass("error")):(d.removeClass("error"),d.closest(".control").siblings(".control-title").removeClass("error"))}if(a.dom.jQueryoptionSelector.is(":visible")){var e=a.dom.jQueryoptionSchedule;""===e.find("select option").filter(":selected").data("val")?(e.addClass("error"),e.closest(".control").siblings(".control-title").addClass("error")):(e.removeClass("error"),e.closest(".control").siblings(".control-title").removeClass("error"))}},leadFormSubmissionStep2:function(a,b,c){var d=jQuery("<form />");d.attr("action",c).attr("method","POST");var e=jQuery('<input type="hidden"/>').attr("name","nameFirst").val(b.find(".first-name").val()),f=jQuery('<input type="hidden"/>').attr("name","nameLast").val(b.find(".last-name").val()),h=jQuery('<input type="hidden"/>').attr("name","tokenId").val(a),j=jQuery('<input type="hidden"/>').attr("name","facilityId").val(b.find(".club select option").filter(":selected").data("id")),k=jQuery('<input type="hidden"/>').attr("name","emailAddress").val(b.find(".email").val()),l=jQuery('<input type="hidden"/>').attr("name","phone").val(b.find(".phone").val()),m=jQuery('<input type="hidden"/>').attr("name","outreachCode").val(b.find(".activation-code").val());if(g){var n=jQuery('<input type="hidden"/>').attr("name","scheduleDay").val(i.get("ScheduledVisitDay")),o=jQuery('<input type="hidden"/>').attr("name","scheduleTime").val(i.get("ScheduledVisitTime"));d.append(n),d.append(o)}d.append(e),d.append(f),d.append(h),d.append(j),d.append(k),d.append(l),d.append(m),jQuery("body").append(d),d.submit()},referThankyou:function(a){var b=jQuery("<form />");f?b.attr("action","confirmation").attr("method","POST"):b.attr("action","referral-link/confirmation").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","name").val(a);b.append(c),jQuery("body").append(b),b.submit()},checkReferPage:function(a){d="referralResponseLeads"===a.jQueryel.parent().attr("id");var b=/(referral-link)/gi;if(f=d?b.test(location.pathname):!1,d){var c=a.jQueryel.siblings("#referralResponseData");jQuery.each(c.find("input[type=hidden]"),function(){var a=jQuery(this).attr("class"),b=jQuery(this).val();l[a]=b}),console.log(l)}},submitStep1:function(a){a.e.preventDefault();var b,c,e,f,h=this,j="contactLeads-step1"===jQuery(a.context.jQueryel).attr("class"),n=jQuery("#generic-lead-form").length,o=a.dom.jQueryclub.find("select option").filter(":selected").data("ispilatesurvey"),p=jQuery(a.e.target),q=d?"/referrals/info/send":APIBaseUrl+"/v1/lead/create",r=[],s=jQuery(".appointment-checked"),t=jQuery("#is-appointment-enabled");if(d||("true"===t.val()?r.push({answerId:t.data("smschecked").toString(),additionalInfo:""}):0===s.length?r=[]:r.push({answerId:t.data("smsunchecked").toString(),additionalInfo:""})),!p.hasClass("submitting"))if(this.validateStep1({context:a.context,dom:a.dom}),a.dom.jQueryappointmentSchedule.is(":visible")?(b=!0,c=a.dom.jQuerydays.find("select option:selected").data("date").split("T")[0]+"T"+a.dom.jQuerytime.find("select option:selected").data("time"),e=a.dom.jQueryclub.find("select option").filter(":selected").data("id"),f=this.getClubFullAdress(e),i=new m,i.set({ScheduledVisitDay:a.dom.jQuerydays.find("select option:selected").data("date"),ScheduledVisitTime:a.dom.jQuerytime.find("select option:selected ").val(),Address:f,FacilityId:e})):(b=!1,g=!1),0===a.context.jQuery(".error").length){var u;d?u={nameFirst:a.dom.jQueryfirstName.val(),nameLast:a.dom.jQuerylastName.val(),facilityKey:a.dom.jQueryclub.find("select option").filter(":selected").data("id"),emailAddress:a.dom.jQueryemail.val(),phoneNumber:a.dom.jQueryphone.val(),userLocation:a.dom.jQueryregion.find("select").val()||"NoRegion",transactionId:a.dom.jQuerytransationId.val(),friendId:l.referredId,referringId:l.referringId,memberId:l.memberId,OutreachCode:a.dom.jQueryactivationCode.val(),shareId:l.shareId}:n?u={firstName:a.dom.jQueryfirstName.val(),lastName:a.dom.jQuerylastName.val(),emailAddress:a.dom.jQueryemail.val(),phone:a.dom.jQueryphone.val(),inputLabel:jQuery("#input-label").find(".control-title").text(),inputValues:jQuery("#input-label").find("select option:selected").val(),barCodeId:jQuery("#barcode").val(),ContentKey:jQuery("#ContentKey").val()}:b?(g=!0,u={NameFirst:a.dom.jQueryfirstName.val(),NameLast:a.dom.jQuerylastName.val(),FacilityId:a.dom.jQueryclub.find("select option").filter(":selected").data("id"),EmailAddress:a.dom.jQueryemail.val(),PhoneNumber:a.dom.jQueryphone.val(),UserLocation:a.dom.jQueryregion.find("select").val()||"NoRegion",TransactionId:a.dom.jQuerytransationId.val(),OutreachCode:a.dom.jQueryactivationCode.val(),googleAdwords:a.dom.jQuerygoogleAdwords.val(),ScheduledVisitTime:c,Answers:r}):u={NameFirst:a.dom.jQueryfirstName.val(),NameLast:a.dom.jQuerylastName.val(),FacilityId:a.dom.jQueryclub.find("select option").filter(":selected").data("id"),EmailAddress:a.dom.jQueryemail.val(),PhoneNumber:a.dom.jQueryphone.val(),UserLocation:a.dom.jQueryregion.find("select").val()||"NoRegion",TransactionId:a.dom.jQuerytransationId.val(),OutreachCode:a.dom.jQueryactivationCode.val(),googleAdwords:a.dom.jQuerygoogleAdwords.val(),Answers:r},this.step1Data=u,console.log("Step1 Data: ",u),p.text("Loading..."),p.addClass("submitting"),n?jQuery.ajax({type:"POST",url:"/leads/generic-email-lead",data:JSON.stringify(u),contentType:"application/json",xhrFields:{withCredentials:!0},headers:{"Eqx-Version":"1"}}).success(function(a){console.log(a),a.Success===!0?(jQuery(".success-wrapper").removeClass("hidden"),jQuery(".success-wrapper").show(),jQuery(".step1 .control-form").hide()):jQuery(".step1 .error-wrapper").show()}).error(function(){jQuery(".error-wrapper").show()}):jQuery.ajax({type:"POST",url:q,data:JSON.stringify(u),contentType:"application/json",xhrFields:{withCredentials:!0},headers:{"Eqx-Version":"1"}}).success(function(b){h.scrollWindow({scrollFor:a.scrollFor}),"false"===b.success?(a.dom.jQuerystep1ControlForm.hide(),a.dom.jQuerystep1ErrorWrapper.fadeIn("fast")):j?h.leadFormSubmissionStep2(b.tokenId,jQuery(a.context.jQueryel),"/leads/contactstep2"):!d&&o?h.leadFormSubmissionStep2(b.tokenId,jQuery(a.context.jQueryel),"/lead/fitnesssurvey"):(h.step1Data.tokenId=b.tokenId,h.renderStep2({scrollFor:a.scrollFor,dom:a.dom}))}).error(function(b){console.log(b),h.scrollWindow({scrollFor:a.scrollFor}),h.replaceEl({jQueryel:a.dom.jQuerystep1ErrorTitle,placeholder:"##NAME##",value:h.step1Data.nameFirst}),a.dom.jQuerystep1ControlForm.hide(),a.dom.jQuerystep1ErrorWrapper.fadeIn("fast")})}else this.scrollWindow({context:a.context,whichLead:a.scrollFor,scrollFor:k.ERROR})},renderStep2:function(a){this.scrollWindow({scrollFor:a.scrollFor}),a.dom.jQuerystep1.hide(),a.dom.jQuerystep2.fadeIn("fast"),a.dom.jQuerystep2.find(".loaderAnim").html('<div class="loader"><div class="loader-circles bounce1"></div><div class="loader-circles bounce2"></div><div class="loader-circles bounce3"></div></div>'),n.fetch({success:function(){var b=new k.PopupStep2;b.render(),a.dom.jQuerystep2.find(".loaderAnim").html("")},error:function(){console.log("Yor got some error!")}}),this.replaceEl({jQueryel:a.dom.jQuerystep2Description,placeholder:"##NAME##",value:this.step1Data.NameFirst?this.step1Data.NameFirst:this.step1Data.nameFirst}),this.replaceEl({jQueryel:a.dom.jQuerystep2ThanksTitle,placeholder:"##NAME##",value:this.step1Data.NameFirst?this.step1Data.NameFirst:this.step1Data.nameFirst}),this.replaceEl({jQueryel:a.dom.jQuerystep2ErrorTitle,placeholder:"##NAME##",value:this.step1Data.NameFirst?this.step1Data.NameFirst:this.step1Data.nameFirst}),g?(jQuery(".step2-appointment-heading").removeClass("hidden"),jQuery(".step2-appointment-description").removeClass("hidden"),jQuery(".step2-heading").addClass("hidden"),jQuery(".step2-description").addClass("hidden"),this.replaceEl({jQueryel:a.dom.jQuerystep2AppointDescription,placeholder:"##NAME##",value:this.step1Data.NameFirst?this.step1Data.NameFirst:this.step1Data.nameFirst})):(jQuery(".step2-appointment-heading").addClass("hidden"),jQuery(".step2-appointment-description").addClass("hidden"))},replaceEl:function(a){var b=a.jQueryel.text();b&&a.jQueryel.html(b.replace(a.placeholder,a.value))},toggleOtherInterests:function(a){this.toggleEl({jQueryel:a.jQueryotherInterests})},toggleOtherGoals:function(a){this.toggleEl({jQueryel:a.jQueryotherGoals})},toggleEl:function(a){a.jQueryel.is(":visible")?a.jQueryel.hide():(a.jQueryel.show(),a.jQueryel.focus())},submitStep2:function(a){a.e.preventDefault();var b=this,c=jQuery(a.e.target),e=d?APIBaseUrl+"/v1/lead/update-referrallead":APIBaseUrl+"/v1/lead/update",g=jQuery("#lead-page-wrapper").hasClass("ContactLeadsStep2");if(console.log(g),!c.hasClass("submitting")){var h,i=[];a.dom.jQueryrow.each(function(){var a=jQuery(this),b=a.find(".answer-options"),c="I'm interested in"===a.find(".question-heading h3").text()?"Interested in":a.find(".question-heading h3").text();if(console.log(b,c),b.find("input").is(":radio")){var d=jQuery(this).find('input[type="radio"]:checked').val();if("undefined"==typeof d)return;i.push({answerId:jQuery(this).find(".selected").find("input").attr("id").toString(),additionalInfo:""})}else if(b.find("input").is(":checkbox")){if(h=b.find(":checked").length,!(h>0))return;for(var e=0;h>e;e++){var f=b.find(":checked").eq(e).closest(".checkbox").find(".control input").attr("id"),g=b.find(":checked").eq(e).closest(".checkbox").find(".control input").data("value");if("other"!==g.toLowerCase())i.push({answerId:f,additionalInfo:""});else{var j=b.find(":checked").eq(e).closest(".checkbox").find(".control input").attr("class");switch(j){case"otherGoalsOption":i.push({answerId:f,additionalInfo:jQuery(this).find(".otherGoals").val()});break;case"otherInterestsOption":i.push({answerId:f,additionalInfo:jQuery(this).find(".otherInterests").val()})}}}}else if(b.find("select").length){var k=b.find("select").val();if(!k)return;i.push({answerId:k,additionalInfo:""})}});var j={};j=g?{NameFirst:jQuery(".ContactLeadsStep2").find("#nameFirst").val(),NameLast:jQuery(".ContactLeadsStep2").find("#nameLast").val(),OutreachCode:jQuery(".ContactLeadsStep2").find("#outreachCode").val(),FacilityId:jQuery(".ContactLeadsStep2").find("#facilityId").val(),EmailAddress:jQuery(".ContactLeadsStep2").find("#emailAddress").val(),PhoneNumber:jQuery(".ContactLeadsStep2").find("#phone").val(),TokenId:jQuery(".ContactLeadsStep2").find("#tokenId").val(),Answers:i}:d?f?{NameFirst:this.step1Data.nameFirst,NameLast:this.step1Data.nameLast,FacilityId:this.step1Data.facilityKey,EmailAddress:this.step1Data.emailAddress,PhoneNumber:this.step1Data.phoneNumber,Answers:i}:{NameFirst:this.step1Data.nameFirst,NameLast:this.step1Data.nameLast,FacilityId:this.step1Data.facilityKey,EmailAddress:this.step1Data.emailAddress,PhoneNumber:this.step1Data.phoneNumber,Answers:i}:{NameFirst:this.step1Data.NameFirst,NameLast:this.step1Data.NameLast,OutreachCode:this.step1Data.OutreachCode,FacilityId:this.step1Data.FacilityId,EmailAddress:this.step1Data.EmailAddress,PhoneNumber:this.step1Data.PhoneNumber,TokenId:this.step1Data.tokenId,Answers:i};var l=c.text();a.data=j,a.jQuerytargetCurrentText=l,c.text("Loading..."),c.addClass("submitting"),d?jQuery.ajax({type:"POST",url:e,data:JSON.stringify(j),contentType:"application/json",headers:{"Eqx-Version":"1"}}).success(function(){k.common.submitStep3(a),a.dom.jQuerystep2ControlForm.hide(),b.scrollWindow({scrollFor:a.scrollFor})}).error(function(){b.scrollWindow({scrollFor:a.scrollFor}),a.dom.jQuerystep2ErrorWrapper.fadeIn("fast"),c.text(l),c.removeClass("submitting")}):jQuery.ajax({type:"POST",url:e,data:JSON.stringify(j),contentType:"application/json",headers:{"Eqx-Version":"1"}}).success(function(){k.common.submitStep3(a),b.scrollWindow({scrollFor:a.scrollFor})}).error(function(){b.scrollWindow({scrollFor:a.scrollFor}),a.dom.jQuerystep2ErrorWrapper.fadeIn("fast"),c.text(l),c.removeClass("submitting")})}},submitStep3:function(a){var b=this,c=APIBaseUrl+"/v1/lead/cta",f={Answers:a.data.Answers,FacilityId:a.data.FacilityId};jQuery.ajax({type:"POST",url:c,data:JSON.stringify(f),contentType:"application/json",headers:{"Eqx-Version":"1"}}).success(function(c){if(a.dom.jQuerystep2ControlForm.hide(),a.response=c,d){var f=k.common.makeStep3Data(a),h=new Date,i=5;h.setTime(h.getTime()+60*i*1e3),jQuery.cookie("refferalFormCookie",JSON.stringify(f),{expires:h,path:"/"}),k.common.referThankyou(a.data.NameFirst)}else if(g||e){var j=new k.ThankYouAppointment;j.render(a),b.scrollWindow({scrollFor:a.scrollFor})}else{var l=new k.ThankYou;l.render(a),b.scrollWindow({scrollFor:a.scrollFor})}}).error(function(){b.scrollWindow({scrollFor:a.scrollFor}),a.dom.jQuerystep2ControlForm.hide(),a.dom.jQuerystep2ErrorWrapper.fadeIn("fast"),jQuery(a.e.target).text(a.jQuerytargetCurrentText),jQuery(a.e.target).removeClass("submitting")})},getClubFullAdress:function(a){var b=EQ.Helpers.getFacilityById(a),c=b.ClubName+"<br>"+b.Address+"<br>"+b.City+" "+b.Zip+"<br>"+b.Telephone;return c},makeStep3Data:function(a){var b="/classes/search?clubs="+a.data.FacilityId,c=EQ.Helpers.getFacilityById(""+a.data.FacilityId);return a.response.facility.url=c.URL,a.response.facility.ClubName=c.ClubName,a.response.facility.browseClassUrl=b,a.response},getSetAdwordCookie:function(){var a=EQ.Helpers.readCookie("adwordsGclid");a&&jQuery(".google-adwords-code").val(a)}},k.Step2Model=Backbone.Model.extend({}),k.Step2Collection=Backbone.Collection.extend({model:k.Step2Model,url:APIBaseUrl+"/v1/lead/questions"});var n=new k.Step2Collection;k.PopupStep2=Backbone.View.extend({el:".step2",tpl:_.template(jQuery("#step2LeadForm").html()),events:{"click .submit-step2":"submitStep2","change .otherInterestsOption":"toggleOtherInterests","change .otherGoalsOption":"toggleOtherGoals"},initialize:function(){this.tpl=_.template(jQuery("#step2LeadForm").html()),this.dom={}},render:function(){var a=this;a.jQueryel.find(".questionContainer").html(a.tpl({data:n.toJSON()})),a.jQueryel.find(".questionContainer .radio").each(function(){b.loadComponent("radio",jQuery(this),{})}),a.jQueryel.find(".questionContainer .checkbox").each(function(){b.loadComponent("checkbox",jQuery(this),{})}),a.jQueryel.find(".questionContainer .select-wrapper").each(function(){b.loadComponent("inline-select",jQuery(this),{})}),this.dom.jQueryleadPageWrapper=this.jQueryel.parent(),this.dom.jQuerystep1=this.jQuery(".step1"),this.dom.jQuerystep2=this.jQuery(".step2"),this.dom.jQuerystep1ControlForm=this.jQuery(".step1 .control-form"),this.dom.jQuerystep1ErrorTitle=this.jQuery(".step1-error-title"),this.dom.jQuerystep1ErrorWrapper=this.jQuery(".step1 .error-wrapper"),this.dom.jQuerystep2ControlForm=this.jQueryel.find(".control-form"),this.dom.jQuerystep2ControlForm.is(":visible")||this.dom.jQuerystep2ControlForm.show(),this.dom.jQuerystep2Description=this.jQueryel.find(".step2-description"),this.dom.jQuerystep2ThanksTitle=this.jQueryel.find(".step2-thanks-title"),this.dom.jQuerystep2ErrorTitle=this.jQueryel.find(".step2-error-title"),this.dom.jQuerystep2SuccessWrapper=this.jQueryel.find(".success-wrapper").length?this.jQueryel.find(".success-wrapper"):this.jQueryel.parent().find(".step3.success-wrapper"),this.dom.jQuerystep2ErrorWrapper=this.jQueryel.find(".error-wrapper"),this.dom.jQueryrow=this.jQuery(".row"),this.dom.jQueryfirstName=this.jQuery(".first-name"),this.dom.jQuerylastName=this.jQuery(".last-name"),this.dom.jQueryregion=this.jQuery(".region"),this.dom.jQueryclub=this.jQuery(".club"),this.dom.jQueryemail=this.jQuery(".email"),this.dom.jQueryphone=this.jQuery(".phone"),this.dom.jQueryotherInterests=this.jQuery(".otherInterests"),this.dom.jQueryotherGoals=this.jQuery(".otherGoals"),this.dom.jQuerytransationId=this.jQuery(".transation-id"),this.dom.jQueryactivationCode=this.jQuery(".activation-code"),this.dom.jQuerygoogleAdwords=this.jQuery(".google-adwords-code"),this.dom.jQuerysmsEnabled=this.jQuery("#is-appointment-enabled"),this.dom.jQueryappointmentDate=this.jQuery(".days"),this.dom.jQueryappointmentTime=this.jQuery(".time"),this.dom.jQueryoptionSelector=this.jQuery(".options-selector"),this.dom.jQuerystep2AppointDescription=this.jQueryel.find(".step2-appointment-description")},toggleOtherInterests:function(){console.log("Page Lead: Other Interests"),k.common.toggleOtherInterests({jQueryotherInterests:this.dom.jQueryotherInterests})},toggleOtherGoals:function(){console.log("Page Lead: Other Goals"),k.common.toggleOtherGoals({jQueryotherGoals:this.dom.jQueryotherGoals})},submitStep2:function(a){console.log("Popup Lead: Step 2 Submit"),k.common.submitStep2({e:a,dom:this.dom,scrollFor:this.jQueryel.parent("#lead-popup-content").is(":visible")?k.POPUP_LEAD:k.PAGE_LEAD})}}),k.Popup=Backbone.View.extend({id:"lead-popup-wrapper",tpl:{overlay:'<div id="lead-popup-overlay"></div>',loader:'<div class="loader"><div class="loader-circles bounce1"></div><div class="loader-circles bounce2"></div><div class="loader-circles bounce3"></div></div>'},events:{"click .close-popup":"closePopup","click .submit-step1":"submitStep1"},initialize:function(){c=this,this.dom={}},render:function(){jQuery("#lead-popup-wrapper").remove(),this.jQueryel.append(this.tpl.overlay),this.jQueryel.append(this.tpl.loader),jQuery("body").append(this.jQueryel),k.common.scrollWindow({scrollFor:k.POPUP_LEAD}),this.getContent()},getContent:function(){jQuery.ajax({url:"/leads/popuplead"}).done(this.renderPopup).fail(function(){console.log("Unable to get lead form content")})},renderPopup:function(a){c.jQuery(".loader").hide(),c.jQueryel.append(a),c.dom.jQueryleadPopupContent=c.jQuery("#lead-popup-content"),c.dom.jQuerystep1=c.jQuery(".step1"),c.dom.jQuerystep2=c.jQuery(".step2"),c.dom.jQuerystep1ControlForm=c.jQuery(".step1 .control-form"),c.dom.jQuerystep1ErrorTitle=c.jQuery(".step1-error-title"),c.dom.jQuerystep1ErrorWrapper=c.jQuery(".step1 .error-wrapper"),c.dom.jQuerystep2ControlForm=c.jQueryel.find(".control-form"),c.dom.jQuerystep2Description=c.jQueryel.find(".step2-description"),c.dom.jQuerystep2ThanksTitle=c.jQueryel.find(".step2-thanks-title"),c.dom.jQuerystep2ErrorTitle=c.jQueryel.find(".step2-error-title"),c.dom.jQuerystep2SuccessWrapper=c.jQueryel.find(".success-wrapper"),c.dom.jQuerystep2ErrorWrapper=c.jQueryel.find(".error-wrapper"),c.dom.jQueryrow=c.jQuery(".row"),c.dom.jQueryfirstName=c.jQuery(".first-name"),c.dom.jQuerylastName=c.jQuery(".last-name"),c.dom.jQueryregion=c.jQuery(".region"),c.dom.jQueryclub=c.jQuery(".club"),c.dom.jQueryemail=c.jQuery(".email"),c.dom.jQueryphone=c.jQuery(".phone"),c.dom.jQueryotherInterests=c.jQuery(".otherInterests"),c.dom.jQueryotherGoals=c.jQuery(".otherGoals"),c.dom.jQuerytransationId=c.jQuery(".transation-id"),c.dom.jQueryactivationCode=c.jQuery(".activation-code"),c.dom.jQuerygoogleAdwords=c.jQuery(".google-adwords-code"),c.dom.jQueryoptionSelector=c.jQuery(".options-selector"),c.dom.jQuerypilotFacilityIds=c.jQuery(".pilot-facility-ids"),c.dom.jQueryappointmentCheckbox=c.jQuery(".appointment-checked"),c.dom.jQuerysmsLegalCopy=c.jQuery(".sms-legal-copy"),c.dom.jQueryappointmentSchedule=c.jQuery(".appointment-sch"),c.dom.jQuerydays=c.jQuery(".days"),c.dom.jQuerytime=c.jQuery(".time"),c.dom.jQueryoptionSchedule=c.jQuery(".option-schedule"),c.dom.jQuerystep2AppointDescription=c.jQueryel.find(".step2-appointment-description"),b.renderComponents(c.dom.jQueryleadPopupContent),k.common.fillRegionClubDropdown({jQueryregion:c.dom.jQueryregion,jQueryclub:c.dom.jQueryclub,jQueryoptionSelector:c.dom.jQueryoptionSelector,jQueryappointmentSchedule:c.dom.jQueryappointmentSchedule,jQuerypilotFacilityIds:c.dom.jQuerypilotFacilityIds,jQueryappointmentCheckbox:c.dom.jQueryappointmentCheckbox,jQuerysmsLegalCopy:c.dom.jQuerysmsLegalCopy,clubDefaultText1:""}),k.common.defaultRegionClubSelect({jQueryregion:c.dom.jQueryregion,jQueryclub:c.dom.jQueryclub}),k.common.getSetAdwordCookie(),c.dom.jQueryleadPopupContent.fadeIn("fast"),jQuery(".takeover-module").is(":visible")&&jQuery("body").css("overflow","auto")},closePopup:function(a){a.preventDefault(),jQuery("#lead-popup-wrapper").fadeOut("fast",function(){jQuery(this).remove(),jQuery(".takeover-module").is(":visible")&&jQuery("body").css("overflow","hidden")})},submitStep1:function(a){console.log("Popup Lead: Step 1 Submit"),k.common.submitStep1({e:a,context:this,dom:this.dom,scrollFor:k.POPUP_LEAD})}}),k.Page=Backbone.View.extend({el:"#lead-page-wrapper",events:{"click .submit-step1":"submitStep1","click .submit-step2":"submitStep2"},initialize:function(){this.dom={}},render:function(){if(this.dom.jQueryleadPageWrapper=this.jQuery("#lead-form-wrapper"),this.dom.jQuerystep1=this.jQuery(".step1"),this.dom.jQuerystep2=this.jQuery(".step2"),this.dom.jQuerystep1ControlForm=this.jQuery(".step1 .control-form"),this.dom.jQuerystep1ErrorTitle=this.jQuery(".step1-error-title"),this.dom.jQuerystep1ErrorWrapper=this.jQuery(".step1 .error-wrapper"),this.dom.jQuerystep2ControlForm=this.jQueryel.find(".control-form"),this.dom.jQuerystep2Description=this.jQueryel.find(".step2-description"),this.dom.jQuerystep2ThanksTitle=this.jQueryel.find(".step2-thanks-title"),this.dom.jQuerystep2ErrorTitle=this.jQueryel.find(".step2-error-title"),this.dom.jQuerystep2SuccessWrapper=this.jQueryel.find(".step3.success-wrapper"),this.dom.jQuerystep2ErrorWrapper=this.jQueryel.find(".error-wrapper"),this.dom.jQueryrow=this.jQuery(".row"),this.dom.jQueryfirstName=this.jQueryel.find(".first-name"),this.dom.jQuerylastName=this.jQueryel.find(".last-name"),this.dom.jQueryregion=this.jQueryel.find(".region"),this.dom.jQueryclub=this.jQueryel.find(".club"),this.dom.jQueryemail=this.jQueryel.find(".email"),this.dom.jQueryphone=this.jQueryel.find(".phone"),this.dom.jQueryotherInterests=this.jQueryel.find(".otherInterests"),this.dom.jQueryotherGoals=this.jQueryel.find(".otherGoals"),this.dom.jQuerytransationId=this.jQueryel.find(".transation-id"),this.dom.jQueryactivationCode=this.jQueryel.find(".activation-code"),this.dom.jQuerygoogleAdwords=this.jQueryel.find(".google-adwords-code"),this.dom.jQueryoptionSelector=this.jQuery(".options-selector"),this.dom.jQuerypilotFacilityIds=this.jQuery(".pilot-facility-ids"),this.dom.jQueryappointmentCheckbox=this.jQuery(".appointment-checked"),this.dom.jQuerysmsLegalCopy=this.jQuery(".sms-legal-copy"),this.dom.jQueryappointmentSchedule=this.jQuery(".appointment-sch"),this.dom.jQuerydays=this.jQuery(".days"),this.dom.jQuerytime=this.jQuery(".time"),this.dom.jQueryoptionSchedule=this.jQuery(".option-schedule"),this.dom.jQuerystep2AppointDescription=this.jQueryel.find(".step2-appointment-description"),b.renderComponents(this.dom.jQueryleadPageWrapper),h=this.dom.jQueryregion.length?!0:!1,k.common.fillRegionClubDropdown({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub,jQueryoptionSelector:this.dom.jQueryoptionSelector,jQueryappointmentSchedule:this.dom.jQueryappointmentSchedule,jQuerypilotFacilityIds:this.dom.jQuerypilotFacilityIds,jQueryappointmentCheckbox:this.dom.jQueryappointmentCheckbox,jQuerysmsLegalCopy:this.dom.jQuerysmsLegalCopy,clubDefaultText1:"Please make a selection"}),k.common.defaultRegionClubSelect({jQueryregion:this.dom.jQueryregion,jQueryclub:this.dom.jQueryclub}),k.common.getSetAdwordCookie(),e=jQuery("#scheduleDay").val(),d)l.firstName&&""!==l.firstName&&this.dom.jQueryfirstName.val(l.firstName),l.lastName&&""!==l.lastName&&this.dom.jQuerylastName.val(l.lastName),l.friendEmailId&&""!==l.friendEmailId&&this.dom.jQueryemail.val(l.friendEmailId);else if(e){jQuery(".step2-appointment-description").removeClass("hidden"),jQuery(".step2-description").addClass("hidden"),k.common.replaceEl({jQueryel:jQuery(".step2-appointment-description"),placeholder:"##NAME##",value:jQuery("#nameFirst").val()?jQuery("#nameLast").val():jQuery("#nameFirst").val()});var a=k.common.getClubFullAdress(jQuery("#facilityId").val());j=new m,j.set({ScheduledVisitDay:jQuery("#scheduleDay").val(),ScheduledVisitTime:jQuery("#scheduleTime").val(),Address:a,FacilityId:jQuery("#facilityId").val()})}},submitStep1:function(a){console.log("Page Lead: Step 1 Submit"),k.common.submitStep1({e:a,context:this,dom:this.dom,scrollFor:k.PAGE_LEAD})}}),k.ThankYou=Backbone.View.extend({el:".step3.thanks-step3",template:_.template(jQuery("#thankYouPageContactme").html()),initialize:function(){this.template=_.template(jQuery("#thankYouPageContactme").html())},render:function(a){var b=this;b.jQueryel.find(".thanks-container-main").html(b.template({data:""})),"page lead"!==a.scrollFor.toLowerCase()||b.jQueryel.is(":visible")?jQuery("#lead-popup-wrapper .step3.success-wrapper").fadeIn("fast"):(jQuery("#lead-page-wrapper .step3.success-wrapper").removeClass("hidden"),jQuery("#lead-page-wrapper .step3.success-wrapper").fadeIn("fast"))}}),k.ThankYouAppointment=Backbone.View.extend({el:".step3.thanks-step3",template:_.template(jQuery("#thankYouPageAppointment").html()),events:{"click a.export":"exportToCalendar"},initialize:function(){this.template=_.template(jQuery("#thankYouPageAppointment").html())},render:function(a){var b=this;b.jQueryel.find(".thanks-container-main").html(b.template({data:""})),"page lead"!==a.scrollFor.toLowerCase()||b.jQueryel.is(":visible")?jQuery("#lead-popup-wrapper .step3.success-wrapper").fadeIn("fast"):(jQuery("#lead-page-wrapper .step3.success-wrapper").removeClass("hidden"),jQuery("#lead-page-wrapper .step3.success-wrapper").fadeIn("fast")),e?(this.replaceEl({jQueryel:jQuery(".thanks-date:visible"),placeholder:"##DATE##",value:moment(j.get("ScheduledVisitDay")).format("dddd,[ ]MMM D")}),this.replaceEl({jQueryel:jQuery(".thanks-time:visible"),placeholder:"##TIME##",value:j.get("ScheduledVisitTime")}),this.replaceEl({jQueryel:jQuery(".thanks-address:visible"),placeholder:"##ADDRESS##",value:j.get("Address")})):(this.replaceEl({jQueryel:jQuery(".thanks-date:visible"),placeholder:"##DATE##",value:moment(i.get("ScheduledVisitDay")).format("dddd,[ ]MMM D")}),this.replaceEl({jQueryel:jQuery(".thanks-time:visible"),placeholder:"##TIME##",value:i.get("ScheduledVisitTime")}),this.replaceEl({jQueryel:jQuery(".thanks-address:visible"),placeholder:"##ADDRESS##",value:i.get("Address")}))},exportToCalendar:function(){var a,b,c;e?(a=j.get("FacilityId"),b=moment(j.get("ScheduledVisitDay")).format("MM-DD-YYYY"),c=j.get("ScheduledVisitTime")):(a=i.get("FacilityId"),b=moment(i.get("ScheduledVisitDay")).format("MM-DD-YYYY"),c=i.get("ScheduledVisitTime")),jQuery("a.export").attr("href",APIEndpoint+"/me/calendar/events/exportlead/ics?EventFacilityId="+a+"&EventDate="+b+"&EventStartTime="+c),window.tagData.exportToCal=window.tagData.exportToCal||{},window.tagData.exportToCal={action:"export-complete",type:"appointment"},window.track("exportToCal",window.tagData.exportToCal)},replaceEl:function(a){var b=a.jQueryel.text();b&&a.jQueryel.html(b.replace(a.placeholder,a.value))}}),k.PopupInit=function(){var a=new k.Popup;a.render(),console.log("Lead Popup")},k.PageInit=function(){var a=new k.Page;k.common.checkReferPage(a),a.render(),console.log("Lead Page")}}(window,window.App),function(a,b){"use strict";b.Pages.Notifications={};var c=b.Pages.Notifications,d=Backbone.Model.extend({defaults:{description:"",time:moment().format("h:hh A"),type:0}}),e=Backbone.Collection.extend({model:d}),f=Backbone.View.extend({render:function(){var a,b=jQuery(".notifications-container h2 .count",this.jQueryel),c=jQuery(".notifications",this.jQueryel);return a=new g({collection:this.collection}),c.prepend(a.render().el),b.text(this.collection.length),this}}),g=Backbone.View.extend({className:"notification-group",template:_.template(jQuery("#notificationsGroupView").html()),render:function(){var a=this;return this.jQueryel.html(this.template({date:"today"})),this.collection.each(function(b){
var c=new h({model:b});a.jQueryel.find(".notification-list").append(c.render().el)}),this}}),h=Backbone.View.extend({tagName:"li",className:"notification",template:_.template(jQuery("#notificationSingleView").html()),render:function(){var a=this.model.get("type"),b=1===a?"red":"yellow",c=moment(this.model.get("date")).format("h:hh A");return this.model.set("time",c),this.jQueryel.addClass(b),this.jQueryel.html(this.template(this.model.toJSON())),this}});c.init=function(){var a=jQuery(".notifications-page"),b=moment().subtract("days",2);jQuery.ajax({type:"GET",url:APIEndpoint+"/me/notifications?until="+b.format("YYYY-MM-DD"),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(b){var c,d;debug("[NOTIFICATIONS SERVICE OK]",b),jQuery.each(b,function(a,b){moment().isSame(moment(b.date).format("YYYY-MM-DD"))&&console.log(a),console.log(moment()),console.log(b.date)}),c=new e(b),d=new f({collection:c,el:a}),d.render()},error:function(a){debug("server error",a.responseJSON)}})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.OnBoarding={},d=jQuery(".page");c.Q1={bind:function(){debug("[onboarding] binding Q1 events");var a=this;jQuery('#ContactOptions option[value="Twitter"]').remove(),this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),jQuery(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")}),jQuery(".question #anytime",this.form).on("change",function(){var a=jQuery(".question .datetime-select",this.form);jQuery(this).is(":checked")?a.addClass("hidden"):a.removeClass("hidden")})},saveForm:function(){var a=jQuery("input[type=tel]",this.form),b=jQuery("input[type=email]",this.form),d={email:function(a){return/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},usPhoneNumber:function(a){return/[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}/.test(a)},ukPhoneNumber:function(a){return/\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)/.test(a)}},e="",f=1===window.user.SourceSystem||5===window.user.SourceSystem?d.usPhoneNumber(a.val()):d.ukPhoneNumber(a.val());if(b.length>0?""!==b.val()&&d.email(b.val())?b.removeClass("error"):(b.addClass("error"),e="Please check your email."):a.length>0&&(""!==a.val()&&f?a.removeClass("error"):(a.addClass("error"),e="Please check your Phone number.")),this.form.find(".error").length>0)return void c.dispayError(e);jQuery("form .is-error").addClass("hidden");var g={facilityId:jQuery(".club select option:selected",this.form).data("facility-id"),email:b.length>0?b.val():"",phoneNumber:a.length>0?a.val():"",comments:jQuery("textarea[id=message]",this.form).val(),isAnytime:!1,preferredDay:"",preferredTime:"",refreshCache:!0},h=jQuery("input[id=anytime]",this.form).prop("checked");h?g.isAnytime=!0:(g.preferredDay=jQuery("select[id=DayOptions]",this.form).val(),g.preferredTime=jQuery("select[id=TimeOptions]",this.form).val());var i=jQuery("form").find('input[type="submit"]');i.data("old-copy",i.val()),i.val("Loading...").attr("disabled",!0);var j=APIEndpoint+"/personal-training/schedule-equifit-assessment";jQuery.ajax({url:j,contentType:"application/json",data:JSON.stringify(g),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ONBOARDING RESPONSE",a),c.redirect()}).fail(function(){debug("Server Error");var a=jQuery("form").find('input[type="submit"]');a.val(a.data("old-copy")).attr("disabled",!1)})},init:function(){this.form=jQuery("form.join-schedule-form"),this.bind()}},c.Q2={bind:function(){debug("[onboarding] binding Q2 events");var a=this;this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),jQuery(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")})},saveForm:function(){var a,b=jQuery("input[name=questionId]",this.form).val(),d=jQuery("input[name=answer]",this.form).val();a={questionId:b,answerId:d,answerText:"",isSelected:!0},c.updateAnswers(a,c.redirect,!0)},init:function(){this.form=jQuery("form"),this.bind()}},c.Q3={bind:function(){debug("[onboarding] binding Q3_Q4 events");var a=this,b=jQuery("textarea[name=otherAnswerText]",a.form);jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),jQuery(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")}),a.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),jQuery("label.check-selector",a.form).on("click",function(){a.toggleCheck(jQuery(this))}),b.length&&b.on("change",function(){a.toggleAnswer(b)})},toggleAnswer:function(a){""!==a.val()?this.checkCount<this.maxSelections&&this.checkCount++:this.checkCount>0&&this.checkCount--,this.toggleSelections()},toggleCheck:function(a){var b=a.find("input[type=checkbox]");1===this.maxSelections&&(jQuery("label.check-selector input[type=checkbox]").each(function(){jQuery(this).val()!==b.val()&&(jQuery(this).prop("checked",!1),jQuery(this).parents("label.check-selector").removeClass("checked"))}),b.not(":checked")&&(a.removeClass("checked"),this.checkCount>0&&this.checkCount--)),b.is(":checked")&&this.checkCount<this.maxSelections&&!a.hasClass("checked")?(a.addClass("checked"),this.checkCount++):a.hasClass("checked")&&(a.removeClass("checked"),this.checkCount>0&&this.checkCount--),this.toggleSelections()},toggleSelections:function(){this.checkCount===this.maxSelections?(1!==this.maxSelections&&jQuery("label.check-selector input[type=checkbox]").not(":checked").each(function(){jQuery(this).prop("disabled",!0)}),""===jQuery("textarea[name=otherAnswerText]",this.form).val()&&jQuery("textarea[name=otherAnswerText]",this.form).prop("disabled",!0)):this.checkCount<this.maxSelections&&(jQuery("label.check-selector input[type=checkbox][disabled]").each(function(){jQuery(this).prop("disabled",!1)}),""===jQuery("textarea[name=otherAnswerText]",this.form).val()&&jQuery("textarea[name=otherAnswerText]",this.form).prop("disabled",!1))},loadForm:function(){var a=parseInt(jQuery("input[name=questionId]",this.form).val(),10),b=c.getAnswerByQID(a),d=[],e=this;b&&(d=_.uniq(_.flatten(b,"answerId")),jQuery.each(d,function(a,c){if(e.checkCount<e.maxSelections){var d=jQuery("input[value="+c+"]",e.form);d.prop("checked",!0),d.parent("label.check-selector").addClass("checked"),e.checkCount++,debug("LOADED FORM",b[a])}})),this.toggleSelections()},saveForm:function(){var a,b=parseInt(jQuery("input[name=questionId]",this.form).val(),10),d=jQuery("input[name=answers]:checked",this.form),e={id:jQuery("input[name=otherAnswerId]",this.form).val(),text:jQuery("textarea[name=otherAnswerText]",this.form).val(),isDefault:!1},f=d.length,g={questions:[]},h={questionId:b,answers:[]},i=!0;""!==e.id&&""!==e.text&&f++,0!==f&&f<=this.maxSelections?(0===d.length&&e.id&&""!==e.text?h.answers.push({answerId:e.id,answerText:e.text,isSelected:!0}):1===d.length?h.answers.push({answerId:d.val(),isSelected:!0}):d.length>1?(jQuery.each(d,function(a,b){h.answers.push({answerId:jQuery(b).val(),isSelected:!0})}),!e.isDefault&&e.id&&h.answers.push({answerId:e.id,answerText:e.text,isSelected:!0})):(i=!1,a="You need to select at least one option.",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections)),i&&(g.questions.push(h),jQuery("form .is-error").addClass("hidden"),c.updateAnswers(g,c.redirect))):0===f?(a="You need to select at least one option.",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections)):(a=1===this.maxSelections?"option":"options",a="You can't select more than "+this.maxSelections+" "+a+".",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections))},init:function(){this.form=jQuery("form"),this.maxSelections=parseInt(jQuery("input[name=maxSelections]",this.form).val(),10),this.checkCount=0,this.loadForm(),this.bind()}},c.Q4=c.Q3,c.Q5={bind:function(){debug("[onboarding] binding Q5 events");var a=this;this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),jQuery(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")})},loadForm:function(){this.form.find("fieldset").each(function(){if(0!==jQuery(this).find('input[type="radio"]').length){var a=jQuery(this).find('input[type="radio"]').attr("name").match(/\djQuery/)[0],b=c.getAnswerByQID(a);b&&b.forEach(function(a){jQuery("input[value="+a.answerId+"]").prop("checked",a.isSelected).trigger("change")})}})},saveForm:function(){var a,b={questions:[]},d=!0;this.form.find("fieldset").each(function(){if(0!==jQuery(this).find('input[type="radio"]').length){var a=[];jQuery(this).find('input[type="radio"]:checked').each(function(){a.push({answerId:jQuery(this).val(),isSelected:jQuery(this).is(":checked")})}),b.questions.push({questionId:jQuery(this).find('input[type="radio"]').attr("name").match(/\djQuery/)[0],answers:a}),0===a.length&&(d=!1)}}),d?c.updateAnswers(b,c.redirect):(a="You need to answer all the questions.",c.dispayError(a))},init:function(){this.form=jQuery("form"),this.bind(),this.loadForm()}},c.Q6={init:function(){jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")})}},c.updateAnswers=function(a,b,c){var d;d=c?APIEndpoint+"/personalization/onboarding/questions/me/updateanswer":APIEndpoint+"/personalization/onboarding/questions/me/update",debug("SENDING DATA",a);var e=jQuery("form").find('input[type="submit"]');e.data("old-copy",e.val()),e.val("Loading...").attr("disabled",!0),jQuery.ajax({url:d,contentType:"application/json",data:JSON.stringify(a),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ONBOARDING RESPONSE",a),b()}).fail(function(){debug("Server Error");var a=jQuery("form").find('input[type="submit"]');a.val(a.data("old-copy")).attr("disabled",!1)})},c.getAnswerByQID=function(a){var b=!1;return c.data&&jQuery.each(c.data,function(c,d){d.questionId===a&&(b=d.answers)}),b},c.dispayError=function(a){var b=jQuery("form .is-error");b.text(a).removeClass("hidden"),jQuery("html, body").animate({scrollTop:b.offset().top-150},500)},c.redirect=function(){var a=jQuery("form input[name=nextPage]").val();a&&(window.location=a)},c.start=function(a){debug("[OnBoarding] guid",a),"true"===window.EQ.Helpers.readCookie("from_ios")&&window.EQ.Helpers.tryFastAppSwitch()},c.init=function(a){debug("[OnBoarding] Init at step",a),d.addClass("full-bleed onboarding"),jQuery.ajax({url:APIEndpoint+"/personalization/onboarding/questions/me",contentType:"application/json",data:{questionTypes:"OnBoarding"},type:"GET",xhrFields:{withCredentials:!0}}).done(function(b){debug("ONBOARDING RESPONSE",b),c.data=b.answeredQuestions,a&&c["Q"+a]&&c["Q"+a].init(),"start"===a&&(jQuery(document).find("#onboard-startBtn").on("click",function(){window.track("regOnboardSubmit")}),jQuery(document).find(".highlight").on("click",function(){window.track("regOnboardCancel")}))}).fail(function(){debug("Server Error")})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Password={},d=jQuery(".recover-password"),e=jQuery(".reset-password");c.Forgot={},c.Reset={},c.Forgot.init=function(){debug("[forgotPassword] Init"),c.Forgot.bind()},c.Forgot.bind=function(){var a=c.Forgot;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.Forgot.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({email:"RecoverPassword.UserName"},function(){var a=jQuery(".password-recover-confirmation"),b=d.data("publicMethods").getData()["RecoverPassword.UserName"];a.removeClass("hidden"),debug("[regForgotPWEmlSent] Success fully retrived"),window.track("regForgotPWEmlSent"),a.find(".user-email").text(b),d.add(".lost-credentials").add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),jQuery("body, html").animate({scrollTop:0})})},c.Reset.init=function(){debug("[resetPassword] Init"),c.Reset.bind()},c.Reset.bind=function(){var a=c.Reset;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit(),debug("[validateAndSubmit] called")})},c.Reset.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({url:"ResetPassword.url",lastName:"ResetPassword.LastName",password:"ResetPassword.NewPassword"},function(){a.location.href="/"})}}(window,window.App),function(a,b){"use strict";var c,d=b.Pages.PilatesInquire={},e=!1;console.log(e),d.Form={init:function(){c=this,jQuery(".dtm-pilateslastpurchase").addClass("hide"),jQuery(".dtm-pilatespurchasecallout").addClass("hide");var a=jQuery(".offer-hero").find(".smalll:visible");a.text("Loading...").attr("disabled",!0);var b=APIEndpoint+"/pilates/accessclubs/";jQuery.ajax({url:b,contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}).done(function(b){debug("ScheduleInquire RESPONSE",b),localStorage.removeItem("response"),b.tryPilatesCTA?(jQuery("#pilatesLanding-pilates-text-callout").addClass("hide"),a.text(jQuery("#PilatesHero_TryPilatesCTA").data("copy")),jQuery(".PilatesHero_TryPilateseDescr").removeClass("hide"),a.attr("href",jQuery("#PilatesHero_TryPilatesCTA").data("href")),a.attr("disabled",!1),jQuery(".column.leftColumn").addClass("hide")):-1===b.voucherPulled?(jQuery(".dtm-pilatespurchasecallout").removeClass("hide"),jQuery(".pilates-inquire-callout").removeClass("hide"),jQuery(".PilatesHero_PurchaseDescr").removeClass("hide"),a.text(jQuery("#PilatesHero_PurchaseCTA").data("copy")),a.attr("href",jQuery("#PilatesHero_PurchaseCTA").data("href")),a.attr("disabled",!1)):0===b.voucherPulled?(jQuery(".dtm-pilatespurchasecallout").removeClass("hide"),jQuery(".pilates-schedule-callout").removeClass("hide"),jQuery(".PilatesHero_PurchaseDescr").removeClass("hide"),a.text(jQuery("#PilatesHero_PurchaseCTA").data("copy")),a.attr("href",jQuery("#PilatesHero_PurchaseCTA").data("href")),a.attr("disabled",!1),jQuery(".class-module #PilatesPurchaseCallout_InquireCTA").addClass("hide"),jQuery(".class-module #PilatesPurchaseCallout_ScheduleCTA").removeClass("hide")):(b.voucherPulled>0||-2===b.voucherPulled)&&(d.History.init(b,a),a.addClass("hide"))}).fail(function(){debug("Server Error")})}},d.History={init:function(a,b){console.log(a),c=this;var d=APIEndpoint+"/pilates/getPilatePurchaseHistory";jQuery.ajax({url:d,contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}).done(function(a){debug("ScheduleInquire RESPONSE",a),a.length&&(jQuery(".dtm-pilateslastpurchase").removeClass("hide"),jQuery(".session-type").text(a[0].displaySessionName),jQuery(".session-duration").text("55 MIN"),jQuery(".session-capacity").text(a[0].quantity+" PK"),b.hide(),jQuery(".offer-hero").find("p").addClass("hide"),"undefined"!=typeof Storage?localStorage.setItem("response",JSON.stringify(a)):console.log("Your Browser does not support"))}).fail(function(){debug("Server Error")})}},d.init=function(){window.user&&d.Form.init()}}(window,window.App),function(a,b){"use strict";var c,d=b.Pages.SheduleAndInquire={},e=jQuery(".page");d.Form={bind:function(){debug("[ScheduleInquire] binding events");var a=this;jQuery('#ContactOptions option[value="Twitter"]').remove(),this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regScheduleInquireSubmit"),debug("[regScheduleInquireSubmit] regScheduleInquireSubmit event")}),jQuery(document).find(".highlight").on("click",function(){window.track("regScheduleInquireCancel"),debug("[regScheduleInquireCancel] regScheduleInquireCancel event")}),jQuery(".question #anytime",this.form).on("change",function(){var a=jQuery(".question .datetime-select",this.form);jQuery(this).is(":checked")?a.addClass("hidden"):a.removeClass("hidden")})},saveForm:function(){var a=jQuery("input[type=tel]",this.form),b=jQuery("input[type=email]",this.form),e={email:function(a){return/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},usPhoneNumber:function(a){return/[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}/.test(a)},ukPhoneNumber:function(a){return/\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)/.test(a)}},f="",g="",h=!1,i=1===window.user.SourceSystem||5===window.user.SourceSystem?e.usPhoneNumber(a.val()):e.ukPhoneNumber(a.val());if(b.length>0?""!==b.val()&&e.email(b.val())?(b.removeClass("error"),jQuery("form .contact-uppertext").removeClass("error")):(b.addClass("error"),f="Please check your email."):a.length>0&&(""!==a.val()&&i?(a.removeClass("error"),jQuery("form .contact-uppertext").removeClass("error")):(a.addClass("error"),f="Please check.")),jQuery("form .is-error.contact").addClass("hidden"),jQuery("form .is-error.msg").addClass("hidden"),this.form.find(".error").length>0)return void(h&&""===f?d.dispayErrorMsg(g):h&&""!==f?(d.dispayError(f),d.dispayErrorMsg(g)):h||""===f||d.dispayError(f));var j={facilityName:jQuery(".club select option:selected",this.form).text(),facilityId:jQuery(".club select option:selected",this.form).data("id"),email:b.length>0?b.val():"",phoneNumber:a.length>0?a.val():"",comments:jQuery("textarea[id=message]",this.form).val()},k=jQuery("form").find('input[type="submit"]');k.val("Loading...").attr("disabled",!0);var l=APIEndpoint+"/pilates/submitinquiry/";jQuery.ajax({url:l,contentType:"application/json",data:JSON.stringify(j),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ScheduleInquire RESPONSE",a),c.form.hide(),c.jQuerythankContainer.removeClass("hidden");var b=jQuery("input[type=email]",this.form).val(),d=jQuery("input[type=tel]",this.form).val(),e=jQuery(".thank-you-text2").text();if(b){var f=e.replace("##CONTACT_MODE##","email "+b);jQuery(".thank-you-text2").text(f)}else{var g=e.replace("##CONTACT_MODE##","phone number "+d);jQuery(".thank-you-text2").text(g)}jQuery("html, body").animate({scrollTop:c.jQuerythankContainer.offset().top-150},500)}).fail(function(){debug("Server Error"),c.form.hide(),c.jQueryerrorContainer.removeClass("hidden"),jQuery("html, body").animate({scrollTop:c.jQueryerrorContainer.offset().top-150},500)})},init:function(){c=this,this.form=jQuery("form.join-schedule-form"),this.jQuerythankContainer=jQuery(".schedule-Inquire-thanks"),this.jQueryerrorContainer=jQuery(".schedule-Inquire-error"),this.bind()}},d.dispayError=function(a){var b=jQuery("form .is-error.contact");b.text(a).removeClass("hidden"),jQuery("form .contact-uppertext").addClass("error"),jQuery("html, body").animate({scrollTop:b.offset().top-150},500)},d.dispayErrorMsg=function(a){var b=jQuery("form .is-error.msg");b.text(a).removeClass("hidden"),jQuery("form .message-uppertext").addClass("error"),jQuery("html, body").animate({scrollTop:b.offset().top-150},500)},d.init=function(){debug("[ScheduleEquifit] Init"),e.addClass("full-bleed ScheduleInquire"),d.Form.init()}}(window,window.App),function(a,b){"use strict";var c,d=b.Pages.Rewards={};d.jQueryview={details:jQuery("#rewardDetails"),history:jQuery("#rewardHistory")},d.printGiftCard=function(a){debug("[Rewards] print gift card",a),window.open(APIEndpoint+a.data("url"))},d.activateGiftCard=function(a){if(debug("[Rewards] activate Gift Card",a),!a.data("is-clicked")){a.data("is-clicked",!0);var b={url:a.data("url"),method:a.data("method"),data:{id:a.data("id")},el:a,title:a.html(),callback:function(){d.reloadPage(),c&&(window.open(APIEndpoint+"/me/rewards/giftcard/print?gcNumber="+c.encryptGiftCardNumber,"_blank"),window.focus())}};a.html("Processing please wait..."),this.ajaxManager(b)}},d.ajaxManager=function(a){a=a||{},jQuery.ajax(this.ENDPOINT+a.url,{data:JSON.stringify(a.data),contentType:"application/json",type:a.method,xhrFields:{withCredentials:!0},crossDomain:!0}).done(function(b){c=b,a.callback(b)}).fail(function(b,c,e){a.el.html(a.title),debug("[Rewards] Error",b,c,e),d.error(b,c,e)})},d.error=function(a,b,c){debug("[Rewards] error",a,b,c);var e=JSON.parse(a.responseText);console.log("message",e),d.jQueryview.details.html('<h2 class="title paragraph">'+e.error.message+"</h2>")},d.reloadPage=function(){location.reload(!0)},d.bind=function(){this.jQueryview.details.on("click",".print",function(a){a.preventDefault(),d.printGiftCard(jQuery(a.currentTarget))}),this.jQueryview.details.on("click",".activate",function(a){a.preventDefault(),d.activateGiftCard(jQuery(a.currentTarget))})},d.init=function(){d.ENDPOINT=APIEndpoint,d.bind()}}(window,window.App),function(a,b){"use strict";var c,d=b.Pages.ScheduleEquifit={},e=jQuery(".page");d.Form={bind:function(){debug("[ScheduleEquifit] binding events");var a=this;jQuery('#ContactOptions option[value="Twitter"]').remove(),this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regScheduleEquifitSubmit"),debug("[regScheduleEquifitSubmit] regScheduleEquifitSubmit event")}),jQuery(document).find(".highlight").on("click",function(){window.track("regScheduleEquifitCancel"),debug("[regScheduleEquifitCancel] regScheduleEquifitCancel event")}),jQuery(".question #anytime",this.form).on("change",function(){var a=jQuery(".question .datetime-select",this.form);jQuery(this).is(":checked")?a.addClass("hidden"):a.removeClass("hidden")})},saveForm:function(){var a=jQuery("input[type=tel]",this.form),b=jQuery("input[type=email]",this.form),e={email:function(a){return/^((([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\jQuery%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))jQuery/i.test(a)},usPhoneNumber:function(a){return/[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}/.test(a)},ukPhoneNumber:function(a){return/\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)/.test(a)}},f="",g=1===window.user.SourceSystem||5===window.user.SourceSystem?e.usPhoneNumber(a.val()):e.ukPhoneNumber(a.val());if(b.length>0?""!==b.val()&&e.email(b.val())?b.removeClass("error"):(b.addClass("error"),f="Please check your email."):a.length>0&&(""!==a.val()&&g?a.removeClass("error"):(a.addClass("error"),f="Please check your Phone number.")),this.form.find(".error").length>0)return void d.dispayError(f);jQuery("form .is-error").addClass("hidden");var h={facilityId:jQuery(".club select option:selected",this.form).data("facility-id"),email:b.length>0?b.val():"",phoneNumber:a.length>0?a.val():"",comments:jQuery("textarea[id=message]",this.form).val(),isAnytime:!1,preferredDay:"",preferredTime:"",refreshCache:!0},i=jQuery("input[id=anytime]",this.form).prop("checked");i?h.isAnytime=!0:(h.preferredDay=jQuery("select[id=DayOptions]",this.form).val(),h.preferredTime=jQuery("select[id=TimeOptions]",this.form).val());var j=jQuery("form").find('input[type="submit"]');j.val("Loading...").attr("disabled",!0);var k=APIEndpoint+"/personal-training/schedule-equifit-assessment";jQuery.ajax({url:k,contentType:"application/json",data:JSON.stringify(h),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ScheduleEquifit RESPONSE",a),c.form.hide(),c.jQuerythankContainer.removeClass("hidden"),jQuery("html, body").animate({scrollTop:c.jQuerythankContainer.offset().top-150},500)}).fail(function(){debug("Server Error"),c.form.hide(),c.jQueryerrorContainer.removeClass("hidden"),jQuery("html, body").animate({scrollTop:c.jQueryerrorContainer.offset().top-150},500)})},init:function(){c=this,this.form=jQuery("form.join-schedule-form"),this.jQuerythankContainer=jQuery(".schedule-equifit-thanks"),this.jQueryerrorContainer=jQuery(".schedule-equifit-error"),this.bind()}},d.dispayError=function(a){var b=jQuery("form .is-error");b.text(a).removeClass("hidden"),jQuery("html, body").animate({scrollTop:b.offset().top-150},500)},d.init=function(){debug("[ScheduleEquifit] Init"),e.addClass("full-bleed schedule-equifit"),d.Form.init()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.SignIn={},d=jQuery(".tpl-memberimagetextcallout div").data("template-data"),e=jQuery(".eq-sign-in"),f=jQuery(".signup-facebook-withoutemail");c.FacebookWithOutEmail={},c.init=function(){debug("[SignIn] Init"),console.log(d),c.bind()},c.bind=function(){var a=c;this.fbLogin.bind(),e.on("click",function(b){b.preventDefault(),a.submit()})},c.fbLogin={bind:function(){jQuery(".fb-login").on("click",c.fbLogin.intent.bind(c.fbLogin))},intent:function(){window.track("regSignupWithFB"),this.getToken(function(b){debug("FBT:",b);var e={barcodeId:d.BarcodeId,fbAccessToken:b,sourceSystem:d.SourceSystem,lastName:d.LastName,firstName:d.FirstName};jQuery.ajax(APIEndpoint+"/registration/signupwithfacebook",{data:JSON.stringify(e),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FB SignUP] Success"),jQuery.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:e.fbAccessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FBLogin] Success");var b=new Date;b.setTime(b.getTime()+12e5),jQuery.cookie("isMemberRegisteredFB","true",{expires:b,path:"/"}),a.location.href="/"}).fail(function(a){var b=a.responseJSON&&a.responseJSON.message;debug("[FBLogin] Failed",b),b&&jQuery(".is-error").removeClass("hidden").text(b)})}).fail(function(a){if(40021===a.responseJSON.messageId)return c.redirectToFacebookWithSigninEmail(e);var b=a.responseJSON&&a.responseJSON.message;debug("[FBLogin] Failed",b),b&&jQuery(".is-error").removeClass("hidden").text(b)})})},getToken:function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse.accessToken)},{scope:"email,user_likes,user_friends"})}},c.submit=function(){var a=jQuery("<form></form>");a.attr("action","/activate/signin/equinox").attr("method","POST");var b=jQuery('<input type="hidden"/>').attr("name","LastName").val(d.LastName),c=jQuery('<input type="hidden"/>').attr("name","Country").val(d.SourceSystem),e=jQuery('<input type="hidden"/>').attr("name","Barcode").val(d.BarcodeId);a.append(b),a.append(c),a.append(e),jQuery("body").append(a),a.submit()},c.redirectToFacebookWithSigninEmail=function(a){var b=jQuery("<form></form>");b.attr("action","/activate/signin/facebook/email").attr("method","POST");var c=jQuery('<input type="hidden"/>').attr("name","LastName").val(a.lastName),d=jQuery('<input type="hidden"/>').attr("name","FirstName").val(a.firstName),e=jQuery('<input type="hidden"/>').attr("name","Country").val(a.sourceSystem),f=jQuery('<input type="hidden"/>').attr("name","Barcode").val(a.barcodeId),g=jQuery('<input type="hidden"/>').attr("name","FbToken").val(a.fbAccessToken);b.append(c),b.append(e),b.append(d),b.append(f),b.append(g),jQuery("body").append(b),b.submit()},c.FacebookWithOutEmail.init=function(){debug("[FacebookWithOutEmail] Init"),c.FacebookWithOutEmail.bind()},c.FacebookWithOutEmail.bind=function(){var a=c.FacebookWithOutEmail;f.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.FacebookWithOutEmail.validateAndSubmit=function(){f.data("publicMethods").isValid()&&f.data("publicMethods").sendAjaxRequest({sourceSystem:"country",barcodeId:"barcode",lastName:"lastName",FacebookAccessToken:"fbAccessToken",email:"EmailForm.EmailLabel"},function(){var a=jQuery(".facebook-confirmation"),b=f.data("publicMethods").getData()["EmailForm.EmailLabel"];a.removeClass("hidden"),a.find(".user-email").text(b),f.add(".lost-credentials").add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),jQuery("body, html").animate({scrollTop:0})})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.User={},d=jQuery(".recover-username"),e=jQuery(".change-username"),f=jQuery(".verify-username"),g=jQuery(".spa-member-upgrade");c.Forgot={},c.ChangeUserName={},c.VerifyUserName={},c.SpaMemberUpgrade={},c.Forgot.init=function(){debug("[forgotUser] Init"),c.Forgot.bind()},c.Forgot.bind=function(){var a=c.Forgot;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.Forgot.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({country:"country",barcode:"RecoverUserName.Barcode",lastName:"RecoverUserName.LastName"},function(a){debug("[forgotUser] Callback"),jQuery(".user-recover-confirmation").removeClass("hidden"),window.track("regForgotUsername"),debug("[regForgotUsername] tracking event for regForgotUsername"),jQuery(".confirmation-message-module").data("templateData",{firstName:a.firstName,email:a.email}).data("publicMethods").render(),d.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".lost-credentials").addClass("hidden"),jQuery("body, html").animate({scrollTop:0})})},c.ChangeUserName.init=function(){debug("[changeUserName] Init"),c.ChangeUserName.bind()},c.ChangeUserName.bind=function(){var a=c.ChangeUserName;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.ChangeUserName.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({email:"LoginWithEmailForm.EmailLabel",password:"password",username:"username"},function(){var a=jQuery(".change-username-confirmation"),b=e.data("publicMethods").getData()["LoginWithEmailForm.EmailLabel"];a.removeClass("hidden"),a.find(".user-email").text(b),e.add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),
jQuery("body, html").animate({scrollTop:0})})},c.VerifyUserName.init=function(){debug("[verifyUserName] Init"),c.VerifyUserName.bind()},c.VerifyUserName.bind=function(){var a=c.VerifyUserName;f.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.VerifyUserName.validateAndSubmit=function(){f.data("publicMethods").isValid()&&f.data("publicMethods").sendAjaxRequest({url:"SumbitEmailModel.Token",password:"SumbitEmailModel.Password"},function(){"true"===window.EQ.Helpers.readCookie("from_ios")&&window.EQ.Helpers.tryFastAppSwitch(),EQ.Helpers.refreshUserCacheData(function(){a.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})})},c.SpaMemberUpgrade.init=function(){debug("[SpaMemberUpgrade] Init"),c.SpaMemberUpgrade.bind()},c.SpaMemberUpgrade.bind=function(){var a=c.SpaMemberUpgrade;g.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.SpaMemberUpgrade.validateAndSubmit=function(){g.data("publicMethods").isValid()&&g.data("publicMethods").sendAjaxRequest({userId:"userId",country:"country",barcode:"SpaForm.BarcodeLabel",lastName:"SpaForm.LastNameLabel"},function(){a.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})}}(window,window.App),function(a){"use strict";a.Pages.WorkoutSummaryShared={init:function(a){jQuery(".rank-num sup").text(function(){return EQ.Helpers.ordinate(parseInt(jQuery(this).parent().text(),10)).ord}),null!==user?jQuery(".member").removeClass("hidden"):(jQuery(".non-member").removeClass("hidden"),user.ShareId===a&&jQuery(".g-pronoun").text("You"))}}}(window.App),function(a){"use strict";var b,c,d,e,f,g,h,i=a.Pages.WorkoutSummary={},j=jQuery("section.page.class-summary"),k=jQuery(".intensity-level-container"),l=jQuery(".intensity .measure"),m=k.find("input"),n=k.find(".intensity-level"),o=jQuery(".calories-value-container"),p=jQuery(".calories .measure"),q=o.find("input"),r=jQuery(".edit-button"),s=k.parent(".inactive"),t=jQuery(".duration"),u=jQuery(".error-area"),v=jQuery(".turn-acce"),w=jQuery(".overlay-box"),x="True"===j.data("hasacce"),y="True"===j.data("custom"),z="True"===j.data("ocr"),A=j.data("distance"),B="True"===j.data("optedout"),C=j.data("workoutdate"),D=jQuery(".cycling-acce .calories .measure").text(),E=!1;i.init=function(k){var l=jQuery(".raw-model").html();c=JSON.parse(l.substr(0,l.length-1)),debug("Summary Data",c),d=k,e=c.WorkoutEvent.ClassInstanceId,f=c.WorkoutEvent.CategoryId,g=c.WorkoutEvent.SubCategoryId,jQuery(".time-location").text(function(a,b){if(jQuery(this).data("facilityid")){var c=EQ.Helpers.getFacilityById(jQuery(this).data("facilityid"));null!==c&&(b=b+", "+c.ClubName)}return b}),h=EQ.Helpers.loaderAndErrorHandler(u,{color:"black"});var n=jQuery("<div></div>"),s=!1;j.append(n),a.loadComponent("automatic-calories-overlay",n),Backbone.Events.on("automatic-calories-overlay:save-info",function(){s=!0}),Backbone.Events.on("automatic-calories-overlay:close",function(){s&&location.reload()}),q.on("keydown",i.validate).on("keyup",i.updateValue),m.on("click",i.radioButtonHighlight).on("click",i.updateCaloriesText),v.on("click",i.switchACCE),jQuery(".icon-left-arrow").on("click",i.backButton),jQuery(".remove-class").on("click",i.removeClass),6!==f||y||z?i.acceClassBehavior():(b=r.add(o).add(p),r.on("click",i.editCycling),h.showLoader(),i.loadCyclingStats().done(function(){h.hideLoader(),debug("<------  HAS DATA  ------>",E),E?(p=jQuery(".calories:first .measure"),jQuery(".cycling-acce").remove(),jQuery(".notes-container").remove(),v.remove(),jQuery(".editable-info-container").removeClass("hidden"),jQuery(".class-rank-container").removeClass("hidden")):(jQuery(".five-items").remove(),jQuery(".cycling-acce").removeClass("hidden"),jQuery(".notes-container").removeClass("hidden"),v.removeClass("hidden"),q=jQuery(".calories-value-container input"),i.acceClassBehavior()),p=jQuery(".calories .measure")}).fail(function(){h.showError()}))},i.acceClassBehavior=function(){x&&(m.on("click",i.updateCalories),null===localStorage.getItem("acce-"+d)&&"-"!==l.text()&&(i.showMessage("acce",4e3),localStorage.setItem("acce-"+d,"true"))),b=k.add(o).add(l).add(p).add(r),r.off().on("click",i.edit)},i.loadCyclingStats=function(){var a=jQuery.Deferred(),b={CLASS_STATS:"/v3/classes/"+e+"/me/statistics",UNITS:"/v2.6/me/profile/unitofmeasure"},c=EQ.Helpers.getService(b.CLASS_STATS),d=EQ.Helpers.getService(b.UNITS);return EQ.Helpers.when(c,d).done(function(b){i.userStatsView(b[0],b[1].unitOfMeasure),B||i.userRankView(b[0],userProfileJson.Gender),a.resolve()}).fail(function(){a.reject()}),a},i.userRankView=function(a,b){b=b?b:"female";var c=jQuery(".rank-result"),d=c.siblings(".first-position");if(0!==a.rank){var e=EQ.Helpers.ordinate(a.rank);"1"===e.num&&(c.addClass("hidden"),d.removeClass("hidden"),d.find("."+b.toLowerCase()).removeClass("hidden"),c=d),c.find(".rank-num").html(e.num+"<sup>"+e.ord+"</sup>"),c.find(".rank-total").text(a.userCount),c.find(".rank-gender").text(function(){return jQuery(this).text().replace("[men/women]","female"===b.toLowerCase()?"women":"men")})}else c.hide()},i.userStatsView=function(a,b){var c=jQuery(".editable-info-container").children().find(".measure"),d="-",e="-";a.metrics.length>0&&_.each(a.metrics,function(f){var g=c.filter("[data-type="+f.name+"]");e="-",f.value&&("Power"===f.metric||"Calories"===f.metric||"Energy"===f.metric?(e=parseInt(f.value,10)+EQ.Helpers.shortUnit(f.metric),"Calories"===f.metric&&D&&"-"!==D&&(e=parseInt(D,10)+EQ.Helpers.shortUnit(f.metric))):"Distance"===f.metric&&""!==A?(d=EQ.Helpers.numbers.trimDecimals(A)+" "+EQ.Helpers.longUnit(f.metric+b),e=EQ.Helpers.numbers.trimDecimals(A)+EQ.Helpers.shortUnit(f.metric+b)):e=EQ.Helpers.numbers.trimDecimals(f.value)+EQ.Helpers.shortUnit(f.metric+b),E=!0),_.each(a.bestClassMetrics,function(a){a.name===f.name&&a.value===f.value&&jQuery("."+f.name).removeClass("hidden")}),g.text(e)}),i.SharingComponent(d)},i.SharingComponent=function(b){var d,f,h=document.location.protocol+"//"+location.host+"/activity/"+userProfileJson.ShareId+"/classes/"+e,i="",k=j.find(".social-icons .icon-twitter");switch(k.length>0&&k.data("tw-share-copy")&&(i=k.data("tw-share-copy")),parseInt(g,10)){case 1:d=c.ClassSummary.OgTitle,i="I just rode "+b+" in an Equinox Cycling Class. "+h+" #EQSTUDIOCYCLING",f=c.ClassSummary.OgImageUrl?c.ClassSummary.OgImageUrl:location.origin+"/assets/images/sharing/fb_bab.png";break;case 2:d="The Pursuit: Build",i=(i?i:"I just went on the ultimate power trip in this new cycling class. Its one wild ride. #EQXpursuit ")+h,f=c.ClassSummary.OgImageUrl?c.ClassSummary.OgImageUrl:location.origin+"/assets/images/activity/sharing/EQ_FacebookPost_Build_1200x630.png";break;case 3:d="The Pursuit: Burn",i=(i?i:"I just set the bike on fire in this new cycling class. Its one wild ride. #EQXpursuit ")+h,f=c.ClassSummary.OgImageUrl?c.ClassSummary.OgImageUrl:location.origin+"/assets/images/activity/sharing/EQ_FacebookPost_Burn_1200x630.png";break;default:d=c.ClassSummary.OgTitle,i="Twitter Share",f=c.ClassSummary.OgImageUrl?c.ClassSummary.OgImageUrl:location.origin+"/assets/images/sharing/fb_bab.png"}a.loadComponent("share",jQuery(".social-icons"),{type:"share-summary",fbMode:"share-summary",distance:b,linkurl:h,picture:f,name:d,twCopy:i})},i.editCycling=function(a){a.preventDefault();var c=new jQuery.Deferred,d="medium",e=q.val();h.hideError(),jQuery(this).hasClass("save")&&""!==e&&e!==p.text()?c=i.save(e,d):(e.length||q.val(parseInt(p.text(),10)||""),c.resolve()),c.always(function(){b.toggleClass("hidden")})},i.edit=function(a){if(a.preventDefault(),y||z)window.location.href="/activity/workout/add-custom/"+d;else{a.preventDefault();var c=new jQuery.Deferred,e=new RegExp("low|medium|high"),f=n.text().toLowerCase(),g=l.text().toLowerCase(),j=q.val();h.hideError(),jQuery(this).hasClass("save")&&(j!==p.text()||f!==g)&&e.test(f)?c=i.save(j,f):(j.length||q.val(parseInt(p.text(),10)||""),n.text(e.test(g)?g:"HOW HARD DID YOU GO?"),i.radioButtonSetActive(g),c.resolve()),c.always(function(){b.toggleClass("hidden"),s.toggleClass("inactive"),t.toggleClass("hidden")})}},i.save=function(a,b){h.showLoader();var c=!0,e=0,f="/v2.6/me/workouts/"+d+"/update-calories/"+a+"/"+b.toLowerCase();return""===a&&(f="/v2.6/me/workouts/"+d+"/update-intensity/"+e+"/"+b.toLowerCase()+"/"+c),EQ.Helpers.putService(f).done(function(){debug("calories",a),p.text(a),l.text(b)}).fail(function(a){debug("server error",a.responseJSON),h.showError()}).always(function(){h.hideLoader()})},i.validate=function(a){return!(a.which>57&&(a.which<96||a.which>105))},i.updateIntensity=function(){var a=parseInt(q.val(),10),b=m.eq(2),c=m.eq(1),d=m.eq(0);a>=parseInt(b.val(),10)?(b.prop("checked",!0),n.text(b.attr("id").toLowerCase())):a>=parseInt(c.val(),10)?(c.prop("checked",!0),n.text(c.attr("id").toLowerCase())):(d.prop("checked",!0),n.text(d.attr("id").toLowerCase()))},i.updateValue=function(){jQuery(this).val(parseInt(jQuery(this).val().substr(0,4),10)||"")},i.updateCalories=function(){q.val(jQuery(this).val())},i.radioButtonHighlight=function(){i.radioButtonSetActive(jQuery(this).attr("id"))},i.radioButtonSetActive=function(a){m.prop("checked",!1).parent().removeClass("active"),m.filter("#"+a).prop("checked",!0).parent().addClass("active")},i.updateCaloriesText=function(){n.text(jQuery(this).attr("id"))},i.removeClass=function(b){b.preventDefault(),a.loadComponent("confirm-modal",jQuery("#confirmModalTemplate"),{callback:function(a){if(a){var c=APIEndpoint+"/me/calendar/cancel/"+d+"?removeRecurring=false",e=b;h.hideError(),h.showLoader(),jQuery.ajax({type:"DELETE",url:c,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json"}).done(function(a){debug("[REMOVECLASS OK]",a),h.hideLoader(),i.showMessage("remove",4e3,function(){i.backButton(e)})}).fail(function(a){debug("server error",a.responseJSON),h.showError()}).always(function(){h.hideLoader()})}}})},i.backButton=function(a){a.preventDefault(),y||!history.length||z?location.replace("/activity#WORKOUTS/"+C):history.go(-1)},i.switchACCE=function(){Backbone.Events.trigger("automatic-calories-overlay:open")},i.showMessage=function(a,b,c){switch(a){case"acce":w.text("Class and calories have been added to your calendar and activity");break;case"remove":w.text("Workout Removed")}w.addClass("active"),setTimeout(function(){w.removeClass("active"),"function"==typeof c&&c()},b)}}(window.App),function(a){"use strict";var b=0===location.host.indexOf("local.equinox.com")||0===location.host.indexOf("local-web.equinox.com")?!0:!1,c=jQuery("body").data("asset-base-url")||"",d=jQuery("body").data("app-version")?"?v="+jQuery("body").data("app-version"):"",e=function(b,c,d){try{return a.Components[b](c,d)}catch(e){console.error("data-component failed to export as a function",e.stack)}};a.renderComponents=function(a){var f=jQuery(a),g=[],h=[];f.find("[data-component]").each(function(a,e){var f=jQuery(e),i=f.data("component"),j=f.data("component-options"),k=c+"/assets/js/app/components/"+i+".js"+d,l=c+"/assets/js/app/components/min/"+i+".js"+d;try{var m={filename:b?k:l,jQueryel:f,component:i,options:j};g.push(m),h.push(m.filename)}catch(n){console.error("data-component not found: "+i,n.stack)}});try{require(h,function(){_.forEach(g,function(a){e(a.component,a.jQueryel,a.options||{})})})}catch(i){console.error("data-component not found",i)}},a.loadComponent=function(a,b,f,g){debug("[DataComponent] Loading: "+a+" component."),require([c+"/assets/js/app/components/min/"+a+".js"+d],function(){e(a,b,f||{}),g&&"function"==typeof g&&g.call(a)})},a.renderComponents("body"),_.extend(Backbone.View.prototype,Backbone.Events,{renderComponents:function(b){a.renderComponents(b)}})}(window.App),window.App.Events.trigger("loaded"),function(){"use strict";jQuery(function(){"android"===EQ.Helpers.getDevicePlatform()&&jQuery("input[maxlength]").each(function(){var a=jQuery(this),b=a.attr("maxlength");a.removeAttr("maxlength"),a.on("keydown",function(c){var d=[8,9,13,33,34,35,36,37,38,39,40,46],e=c.altKey||c.ctrlKey;return-1!==jQuery.inArray(c.keyCode,d)||e?void 0:a.val().length<b}),a.on("keyup",function(){var c=a.val();c.length>b&&a.val(c.substr(0,b))})}),"#flushGeoCache"===window.location.hash&&(EQ.Geo.flushCache(),console.log("[GLOBAL] Flushing Geo Cache")),EQ.Helpers.fixRegionProperty(),jQuery('iframe[title="Google conversion frame"]').css("display","none")})}(window);
/*! mindoro v0.7.0 - 2017-06-26 09:06:32 */
